<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第10章 贝叶斯统计 | 数据分析残卷</title>
  <meta name="description" content="数据分析世界的清明上河图" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="第10章 贝叶斯统计 | 数据分析残卷" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="数据分析世界的清明上河图" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第10章 贝叶斯统计 | 数据分析残卷" />
  
  <meta name="twitter:description" content="数据分析世界的清明上河图" />
  

<meta name="author" content="于淼" />


<meta name="date" content="2020-01-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="product.html"/>
<link rel="next" href="why.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">数据分析残卷</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>序</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> 导论</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#数据科学"><i class="fa fa-check"></i><b>1.1</b> 数据科学</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#基本问题"><i class="fa fa-check"></i><b>1.2</b> 基本问题</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#工作流程"><i class="fa fa-check"></i><b>1.3</b> 工作流程</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#概率与分布"><i class="fa fa-check"></i><b>1.4</b> 概率与分布</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#统计量"><i class="fa fa-check"></i><b>1.5</b> 统计量</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#si"><i class="fa fa-check"></i><b>1.6</b> 统计推断</a></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#sm"><i class="fa fa-check"></i><b>1.7</b> 统计模型</a></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#其他主题"><i class="fa fa-check"></i><b>1.8</b> 其他主题</a></li>
<li class="chapter" data-level="1.9" data-path="intro.html"><a href="intro.html#应用"><i class="fa fa-check"></i><b>1.9</b> 应用</a></li>
<li class="chapter" data-level="1.10" data-path="intro.html"><a href="intro.html#链接"><i class="fa fa-check"></i><b>1.10</b> 链接</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tool.html"><a href="tool.html"><i class="fa fa-check"></i><b>2</b> 数据分析工具</a><ul>
<li class="chapter" data-level="2.1" data-path="tool.html"><a href="tool.html#基础知识"><i class="fa fa-check"></i><b>2.1</b> 基础知识</a></li>
<li class="chapter" data-level="2.2" data-path="tool.html"><a href="tool.html#命令行基础"><i class="fa fa-check"></i><b>2.2</b> 命令行基础</a></li>
<li class="chapter" data-level="2.3" data-path="tool.html"><a href="tool.html#版本控制"><i class="fa fa-check"></i><b>2.3</b> 版本控制</a></li>
<li class="chapter" data-level="2.4" data-path="tool.html"><a href="tool.html#数据获取"><i class="fa fa-check"></i><b>2.4</b> 数据获取</a></li>
<li class="chapter" data-level="2.5" data-path="tool.html"><a href="tool.html#远程控制"><i class="fa fa-check"></i><b>2.5</b> 远程控制</a></li>
<li class="chapter" data-level="2.6" data-path="tool.html"><a href="tool.html#高级命令"><i class="fa fa-check"></i><b>2.6</b> 高级命令</a></li>
<li class="chapter" data-level="2.7" data-path="tool.html"><a href="tool.html#r"><i class="fa fa-check"></i><b>2.7</b> R</a><ul>
<li class="chapter" data-level="2.7.1" data-path="tool.html"><a href="tool.html#语言导论"><i class="fa fa-check"></i><b>2.7.1</b> 语言导论</a></li>
<li class="chapter" data-level="2.7.2" data-path="tool.html"><a href="tool.html#获得帮助"><i class="fa fa-check"></i><b>2.7.2</b> 获得帮助</a></li>
<li class="chapter" data-level="2.7.3" data-path="tool.html"><a href="tool.html#数据类型及基本运算"><i class="fa fa-check"></i><b>2.7.3</b> 数据类型及基本运算</a></li>
<li class="chapter" data-level="2.7.4" data-path="tool.html"><a href="tool.html#环境文件操作"><i class="fa fa-check"></i><b>2.7.4</b> 环境／文件操作</a></li>
<li class="chapter" data-level="2.7.5" data-path="tool.html"><a href="tool.html#下载"><i class="fa fa-check"></i><b>2.7.5</b> 下载</a></li>
<li class="chapter" data-level="2.7.6" data-path="tool.html"><a href="tool.html#截取数据"><i class="fa fa-check"></i><b>2.7.6</b> 截取数据</a></li>
<li class="chapter" data-level="2.7.7" data-path="tool.html"><a href="tool.html#读取数据"><i class="fa fa-check"></i><b>2.7.7</b> 读取数据</a></li>
<li class="chapter" data-level="2.7.8" data-path="tool.html"><a href="tool.html#数据总结"><i class="fa fa-check"></i><b>2.7.8</b> 数据总结</a></li>
<li class="chapter" data-level="2.7.9" data-path="tool.html"><a href="tool.html#数据整理"><i class="fa fa-check"></i><b>2.7.9</b> 数据整理</a></li>
<li class="chapter" data-level="2.7.10" data-path="tool.html"><a href="tool.html#数据操作data.table包"><i class="fa fa-check"></i><b>2.7.10</b> <span><em>数据操作data.table包</em></span></a></li>
<li class="chapter" data-level="2.7.11" data-path="tool.html"><a href="tool.html#文本处理"><i class="fa fa-check"></i><b>2.7.11</b> 文本处理</a></li>
<li class="chapter" data-level="2.7.12" data-path="tool.html"><a href="tool.html#控制结构"><i class="fa fa-check"></i><b>2.7.12</b> 控制结构</a></li>
<li class="chapter" data-level="2.7.13" data-path="tool.html"><a href="tool.html#函数"><i class="fa fa-check"></i><b>2.7.13</b> 函数</a></li>
<li class="chapter" data-level="2.7.14" data-path="tool.html"><a href="tool.html#编程标准"><i class="fa fa-check"></i><b>2.7.14</b> 编程标准</a></li>
<li class="chapter" data-level="2.7.15" data-path="tool.html"><a href="tool.html#范围规则"><i class="fa fa-check"></i><b>2.7.15</b> 范围规则</a></li>
<li class="chapter" data-level="2.7.16" data-path="tool.html"><a href="tool.html#向量化操作"><i class="fa fa-check"></i><b>2.7.16</b> 向量化操作</a></li>
<li class="chapter" data-level="2.7.17" data-path="tool.html"><a href="tool.html#绘图系统"><i class="fa fa-check"></i><b>2.7.17</b> 绘图系统</a></li>
<li class="chapter" data-level="2.7.18" data-path="tool.html"><a href="tool.html#日期与时间"><i class="fa fa-check"></i><b>2.7.18</b> 日期与时间</a></li>
<li class="chapter" data-level="2.7.19" data-path="tool.html"><a href="tool.html#循环"><i class="fa fa-check"></i><b>2.7.19</b> 循环</a></li>
<li class="chapter" data-level="2.7.20" data-path="tool.html"><a href="tool.html#模拟"><i class="fa fa-check"></i><b>2.7.20</b> 模拟</a></li>
<li class="chapter" data-level="2.7.21" data-path="tool.html"><a href="tool.html#调试"><i class="fa fa-check"></i><b>2.7.21</b> 调试</a></li>
<li class="chapter" data-level="2.7.22" data-path="tool.html"><a href="tool.html#分析代码"><i class="fa fa-check"></i><b>2.7.22</b> 分析代码</a></li>
<li class="chapter" data-level="2.7.23" data-path="tool.html"><a href="tool.html#包开发"><i class="fa fa-check"></i><b>2.7.23</b> 包开发</a></li>
<li class="chapter" data-level="2.7.24" data-path="tool.html"><a href="tool.html#方法与类型"><i class="fa fa-check"></i><b>2.7.24</b> 方法与类型</a></li>
<li class="chapter" data-level="2.7.25" data-path="tool.html"><a href="tool.html#并行计算"><i class="fa fa-check"></i><b>2.7.25</b> 并行计算</a></li>
<li class="chapter" data-level="2.7.26" data-path="tool.html"><a href="tool.html#分布式计算"><i class="fa fa-check"></i><b>2.7.26</b> 分布式计算</a></li>
<li class="chapter" data-level="2.7.27" data-path="tool.html"><a href="tool.html#异常值监测"><i class="fa fa-check"></i><b>2.7.27</b> 异常值监测</a></li>
<li class="chapter" data-level="2.7.28" data-path="tool.html"><a href="tool.html#图片处理"><i class="fa fa-check"></i><b>2.7.28</b> 图片处理</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="tool.html"><a href="tool.html#python"><i class="fa fa-check"></i><b>2.8</b> Python</a><ul>
<li class="chapter" data-level="2.8.1" data-path="tool.html"><a href="tool.html#工具包"><i class="fa fa-check"></i><b>2.8.1</b> 工具包</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="tool.html"><a href="tool.html#tex"><i class="fa fa-check"></i><b>2.9</b> Tex</a><ul>
<li class="chapter" data-level="2.9.1" data-path="tool.html"><a href="tool.html#语言基础"><i class="fa fa-check"></i><b>2.9.1</b> 语言基础</a></li>
<li class="chapter" data-level="2.9.2" data-path="tool.html"><a href="tool.html#关于xetex"><i class="fa fa-check"></i><b>2.9.2</b> 关于<code>xetex</code></a></li>
<li class="chapter" data-level="2.9.3" data-path="tool.html"><a href="tool.html#常见问题"><i class="fa fa-check"></i><b>2.9.3</b> 常见问题</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="repro.html"><a href="repro.html"><i class="fa fa-check"></i><b>3</b> 可复算性研究</a><ul>
<li class="chapter" data-level="3.1" data-path="repro.html"><a href="repro.html#replication"><i class="fa fa-check"></i><b>3.1</b> Replication</a></li>
<li class="chapter" data-level="3.2" data-path="repro.html"><a href="repro.html#reproducible"><i class="fa fa-check"></i><b>3.2</b> Reproducible</a></li>
<li class="chapter" data-level="3.3" data-path="repro.html"><a href="repro.html#研究流程"><i class="fa fa-check"></i><b>3.3</b> 研究流程</a></li>
<li class="chapter" data-level="3.4" data-path="repro.html"><a href="repro.html#数据分析步骤"><i class="fa fa-check"></i><b>3.4</b> 数据分析步骤</a></li>
<li class="chapter" data-level="3.5" data-path="repro.html"><a href="repro.html#数据分析文件结构"><i class="fa fa-check"></i><b>3.5</b> 数据分析文件结构</a></li>
<li class="chapter" data-level="3.6" data-path="repro.html"><a href="repro.html#文本化统计编程-knitr"><i class="fa fa-check"></i><b>3.6</b> 文本化统计编程-Knitr</a></li>
<li class="chapter" data-level="3.7" data-path="repro.html"><a href="repro.html#结果通讯"><i class="fa fa-check"></i><b>3.7</b> 结果通讯</a></li>
<li class="chapter" data-level="3.8" data-path="repro.html"><a href="repro.html#检查列表"><i class="fa fa-check"></i><b>3.8</b> 检查列表</a></li>
<li class="chapter" data-level="3.9" data-path="repro.html"><a href="repro.html#基于证据的数据分析"><i class="fa fa-check"></i><b>3.9</b> 基于证据的数据分析</a></li>
<li class="chapter" data-level="3.10" data-path="repro.html"><a href="repro.html#结果可解释"><i class="fa fa-check"></i><b>3.10</b> 结果可解释</a></li>
<li class="chapter" data-level="3.11" data-path="repro.html"><a href="repro.html#数据分析的理论"><i class="fa fa-check"></i><b>3.11</b> 数据分析的理论</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exp.html"><a href="exp.html"><i class="fa fa-check"></i><b>4</b> 探索性数据分析</a><ul>
<li class="chapter" data-level="4.1" data-path="exp.html"><a href="exp.html#aces-模型"><i class="fa fa-check"></i><b>4.1</b> ACES 模型</a></li>
<li class="chapter" data-level="4.2" data-path="exp.html"><a href="exp.html#探索绘图原则"><i class="fa fa-check"></i><b>4.2</b> 探索绘图原则</a></li>
<li class="chapter" data-level="4.3" data-path="exp.html"><a href="exp.html#探索性绘图"><i class="fa fa-check"></i><b>4.3</b> 探索性绘图</a></li>
<li class="chapter" data-level="4.4" data-path="exp.html"><a href="exp.html#分层聚类"><i class="fa fa-check"></i><b>4.4</b> 分层聚类</a></li>
<li class="chapter" data-level="4.5" data-path="exp.html"><a href="exp.html#k-means聚类"><i class="fa fa-check"></i><b>4.5</b> k-means聚类</a></li>
<li class="chapter" data-level="4.6" data-path="exp.html"><a href="exp.html#维度还原"><i class="fa fa-check"></i><b>4.6</b> 维度还原</a></li>
<li class="chapter" data-level="4.7" data-path="exp.html"><a href="exp.html#可视化图形"><i class="fa fa-check"></i><b>4.7</b> 可视化图形</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="infer.html"><a href="infer.html"><i class="fa fa-check"></i><b>5</b> 统计推断</a><ul>
<li class="chapter" data-level="5.1" data-path="infer.html"><a href="infer.html#导论"><i class="fa fa-check"></i><b>5.1</b> 导论</a></li>
<li class="chapter" data-level="5.2" data-path="infer.html"><a href="infer.html#概率"><i class="fa fa-check"></i><b>5.2</b> 概率</a></li>
<li class="chapter" data-level="5.3" data-path="infer.html"><a href="infer.html#期望"><i class="fa fa-check"></i><b>5.3</b> 期望</a></li>
<li class="chapter" data-level="5.4" data-path="infer.html"><a href="infer.html#方差"><i class="fa fa-check"></i><b>5.4</b> 方差</a></li>
<li class="chapter" data-level="5.5" data-path="infer.html"><a href="infer.html#独立性"><i class="fa fa-check"></i><b>5.5</b> 独立性</a></li>
<li class="chapter" data-level="5.6" data-path="infer.html"><a href="infer.html#条件概率"><i class="fa fa-check"></i><b>5.6</b> 条件概率</a></li>
<li class="chapter" data-level="5.7" data-path="infer.html"><a href="infer.html#贝叶斯定理"><i class="fa fa-check"></i><b>5.7</b> 贝叶斯定理</a></li>
<li class="chapter" data-level="5.8" data-path="infer.html"><a href="infer.html#常见分布"><i class="fa fa-check"></i><b>5.8</b> 常见分布</a></li>
<li class="chapter" data-level="5.9" data-path="infer.html"><a href="infer.html#渐进"><i class="fa fa-check"></i><b>5.9</b> 渐进</a></li>
<li class="chapter" data-level="5.10" data-path="infer.html"><a href="infer.html#置信区间"><i class="fa fa-check"></i><b>5.10</b> 置信区间</a></li>
<li class="chapter" data-level="5.11" data-path="infer.html"><a href="infer.html#似然函数"><i class="fa fa-check"></i><b>5.11</b> 似然函数</a></li>
<li class="chapter" data-level="5.12" data-path="infer.html"><a href="infer.html#贝叶斯推断"><i class="fa fa-check"></i><b>5.12</b> 贝叶斯推断</a></li>
<li class="chapter" data-level="5.13" data-path="infer.html"><a href="infer.html#两独立样本t检验"><i class="fa fa-check"></i><b>5.13</b> 两独立样本t检验</a></li>
<li class="chapter" data-level="5.14" data-path="infer.html"><a href="infer.html#假设检验"><i class="fa fa-check"></i><b>5.14</b> 假设检验</a></li>
<li class="chapter" data-level="5.15" data-path="infer.html"><a href="infer.html#p值"><i class="fa fa-check"></i><b>5.15</b> P值</a></li>
<li class="chapter" data-level="5.16" data-path="infer.html"><a href="infer.html#功效"><i class="fa fa-check"></i><b>5.16</b> 功效</a></li>
<li class="chapter" data-level="5.17" data-path="infer.html"><a href="infer.html#多重比较"><i class="fa fa-check"></i><b>5.17</b> 多重比较</a></li>
<li class="chapter" data-level="5.18" data-path="infer.html"><a href="infer.html#重采样推断"><i class="fa fa-check"></i><b>5.18</b> 重采样推断</a></li>
<li class="chapter" data-level="5.19" data-path="infer.html"><a href="infer.html#概念可视化"><i class="fa fa-check"></i><b>5.19</b> 概念可视化</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="reg.html"><a href="reg.html"><i class="fa fa-check"></i><b>6</b> 回归模型</a><ul>
<li class="chapter" data-level="6.1" data-path="reg.html"><a href="reg.html#回归模型导论"><i class="fa fa-check"></i><b>6.1</b> 回归模型导论</a></li>
<li class="chapter" data-level="6.2" data-path="reg.html"><a href="reg.html#术语"><i class="fa fa-check"></i><b>6.2</b> 术语</a></li>
<li class="chapter" data-level="6.3" data-path="reg.html"><a href="reg.html#回归线的最小二乘回归"><i class="fa fa-check"></i><b>6.3</b> 回归线的最小二乘回归</a></li>
<li class="chapter" data-level="6.4" data-path="reg.html"><a href="reg.html#统计线性回归模型"><i class="fa fa-check"></i><b>6.4</b> 统计线性回归模型</a></li>
<li class="chapter" data-level="6.5" data-path="reg.html"><a href="reg.html#残差"><i class="fa fa-check"></i><b>6.5</b> 残差</a></li>
<li class="chapter" data-level="6.6" data-path="reg.html"><a href="reg.html#回归推断"><i class="fa fa-check"></i><b>6.6</b> 回归推断</a></li>
<li class="chapter" data-level="6.7" data-path="reg.html"><a href="reg.html#多元回归"><i class="fa fa-check"></i><b>6.7</b> 多元回归</a></li>
<li class="chapter" data-level="6.8" data-path="reg.html"><a href="reg.html#模型诊断与选择"><i class="fa fa-check"></i><b>6.8</b> 模型诊断与选择</a></li>
<li class="chapter" data-level="6.9" data-path="reg.html"><a href="reg.html#广义线性模型"><i class="fa fa-check"></i><b>6.9</b> 广义线性模型</a></li>
<li class="chapter" data-level="6.10" data-path="reg.html"><a href="reg.html#二元响应"><i class="fa fa-check"></i><b>6.10</b> 二元响应</a></li>
<li class="chapter" data-level="6.11" data-path="reg.html"><a href="reg.html#计数或速率响应"><i class="fa fa-check"></i><b>6.11</b> 计数或速率响应</a></li>
<li class="chapter" data-level="6.12" data-path="reg.html"><a href="reg.html#分段平滑"><i class="fa fa-check"></i><b>6.12</b> 分段平滑</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="opt.html"><a href="opt.html"><i class="fa fa-check"></i><b>7</b> 最优化</a><ul>
<li class="chapter" data-level="7.1" data-path="opt.html"><a href="opt.html#数学本质"><i class="fa fa-check"></i><b>7.1</b> 数学本质</a></li>
<li class="chapter" data-level="7.2" data-path="opt.html"><a href="opt.html#简史"><i class="fa fa-check"></i><b>7.2</b> 简史</a></li>
<li class="chapter" data-level="7.3" data-path="opt.html"><a href="opt.html#凸集"><i class="fa fa-check"></i><b>7.3</b> 凸集</a></li>
<li class="chapter" data-level="7.4" data-path="opt.html"><a href="opt.html#最小二乘法"><i class="fa fa-check"></i><b>7.4</b> 最小二乘法</a></li>
<li class="chapter" data-level="7.5" data-path="opt.html"><a href="opt.html#线性规划"><i class="fa fa-check"></i><b>7.5</b> 线性规划</a></li>
<li class="chapter" data-level="7.6" data-path="opt.html"><a href="opt.html#凸优化"><i class="fa fa-check"></i><b>7.6</b> 凸优化</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mlsl.html"><a href="mlsl.html"><i class="fa fa-check"></i><b>8</b> 统计模型</a><ul>
<li class="chapter" data-level="8.1" data-path="mlsl.html"><a href="mlsl.html#统计学习概论"><i class="fa fa-check"></i><b>8.1</b> 统计学习概论</a></li>
<li class="chapter" data-level="8.2" data-path="mlsl.html"><a href="mlsl.html#统计学习简史"><i class="fa fa-check"></i><b>8.2</b> 统计学习简史</a></li>
<li class="chapter" data-level="8.3" data-path="mlsl.html"><a href="mlsl.html#统计学习定义"><i class="fa fa-check"></i><b>8.3</b> 统计学习定义</a></li>
<li class="chapter" data-level="8.4" data-path="mlsl.html"><a href="mlsl.html#预测"><i class="fa fa-check"></i><b>8.4</b> 预测</a></li>
<li class="chapter" data-level="8.5" data-path="mlsl.html"><a href="mlsl.html#推断"><i class="fa fa-check"></i><b>8.5</b> 推断</a></li>
<li class="chapter" data-level="8.6" data-path="mlsl.html"><a href="mlsl.html#估计模型"><i class="fa fa-check"></i><b>8.6</b> 估计模型</a></li>
<li class="chapter" data-level="8.7" data-path="mlsl.html"><a href="mlsl.html#评价模型"><i class="fa fa-check"></i><b>8.7</b> 评价模型</a><ul>
<li class="chapter" data-level="8.7.1" data-path="mlsl.html"><a href="mlsl.html#拟合质量测量"><i class="fa fa-check"></i><b>8.7.1</b> 拟合质量测量</a></li>
<li class="chapter" data-level="8.7.2" data-path="mlsl.html"><a href="mlsl.html#聚类评价"><i class="fa fa-check"></i><b>8.7.2</b> 聚类评价</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="mlsl.html"><a href="mlsl.html#研究设计"><i class="fa fa-check"></i><b>8.8</b> 研究设计</a></li>
<li class="chapter" data-level="8.9" data-path="mlsl.html"><a href="mlsl.html#错误率"><i class="fa fa-check"></i><b>8.9</b> 错误率</a></li>
<li class="chapter" data-level="8.10" data-path="mlsl.html"><a href="mlsl.html#roc-曲线"><i class="fa fa-check"></i><b>8.10</b> ROC 曲线</a></li>
<li class="chapter" data-level="8.11" data-path="mlsl.html"><a href="mlsl.html#重采样技术"><i class="fa fa-check"></i><b>8.11</b> 重采样技术</a><ul>
<li class="chapter" data-level="8.11.1" data-path="mlsl.html"><a href="mlsl.html#交叉检验"><i class="fa fa-check"></i><b>8.11.1</b> 交叉检验</a></li>
<li class="chapter" data-level="8.11.2" data-path="mlsl.html"><a href="mlsl.html#bootstrap"><i class="fa fa-check"></i><b>8.11.2</b> bootstrap</a></li>
</ul></li>
<li class="chapter" data-level="8.12" data-path="mlsl.html"><a href="mlsl.html#caret-包"><i class="fa fa-check"></i><b>8.12</b> <code>caret</code> 包</a></li>
<li class="chapter" data-level="8.13" data-path="mlsl.html"><a href="mlsl.html#数据分割"><i class="fa fa-check"></i><b>8.13</b> 数据分割</a></li>
<li class="chapter" data-level="8.14" data-path="mlsl.html"><a href="mlsl.html#训练选项"><i class="fa fa-check"></i><b>8.14</b> 训练选项</a></li>
<li class="chapter" data-level="8.15" data-path="mlsl.html"><a href="mlsl.html#预测变量作图"><i class="fa fa-check"></i><b>8.15</b> 预测变量作图</a></li>
<li class="chapter" data-level="8.16" data-path="mlsl.html"><a href="mlsl.html#数据预处理"><i class="fa fa-check"></i><b>8.16</b> 数据预处理</a></li>
<li class="chapter" data-level="8.17" data-path="mlsl.html"><a href="mlsl.html#协变量生成"><i class="fa fa-check"></i><b>8.17</b> 协变量生成</a></li>
<li class="chapter" data-level="8.18" data-path="mlsl.html"><a href="mlsl.html#线性回归多元线性回归"><i class="fa fa-check"></i><b>8.18</b> 线性回归&amp;多元线性回归</a><ul>
<li class="chapter" data-level="8.18.1" data-path="mlsl.html"><a href="mlsl.html#简单线性回归"><i class="fa fa-check"></i><b>8.18.1</b> 简单线性回归</a></li>
<li class="chapter" data-level="8.18.2" data-path="mlsl.html"><a href="mlsl.html#多元线性回归"><i class="fa fa-check"></i><b>8.18.2</b> 多元线性回归</a></li>
<li class="chapter" data-level="8.18.3" data-path="mlsl.html"><a href="mlsl.html#线性模型延拓"><i class="fa fa-check"></i><b>8.18.3</b> 线性模型延拓</a></li>
<li class="chapter" data-level="8.18.4" data-path="mlsl.html"><a href="mlsl.html#常见问题-1"><i class="fa fa-check"></i><b>8.18.4</b> 常见问题</a></li>
<li class="chapter" data-level="8.18.5" data-path="mlsl.html"><a href="mlsl.html#线性回归与kmeans算法比较"><i class="fa fa-check"></i><b>8.18.5</b> 线性回归与kmeans算法比较</a></li>
<li class="chapter" data-level="8.18.6" data-path="mlsl.html"><a href="mlsl.html#logistic回归"><i class="fa fa-check"></i><b>8.18.6</b> logistic回归</a></li>
<li class="chapter" data-level="8.18.7" data-path="mlsl.html"><a href="mlsl.html#线性判别分析"><i class="fa fa-check"></i><b>8.18.7</b> 线性判别分析</a></li>
<li class="chapter" data-level="8.18.8" data-path="mlsl.html"><a href="mlsl.html#二次判别分析qda及其它"><i class="fa fa-check"></i><b>8.18.8</b> 二次判别分析（QDA）及其它</a></li>
<li class="chapter" data-level="8.18.9" data-path="mlsl.html"><a href="mlsl.html#线性模型选择与正则化"><i class="fa fa-check"></i><b>8.18.9</b> 线性模型选择与正则化</a></li>
</ul></li>
<li class="chapter" data-level="8.19" data-path="mlsl.html"><a href="mlsl.html#非线性"><i class="fa fa-check"></i><b>8.19</b> 非线性</a><ul>
<li class="chapter" data-level="8.19.1" data-path="mlsl.html"><a href="mlsl.html#多项式回归"><i class="fa fa-check"></i><b>8.19.1</b> 多项式回归</a></li>
<li class="chapter" data-level="8.19.2" data-path="mlsl.html"><a href="mlsl.html#阶梯函数"><i class="fa fa-check"></i><b>8.19.2</b> 阶梯函数</a></li>
<li class="chapter" data-level="8.19.3" data-path="mlsl.html"><a href="mlsl.html#基函数"><i class="fa fa-check"></i><b>8.19.3</b> 基函数</a></li>
<li class="chapter" data-level="8.19.4" data-path="mlsl.html"><a href="mlsl.html#回归样条"><i class="fa fa-check"></i><b>8.19.4</b> 回归样条</a></li>
<li class="chapter" data-level="8.19.5" data-path="mlsl.html"><a href="mlsl.html#平滑样条"><i class="fa fa-check"></i><b>8.19.5</b> 平滑样条</a></li>
<li class="chapter" data-level="8.19.6" data-path="mlsl.html"><a href="mlsl.html#本地回归"><i class="fa fa-check"></i><b>8.19.6</b> 本地回归</a></li>
<li class="chapter" data-level="8.19.7" data-path="mlsl.html"><a href="mlsl.html#广义加性模型"><i class="fa fa-check"></i><b>8.19.7</b> 广义加性模型</a></li>
</ul></li>
<li class="chapter" data-level="8.20" data-path="mlsl.html"><a href="mlsl.html#树"><i class="fa fa-check"></i><b>8.20</b> 树</a><ul>
<li class="chapter" data-level="8.20.1" data-path="mlsl.html"><a href="mlsl.html#回归树"><i class="fa fa-check"></i><b>8.20.1</b> 回归树</a></li>
<li class="chapter" data-level="8.20.2" data-path="mlsl.html"><a href="mlsl.html#分类树"><i class="fa fa-check"></i><b>8.20.2</b> 分类树</a></li>
<li class="chapter" data-level="8.20.3" data-path="mlsl.html"><a href="mlsl.html#bagging"><i class="fa fa-check"></i><b>8.20.3</b> Bagging</a></li>
<li class="chapter" data-level="8.20.4" data-path="mlsl.html"><a href="mlsl.html#随机森林"><i class="fa fa-check"></i><b>8.20.4</b> 随机森林</a></li>
<li class="chapter" data-level="8.20.5" data-path="mlsl.html"><a href="mlsl.html#boosting"><i class="fa fa-check"></i><b>8.20.5</b> Boosting</a></li>
</ul></li>
<li class="chapter" data-level="8.21" data-path="mlsl.html"><a href="mlsl.html#支持向量机"><i class="fa fa-check"></i><b>8.21</b> 支持向量机</a><ul>
<li class="chapter" data-level="8.21.1" data-path="mlsl.html"><a href="mlsl.html#最大边界分类器"><i class="fa fa-check"></i><b>8.21.1</b> 最大边界分类器</a></li>
<li class="chapter" data-level="8.21.2" data-path="mlsl.html"><a href="mlsl.html#支持向量分类器"><i class="fa fa-check"></i><b>8.21.2</b> 支持向量分类器</a></li>
<li class="chapter" data-level="8.21.3" data-path="mlsl.html"><a href="mlsl.html#支持向量机原理"><i class="fa fa-check"></i><b>8.21.3</b> 支持向量机原理</a></li>
<li class="chapter" data-level="8.21.4" data-path="mlsl.html"><a href="mlsl.html#svm与logistic回归关系"><i class="fa fa-check"></i><b>8.21.4</b> svm与logistic回归关系</a></li>
</ul></li>
<li class="chapter" data-level="8.22" data-path="mlsl.html"><a href="mlsl.html#无监督学习"><i class="fa fa-check"></i><b>8.22</b> 无监督学习</a><ul>
<li class="chapter" data-level="8.22.1" data-path="mlsl.html"><a href="mlsl.html#主成分分析"><i class="fa fa-check"></i><b>8.22.1</b> 主成分分析</a></li>
<li class="chapter" data-level="8.22.2" data-path="mlsl.html"><a href="mlsl.html#聚类方法"><i class="fa fa-check"></i><b>8.22.2</b> 聚类方法</a></li>
</ul></li>
<li class="chapter" data-level="8.23" data-path="mlsl.html"><a href="mlsl.html#人工神经网络"><i class="fa fa-check"></i><b>8.23</b> 人工神经网络</a></li>
<li class="chapter" data-level="8.24" data-path="mlsl.html"><a href="mlsl.html#模型联合"><i class="fa fa-check"></i><b>8.24</b> 模型联合</a></li>
<li class="chapter" data-level="8.25" data-path="mlsl.html"><a href="mlsl.html#无监督预测"><i class="fa fa-check"></i><b>8.25</b> 无监督预测</a></li>
<li class="chapter" data-level="8.26" data-path="mlsl.html"><a href="mlsl.html#模型预测"><i class="fa fa-check"></i><b>8.26</b> 模型预测</a></li>
<li class="chapter" data-level="8.27" data-path="mlsl.html"><a href="mlsl.html#模型可视化"><i class="fa fa-check"></i><b>8.27</b> 模型可视化</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="product.html"><a href="product.html"><i class="fa fa-check"></i><b>9</b> 开发数据产品</a><ul>
<li class="chapter" data-level="9.1" data-path="product.html"><a href="product.html#shiny"><i class="fa fa-check"></i><b>9.1</b> shiny</a></li>
<li class="chapter" data-level="9.2" data-path="product.html"><a href="product.html#rcharts"><i class="fa fa-check"></i><b>9.2</b> rCharts</a></li>
<li class="chapter" data-level="9.3" data-path="product.html"><a href="product.html#googlevis"><i class="fa fa-check"></i><b>9.3</b> GoogleVis</a></li>
<li class="chapter" data-level="9.4" data-path="product.html"><a href="product.html#slidify"><i class="fa fa-check"></i><b>9.4</b> Slidify</a></li>
<li class="chapter" data-level="9.5" data-path="product.html"><a href="product.html#yhat"><i class="fa fa-check"></i><b>9.5</b> yhat</a></li>
<li class="chapter" data-level="9.6" data-path="product.html"><a href="product.html#swagger"><i class="fa fa-check"></i><b>9.6</b> swagger</a></li>
<li class="chapter" data-level="9.7" data-path="product.html"><a href="product.html#案例"><i class="fa fa-check"></i><b>9.7</b> 案例</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="bayes.html"><a href="bayes.html"><i class="fa fa-check"></i><b>10</b> 贝叶斯统计</a><ul>
<li class="chapter" data-level="10.1" data-path="bayes.html"><a href="bayes.html#贝塔分布"><i class="fa fa-check"></i><b>10.1</b> 贝塔分布</a></li>
<li class="chapter" data-level="10.2" data-path="bayes.html"><a href="bayes.html#为什么击球的概率分布符合贝塔分布"><i class="fa fa-check"></i><b>10.2</b> 为什么击球的概率分布符合贝塔分布？</a></li>
<li class="chapter" data-level="10.3" data-path="bayes.html"><a href="bayes.html#先验与后验"><i class="fa fa-check"></i><b>10.3</b> 先验与后验</a></li>
<li class="chapter" data-level="10.4" data-path="bayes.html"><a href="bayes.html#经验贝叶斯"><i class="fa fa-check"></i><b>10.4</b> 经验贝叶斯</a></li>
<li class="chapter" data-level="10.5" data-path="bayes.html"><a href="bayes.html#从整体到个人"><i class="fa fa-check"></i><b>10.5</b> 从整体到个人</a></li>
<li class="chapter" data-level="10.6" data-path="bayes.html"><a href="bayes.html#可信区间与置信区间"><i class="fa fa-check"></i><b>10.6</b> 可信区间与置信区间</a></li>
<li class="chapter" data-level="10.7" data-path="bayes.html"><a href="bayes.html#后验错误率"><i class="fa fa-check"></i><b>10.7</b> 后验错误率</a></li>
<li class="chapter" data-level="10.8" data-path="bayes.html"><a href="bayes.html#错误发现率"><i class="fa fa-check"></i><b>10.8</b> 错误发现率</a></li>
<li class="chapter" data-level="10.9" data-path="bayes.html"><a href="bayes.html#q值"><i class="fa fa-check"></i><b>10.9</b> q值</a></li>
<li class="chapter" data-level="10.10" data-path="bayes.html"><a href="bayes.html#贝叶斯视角的假设检验"><i class="fa fa-check"></i><b>10.10</b> 贝叶斯视角的假设检验</a><ul>
<li class="chapter" data-level="10.10.1" data-path="bayes.html"><a href="bayes.html#模拟验证"><i class="fa fa-check"></i><b>10.10.1</b> 模拟验证</a></li>
<li class="chapter" data-level="10.10.2" data-path="bayes.html"><a href="bayes.html#数值积分"><i class="fa fa-check"></i><b>10.10.2</b> 数值积分</a></li>
<li class="chapter" data-level="10.10.3" data-path="bayes.html"><a href="bayes.html#解析解"><i class="fa fa-check"></i><b>10.10.3</b> 解析解</a></li>
<li class="chapter" data-level="10.10.4" data-path="bayes.html"><a href="bayes.html#正态近似求解"><i class="fa fa-check"></i><b>10.10.4</b> 正态近似求解</a></li>
</ul></li>
<li class="chapter" data-level="10.11" data-path="bayes.html"><a href="bayes.html#比例检验"><i class="fa fa-check"></i><b>10.11</b> 比例检验</a></li>
<li class="chapter" data-level="10.12" data-path="bayes.html"><a href="bayes.html#错误率控制"><i class="fa fa-check"></i><b>10.12</b> 错误率控制</a></li>
<li class="chapter" data-level="10.13" data-path="bayes.html"><a href="bayes.html#影响因子"><i class="fa fa-check"></i><b>10.13</b> 影响因子</a><ul>
<li class="chapter" data-level="10.13.1" data-path="bayes.html"><a href="bayes.html#拟合模型"><i class="fa fa-check"></i><b>10.13.1</b> 拟合模型</a></li>
<li class="chapter" data-level="10.13.2" data-path="bayes.html"><a href="bayes.html#求后验概率"><i class="fa fa-check"></i><b>10.13.2</b> 求后验概率</a></li>
<li class="chapter" data-level="10.13.3" data-path="bayes.html"><a href="bayes.html#考虑更多因素"><i class="fa fa-check"></i><b>10.13.3</b> 考虑更多因素</a></li>
</ul></li>
<li class="chapter" data-level="10.14" data-path="bayes.html"><a href="bayes.html#混合概率模型"><i class="fa fa-check"></i><b>10.14</b> 混合概率模型</a><ul>
<li class="chapter" data-level="10.14.1" data-path="bayes.html"><a href="bayes.html#期望最大算法"><i class="fa fa-check"></i><b>10.14.1</b> 期望最大算法</a></li>
<li class="chapter" data-level="10.14.2" data-path="bayes.html"><a href="bayes.html#分配"><i class="fa fa-check"></i><b>10.14.2</b> 分配</a></li>
<li class="chapter" data-level="10.14.3" data-path="bayes.html"><a href="bayes.html#经验贝叶斯收缩"><i class="fa fa-check"></i><b>10.14.3</b> 经验贝叶斯收缩</a></li>
</ul></li>
<li class="chapter" data-level="10.15" data-path="bayes.html"><a href="bayes.html#模拟验证结果"><i class="fa fa-check"></i><b>10.15</b> 模拟验证结果</a><ul>
<li class="chapter" data-level="10.15.1" data-path="bayes.html"><a href="bayes.html#模拟对分布参数的估计"><i class="fa fa-check"></i><b>10.15.1</b> 模拟对分布参数的估计</a></li>
<li class="chapter" data-level="10.15.2" data-path="bayes.html"><a href="bayes.html#区间估计"><i class="fa fa-check"></i><b>10.15.2</b> 区间估计</a></li>
<li class="chapter" data-level="10.15.3" data-path="bayes.html"><a href="bayes.html#错误发现率-1"><i class="fa fa-check"></i><b>10.15.3</b> 错误发现率</a></li>
<li class="chapter" data-level="10.15.4" data-path="bayes.html"><a href="bayes.html#贝塔二项回归"><i class="fa fa-check"></i><b>10.15.4</b> 贝塔二项回归</a></li>
<li class="chapter" data-level="10.15.5" data-path="bayes.html"><a href="bayes.html#重复模拟"><i class="fa fa-check"></i><b>10.15.5</b> 重复模拟</a></li>
</ul></li>
<li class="chapter" data-level="10.16" data-path="bayes.html"><a href="bayes.html#bayeslink"><i class="fa fa-check"></i><b>10.16</b> 网络资源</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="why.html"><a href="why.html"><i class="fa fa-check"></i><b>11</b> 因果分析</a><ul>
<li class="chapter" data-level="11.1" data-path="why.html"><a href="why.html#introduction"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="why.html"><a href="why.html#causal-information"><i class="fa fa-check"></i><b>11.2</b> Causal Information</a><ul>
<li class="chapter" data-level="11.2.1" data-path="why.html"><a href="why.html#target"><i class="fa fa-check"></i><b>11.2.1</b> Target</a></li>
<li class="chapter" data-level="11.2.2" data-path="why.html"><a href="why.html#causal-sources"><i class="fa fa-check"></i><b>11.2.2</b> Causal sources</a></li>
<li class="chapter" data-level="11.2.3" data-path="why.html"><a href="why.html#identification-and-estimation-process"><i class="fa fa-check"></i><b>11.2.3</b> Identification and Estimation Process</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="why.html"><a href="why.html#theoretical-background"><i class="fa fa-check"></i><b>11.3</b> Theoretical Background</a><ul>
<li class="chapter" data-level="11.3.1" data-path="why.html"><a href="why.html#potential-outcomes-framework"><i class="fa fa-check"></i><b>11.3.1</b> Potential Outcomes Framework</a></li>
<li class="chapter" data-level="11.3.2" data-path="why.html"><a href="why.html#causal-identification"><i class="fa fa-check"></i><b>11.3.2</b> Causal Identification</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="why.html"><a href="why.html#methods-for-identification-and-estimation"><i class="fa fa-check"></i><b>11.4</b> Methods for Identification and Estimation</a><ul>
<li class="chapter" data-level="11.4.1" data-path="why.html"><a href="why.html#directed-acyclic-graphsdag-for-identification"><i class="fa fa-check"></i><b>11.4.1</b> Directed Acyclic Graphs(DAG) for Identification</a></li>
<li class="chapter" data-level="11.4.2" data-path="why.html"><a href="why.html#indirect-connection"><i class="fa fa-check"></i><b>11.4.2</b> Indirect Connection</a></li>
<li class="chapter" data-level="11.4.3" data-path="why.html"><a href="why.html#common-cause"><i class="fa fa-check"></i><b>11.4.3</b> Common Cause</a></li>
<li class="chapter" data-level="11.4.4" data-path="why.html"><a href="why.html#common-effect"><i class="fa fa-check"></i><b>11.4.4</b> Common Effect</a></li>
<li class="chapter" data-level="11.4.5" data-path="why.html"><a href="why.html#example-simpsons-paradox"><i class="fa fa-check"></i><b>11.4.5</b> Example: Simpson’s Paradox</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="why.html"><a href="why.html#yinguolink"><i class="fa fa-check"></i><b>11.5</b> 链接</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="neta.html"><a href="neta.html"><i class="fa fa-check"></i><b>12</b> 网络分析</a><ul>
<li class="chapter" data-level="12.1" data-path="neta.html"><a href="neta.html#图论"><i class="fa fa-check"></i><b>12.1</b> 图论</a></li>
<li class="chapter" data-level="12.2" data-path="neta.html"><a href="neta.html#随机网络模型"><i class="fa fa-check"></i><b>12.2</b> 随机网络模型</a></li>
<li class="chapter" data-level="12.3" data-path="neta.html"><a href="neta.html#无尺度网络"><i class="fa fa-check"></i><b>12.3</b> 无尺度网络</a></li>
<li class="chapter" data-level="12.4" data-path="neta.html"><a href="neta.html#无尺度的生成---barabási-albert-模型"><i class="fa fa-check"></i><b>12.4</b> 无尺度的生成 - Barabási-Albert 模型</a></li>
<li class="chapter" data-level="12.5" data-path="neta.html"><a href="neta.html#网络的进化---bianconi-barabási-模型"><i class="fa fa-check"></i><b>12.5</b> 网络的进化 - Bianconi-Barabási 模型</a></li>
<li class="chapter" data-level="12.6" data-path="neta.html"><a href="neta.html#度相关"><i class="fa fa-check"></i><b>12.6</b> 度相关</a></li>
<li class="chapter" data-level="12.7" data-path="neta.html"><a href="neta.html#网络稳健性"><i class="fa fa-check"></i><b>12.7</b> 网络稳健性</a></li>
<li class="chapter" data-level="12.8" data-path="neta.html"><a href="neta.html#网络集群"><i class="fa fa-check"></i><b>12.8</b> 网络集群</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="game.html"><a href="game.html"><i class="fa fa-check"></i><b>13</b> 博弈论</a><ul>
<li class="chapter" data-level="13.1" data-path="game.html"><a href="game.html#术语-1"><i class="fa fa-check"></i><b>13.1</b> 术语</a></li>
<li class="chapter" data-level="13.2" data-path="game.html"><a href="game.html#支配策略dominate-strategy"><i class="fa fa-check"></i><b>13.2</b> 支配策略（dominate strategy）</a></li>
<li class="chapter" data-level="13.3" data-path="game.html"><a href="game.html#最佳回应best-respinse"><i class="fa fa-check"></i><b>13.3</b> 最佳回应（Best respinse）</a></li>
<li class="chapter" data-level="13.4" data-path="game.html"><a href="game.html#纳什均衡nash-equilibrium"><i class="fa fa-check"></i><b>13.4</b> 纳什均衡（Nash Equilibrium）</a></li>
<li class="chapter" data-level="13.5" data-path="game.html"><a href="game.html#帕累托最优pareto-optimality"><i class="fa fa-check"></i><b>13.5</b> 帕累托最优（Pareto Optimality）</a></li>
<li class="chapter" data-level="13.6" data-path="game.html"><a href="game.html#混合策略mixed-stratergies"><i class="fa fa-check"></i><b>13.6</b> 混合策略（Mixed stratergies）</a></li>
<li class="chapter" data-level="13.7" data-path="game.html"><a href="game.html#寻找纳什均衡"><i class="fa fa-check"></i><b>13.7</b> 寻找纳什均衡</a></li>
<li class="chapter" data-level="13.8" data-path="game.html"><a href="game.html#被支配策略dominated-strategy"><i class="fa fa-check"></i><b>13.8</b> 被支配策略（dominated strategy）</a></li>
<li class="chapter" data-level="13.9" data-path="game.html"><a href="game.html#最大最小策略maxmin-strategies"><i class="fa fa-check"></i><b>13.9</b> 最大最小策略（Maxmin strategies）</a></li>
<li class="chapter" data-level="13.10" data-path="game.html"><a href="game.html#扩展形式博弈"><i class="fa fa-check"></i><b>13.10</b> 扩展形式博弈</a></li>
<li class="chapter" data-level="13.11" data-path="game.html"><a href="game.html#完美子博弈"><i class="fa fa-check"></i><b>13.11</b> 完美子博弈</a></li>
<li class="chapter" data-level="13.12" data-path="game.html"><a href="game.html#信息不对称扩展形式博弈"><i class="fa fa-check"></i><b>13.12</b> 信息不对称扩展形式博弈</a></li>
<li class="chapter" data-level="13.13" data-path="game.html"><a href="game.html#混合与行为策略"><i class="fa fa-check"></i><b>13.13</b> 混合与行为策略</a></li>
<li class="chapter" data-level="13.14" data-path="game.html"><a href="game.html#重复博弈"><i class="fa fa-check"></i><b>13.14</b> 重复博弈</a></li>
<li class="chapter" data-level="13.15" data-path="game.html"><a href="game.html#随机博弈stochastic-game"><i class="fa fa-check"></i><b>13.15</b> 随机博弈（stochastic game）</a></li>
<li class="chapter" data-level="13.16" data-path="game.html"><a href="game.html#虚拟行动fictitious-play"><i class="fa fa-check"></i><b>13.16</b> 虚拟行动（fictitious play）</a></li>
<li class="chapter" data-level="13.17" data-path="game.html"><a href="game.html#无悔学习no-regret-learning"><i class="fa fa-check"></i><b>13.17</b> 无悔学习（No-regret learning）</a></li>
<li class="chapter" data-level="13.18" data-path="game.html"><a href="game.html#无限重复博弈的平衡"><i class="fa fa-check"></i><b>13.18</b> 无限重复博弈的平衡</a></li>
<li class="chapter" data-level="13.19" data-path="game.html"><a href="game.html#贝叶斯博弈"><i class="fa fa-check"></i><b>13.19</b> 贝叶斯博弈</a></li>
<li class="chapter" data-level="13.20" data-path="game.html"><a href="game.html#联盟博弈"><i class="fa fa-check"></i><b>13.20</b> 联盟博弈</a></li>
<li class="chapter" data-level="13.21" data-path="game.html"><a href="game.html#夏普利值shapley-value"><i class="fa fa-check"></i><b>13.21</b> 夏普利值（Shapley Value）</a></li>
<li class="chapter" data-level="13.22" data-path="game.html"><a href="game.html#核心"><i class="fa fa-check"></i><b>13.22</b> 核心</a></li>
<li class="chapter" data-level="13.23" data-path="game.html"><a href="game.html#选举"><i class="fa fa-check"></i><b>13.23</b> 选举</a></li>
<li class="chapter" data-level="13.24" data-path="game.html"><a href="game.html#机制设计"><i class="fa fa-check"></i><b>13.24</b> 机制设计</a></li>
<li class="chapter" data-level="13.25" data-path="game.html"><a href="game.html#vcg机制"><i class="fa fa-check"></i><b>13.25</b> VCG机制</a></li>
<li class="chapter" data-level="13.26" data-path="game.html"><a href="game.html#拍卖"><i class="fa fa-check"></i><b>13.26</b> 拍卖</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="bios.html"><a href="bios.html"><i class="fa fa-check"></i><b>14</b> 生物信息</a><ul>
<li class="chapter" data-level="14.1" data-path="bios.html"><a href="bios.html#数据结构"><i class="fa fa-check"></i><b>14.1</b> 数据结构</a></li>
<li class="chapter" data-level="14.2" data-path="bios.html"><a href="bios.html#pubmed-搜索"><i class="fa fa-check"></i><b>14.2</b> Pubmed 搜索</a></li>
<li class="chapter" data-level="14.3" data-path="bios.html"><a href="bios.html#动态规划"><i class="fa fa-check"></i><b>14.3</b> 动态规划</a></li>
<li class="chapter" data-level="14.4" data-path="bios.html"><a href="bios.html#得分矩阵"><i class="fa fa-check"></i><b>14.4</b> 得分矩阵</a></li>
<li class="chapter" data-level="14.5" data-path="bios.html"><a href="bios.html#e-值"><i class="fa fa-check"></i><b>14.5</b> E 值</a></li>
<li class="chapter" data-level="14.6" data-path="bios.html"><a href="bios.html#psi-blast"><i class="fa fa-check"></i><b>14.6</b> PSI-BLAST</a></li>
<li class="chapter" data-level="14.7" data-path="bios.html"><a href="bios.html#蛋白"><i class="fa fa-check"></i><b>14.7</b> 蛋白</a></li>
<li class="chapter" data-level="14.8" data-path="bios.html"><a href="bios.html#蛋白结构预测"><i class="fa fa-check"></i><b>14.8</b> 蛋白结构预测</a></li>
<li class="chapter" data-level="14.9" data-path="bios.html"><a href="bios.html#细菌基因组"><i class="fa fa-check"></i><b>14.9</b> 细菌基因组</a></li>
<li class="chapter" data-level="14.10" data-path="bios.html"><a href="bios.html#病毒"><i class="fa fa-check"></i><b>14.10</b> 病毒</a></li>
<li class="chapter" data-level="14.11" data-path="bios.html"><a href="bios.html#单核苷酸多态性snp"><i class="fa fa-check"></i><b>14.11</b> 单核苷酸多态性（SNP）</a></li>
<li class="chapter" data-level="14.12" data-path="bios.html"><a href="bios.html#真核基因预测"><i class="fa fa-check"></i><b>14.12</b> 真核基因预测</a></li>
<li class="chapter" data-level="14.13" data-path="bios.html"><a href="bios.html#dna指纹"><i class="fa fa-check"></i><b>14.13</b> DNA指纹</a></li>
<li class="chapter" data-level="14.14" data-path="bios.html"><a href="bios.html#ensembl"><i class="fa fa-check"></i><b>14.14</b> Ensembl</a></li>
<li class="chapter" data-level="14.15" data-path="bios.html"><a href="bios.html#基因组学数据分析"><i class="fa fa-check"></i><b>14.15</b> 基因组学数据分析</a><ul>
<li class="chapter" data-level="14.15.1" data-path="bios.html"><a href="bios.html#microarrays"><i class="fa fa-check"></i><b>14.15.1</b> microarrays</a></li>
<li class="chapter" data-level="14.15.2" data-path="bios.html"><a href="bios.html#ngs"><i class="fa fa-check"></i><b>14.15.2</b> NGS</a></li>
<li class="chapter" data-level="14.15.3" data-path="bios.html"><a href="bios.html#数据分析应用背景"><i class="fa fa-check"></i><b>14.15.3</b> 数据分析应用背景</a></li>
<li class="chapter" data-level="14.15.4" data-path="bios.html"><a href="bios.html#bioconductor"><i class="fa fa-check"></i><b>14.15.4</b> Bioconductor</a></li>
<li class="chapter" data-level="14.15.5" data-path="bios.html"><a href="bios.html#示例甲基化数据分析"><i class="fa fa-check"></i><b>14.15.5</b> 示例：甲基化数据分析</a></li>
</ul></li>
<li class="chapter" data-level="14.16" data-path="bios.html"><a href="bios.html#biolink"><i class="fa fa-check"></i><b>14.16</b> 链接</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="surv.html"><a href="surv.html"><i class="fa fa-check"></i><b>15</b> 生存分析</a><ul>
<li class="chapter" data-level="15.1" data-path="surv.html"><a href="surv.html#concepts"><i class="fa fa-check"></i><b>15.1</b> Concepts</a></li>
<li class="chapter" data-level="15.2" data-path="surv.html"><a href="surv.html#notation"><i class="fa fa-check"></i><b>15.2</b> Notation</a></li>
<li class="chapter" data-level="15.3" data-path="surv.html"><a href="surv.html#cox-proportional-hazards-regression-model"><i class="fa fa-check"></i><b>15.3</b> Cox proportional-hazards regression model</a></li>
<li class="chapter" data-level="15.4" data-path="surv.html"><a href="surv.html#case-recidivism"><i class="fa fa-check"></i><b>15.4</b> Case: Recidivism</a><ul>
<li class="chapter" data-level="15.4.1" data-path="surv.html"><a href="surv.html#result"><i class="fa fa-check"></i><b>15.4.1</b> result</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="surv.html"><a href="surv.html#further"><i class="fa fa-check"></i><b>15.5</b> further</a></li>
<li class="chapter" data-level="15.6" data-path="surv.html"><a href="surv.html#time-dependent-covariates"><i class="fa fa-check"></i><b>15.6</b> Time-Dependent Covariates</a></li>
<li class="chapter" data-level="15.7" data-path="surv.html"><a href="surv.html#model-diagnostics"><i class="fa fa-check"></i><b>15.7</b> Model Diagnostics</a></li>
<li class="chapter" data-level="15.8" data-path="surv.html"><a href="surv.html#reference"><i class="fa fa-check"></i><b>15.8</b> Reference</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="epid.html"><a href="epid.html"><i class="fa fa-check"></i><b>16</b> 流行病学</a><ul>
<li class="chapter" data-level="16.1" data-path="epid.html"><a href="epid.html#声明"><i class="fa fa-check"></i><b>16.1</b> 声明</a></li>
<li class="chapter" data-level="16.2" data-path="epid.html"><a href="epid.html#早期疾病的概念"><i class="fa fa-check"></i><b>16.2</b> 早期疾病的概念</a></li>
<li class="chapter" data-level="16.3" data-path="epid.html"><a href="epid.html#近代流行病学关键人物"><i class="fa fa-check"></i><b>16.3</b> 近代流行病学关键人物</a></li>
<li class="chapter" data-level="16.4" data-path="epid.html"><a href="epid.html#现代慢性病流行病学"><i class="fa fa-check"></i><b>16.4</b> 现代慢性病流行病学</a></li>
<li class="chapter" data-level="16.5" data-path="epid.html"><a href="epid.html#流行病学基本概念"><i class="fa fa-check"></i><b>16.5</b> 流行病学基本概念</a><ul>
<li class="chapter" data-level="16.5.1" data-path="epid.html"><a href="epid.html#基本假设"><i class="fa fa-check"></i><b>16.5.1</b> 基本假设</a></li>
<li class="chapter" data-level="16.5.2" data-path="epid.html"><a href="epid.html#定义"><i class="fa fa-check"></i><b>16.5.2</b> 定义</a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="epid.html"><a href="epid.html#描述性流行病学"><i class="fa fa-check"></i><b>16.6</b> 描述性流行病学</a><ul>
<li class="chapter" data-level="16.6.1" data-path="epid.html"><a href="epid.html#疾病爆发的研究步骤"><i class="fa fa-check"></i><b>16.6.1</b> 疾病爆发的研究步骤</a></li>
<li class="chapter" data-level="16.6.2" data-path="epid.html"><a href="epid.html#慢性病的描述性流行病学"><i class="fa fa-check"></i><b>16.6.2</b> 慢性病的描述性流行病学</a></li>
<li class="chapter" data-level="16.6.3" data-path="epid.html"><a href="epid.html#描述流行病学分类"><i class="fa fa-check"></i><b>16.6.3</b> 描述流行病学分类</a></li>
</ul></li>
<li class="chapter" data-level="16.7" data-path="epid.html"><a href="epid.html#分析流行病学"><i class="fa fa-check"></i><b>16.7</b> 分析流行病学</a></li>
<li class="chapter" data-level="16.8" data-path="epid.html"><a href="epid.html#疾病监控"><i class="fa fa-check"></i><b>16.8</b> 疾病监控</a></li>
<li class="chapter" data-level="16.9" data-path="epid.html"><a href="epid.html#疾病频率的测量"><i class="fa fa-check"></i><b>16.9</b> 疾病频率的测量</a><ul>
<li class="chapter" data-level="16.9.1" data-path="epid.html"><a href="epid.html#人群"><i class="fa fa-check"></i><b>16.9.1</b> 人群</a></li>
<li class="chapter" data-level="16.9.2" data-path="epid.html"><a href="epid.html#患病率prevalence"><i class="fa fa-check"></i><b>16.9.2</b> 患病率（prevalence）</a></li>
<li class="chapter" data-level="16.9.3" data-path="epid.html"><a href="epid.html#风险risk"><i class="fa fa-check"></i><b>16.9.3</b> 风险（risk）</a></li>
<li class="chapter" data-level="16.9.4" data-path="epid.html"><a href="epid.html#比率rate"><i class="fa fa-check"></i><b>16.9.4</b> 比率（rate）</a></li>
<li class="chapter" data-level="16.9.5" data-path="epid.html"><a href="epid.html#其他频率测量"><i class="fa fa-check"></i><b>16.9.5</b> 其他频率测量</a></li>
</ul></li>
<li class="chapter" data-level="16.10" data-path="epid.html"><a href="epid.html#联系测量"><i class="fa fa-check"></i><b>16.10</b> 联系测量</a><ul>
<li class="chapter" data-level="16.10.1" data-path="epid.html"><a href="epid.html#风险比与比率比risk-ratio-rate-ratio"><i class="fa fa-check"></i><b>16.10.1</b> 风险比与比率比（risk ratio rate ratio）</a></li>
<li class="chapter" data-level="16.10.2" data-path="epid.html"><a href="epid.html#对照组"><i class="fa fa-check"></i><b>16.10.2</b> 对照组</a></li>
<li class="chapter" data-level="16.10.3" data-path="epid.html"><a href="epid.html#风险差risk-difference"><i class="fa fa-check"></i><b>16.10.3</b> 风险差（risk difference）</a></li>
<li class="chapter" data-level="16.10.4" data-path="epid.html"><a href="epid.html#归因比例attributable-proportion-among-the-exposed"><i class="fa fa-check"></i><b>16.10.4</b> 归因比例（Attributable Proportion Among the Exposed）</a></li>
<li class="chapter" data-level="16.10.5" data-path="epid.html"><a href="epid.html#人群归因比例population-attributable-fraction"><i class="fa fa-check"></i><b>16.10.5</b> 人群归因比例（Population Attributable Fraction）</a></li>
<li class="chapter" data-level="16.10.6" data-path="epid.html"><a href="epid.html#胜率比odds-ratio"><i class="fa fa-check"></i><b>16.10.6</b> 胜率比（odds ratio）</a></li>
</ul></li>
<li class="chapter" data-level="16.11" data-path="epid.html"><a href="epid.html#随机误差"><i class="fa fa-check"></i><b>16.11</b> 随机误差</a></li>
<li class="chapter" data-level="16.12" data-path="epid.html"><a href="epid.html#研究道德"><i class="fa fa-check"></i><b>16.12</b> 研究道德</a></li>
<li class="chapter" data-level="16.13" data-path="epid.html"><a href="epid.html#临床实验"><i class="fa fa-check"></i><b>16.13</b> 临床实验</a><ul>
<li class="chapter" data-level="16.13.1" data-path="epid.html"><a href="epid.html#研究对象"><i class="fa fa-check"></i><b>16.13.1</b> 研究对象</a></li>
<li class="chapter" data-level="16.13.2" data-path="epid.html"><a href="epid.html#对照组与控制组"><i class="fa fa-check"></i><b>16.13.2</b> 对照组与控制组</a></li>
<li class="chapter" data-level="16.13.3" data-path="epid.html"><a href="epid.html#临床分析中的问题"><i class="fa fa-check"></i><b>16.13.3</b> 临床分析中的问题</a></li>
</ul></li>
<li class="chapter" data-level="16.14" data-path="epid.html"><a href="epid.html#队列研究"><i class="fa fa-check"></i><b>16.14</b> 队列研究</a><ul>
<li class="chapter" data-level="16.14.1" data-path="epid.html"><a href="epid.html#前瞻性队列研究"><i class="fa fa-check"></i><b>16.14.1</b> 前瞻性队列研究</a></li>
<li class="chapter" data-level="16.14.2" data-path="epid.html"><a href="epid.html#回顾性队列研究"><i class="fa fa-check"></i><b>16.14.2</b> 回顾性队列研究</a></li>
<li class="chapter" data-level="16.14.3" data-path="epid.html"><a href="epid.html#双向队列研究"><i class="fa fa-check"></i><b>16.14.3</b> 双向队列研究</a></li>
<li class="chapter" data-level="16.14.4" data-path="epid.html"><a href="epid.html#固定队列与开放队列"><i class="fa fa-check"></i><b>16.14.4</b> 固定队列与开放队列</a></li>
<li class="chapter" data-level="16.14.5" data-path="epid.html"><a href="epid.html#研究对象-1"><i class="fa fa-check"></i><b>16.14.5</b> 研究对象</a></li>
<li class="chapter" data-level="16.14.6" data-path="epid.html"><a href="epid.html#队列追踪"><i class="fa fa-check"></i><b>16.14.6</b> 队列追踪</a></li>
<li class="chapter" data-level="16.14.7" data-path="epid.html"><a href="epid.html#优点"><i class="fa fa-check"></i><b>16.14.7</b> 优点</a></li>
<li class="chapter" data-level="16.14.8" data-path="epid.html"><a href="epid.html#前瞻性队列研究缺点"><i class="fa fa-check"></i><b>16.14.8</b> 前瞻性队列研究缺点</a></li>
<li class="chapter" data-level="16.14.9" data-path="epid.html"><a href="epid.html#回顾性队列研究缺点"><i class="fa fa-check"></i><b>16.14.9</b> 回顾性队列研究缺点</a></li>
<li class="chapter" data-level="16.14.10" data-path="epid.html"><a href="epid.html#偏误"><i class="fa fa-check"></i><b>16.14.10</b> 偏误</a></li>
</ul></li>
<li class="chapter" data-level="16.15" data-path="epid.html"><a href="epid.html#病例对照研究"><i class="fa fa-check"></i><b>16.15</b> 病例对照研究</a></li>
<li class="chapter" data-level="16.16" data-path="epid.html"><a href="epid.html#标准化"><i class="fa fa-check"></i><b>16.16</b> 标准化</a></li>
<li class="chapter" data-level="16.17" data-path="epid.html"><a href="epid.html#混杂"><i class="fa fa-check"></i><b>16.17</b> 混杂</a></li>
<li class="chapter" data-level="16.18" data-path="epid.html"><a href="epid.html#效应修饰emm"><i class="fa fa-check"></i><b>16.18</b> 效应修饰（EMM）</a></li>
<li class="chapter" data-level="16.19" data-path="epid.html"><a href="epid.html#多变量方法"><i class="fa fa-check"></i><b>16.19</b> 多变量方法</a></li>
<li class="chapter" data-level="16.20" data-path="epid.html"><a href="epid.html#筛选"><i class="fa fa-check"></i><b>16.20</b> 筛选</a></li>
<li class="chapter" data-level="16.21" data-path="epid.html"><a href="epid.html#因果推断"><i class="fa fa-check"></i><b>16.21</b> 因果推断</a><ul>
<li class="chapter" data-level="16.21.1" data-path="epid.html"><a href="epid.html#hill-因果标准"><i class="fa fa-check"></i><b>16.21.1</b> Hill 因果标准</a></li>
<li class="chapter" data-level="16.21.2" data-path="epid.html"><a href="epid.html#部分原因理论"><i class="fa fa-check"></i><b>16.21.2</b> 部分原因理论</a></li>
<li class="chapter" data-level="16.21.3" data-path="epid.html"><a href="epid.html#逆向模型counterfactual-models"><i class="fa fa-check"></i><b>16.21.3</b> 逆向模型（Counterfactual models）</a></li>
<li class="chapter" data-level="16.21.4" data-path="epid.html"><a href="epid.html#有向无环图dags"><i class="fa fa-check"></i><b>16.21.4</b> 有向无环图（DAGs）</a></li>
</ul></li>
<li class="chapter" data-level="16.22" data-path="epid.html"><a href="epid.html#论文研读"><i class="fa fa-check"></i><b>16.22</b> 论文研读</a><ul>
<li class="chapter" data-level="16.22.1" data-path="epid.html"><a href="epid.html#introduction-1"><i class="fa fa-check"></i><b>16.22.1</b> Introduction</a></li>
<li class="chapter" data-level="16.22.2" data-path="epid.html"><a href="epid.html#methods"><i class="fa fa-check"></i><b>16.22.2</b> Methods</a></li>
<li class="chapter" data-level="16.22.3" data-path="epid.html"><a href="epid.html#results"><i class="fa fa-check"></i><b>16.22.3</b> Results</a></li>
<li class="chapter" data-level="16.22.4" data-path="epid.html"><a href="epid.html#discussion"><i class="fa fa-check"></i><b>16.22.4</b> Discussion</a></li>
<li class="chapter" data-level="16.22.5" data-path="epid.html"><a href="epid.html#conclusion"><i class="fa fa-check"></i><b>16.22.5</b> Conclusion</a></li>
<li class="chapter" data-level="16.22.6" data-path="epid.html"><a href="epid.html#clinical-trial"><i class="fa fa-check"></i><b>16.22.6</b> Clinical Trial</a></li>
<li class="chapter" data-level="16.22.7" data-path="epid.html"><a href="epid.html#cohort-study"><i class="fa fa-check"></i><b>16.22.7</b> Cohort Study</a></li>
<li class="chapter" data-level="16.22.8" data-path="epid.html"><a href="epid.html#case-control-study"><i class="fa fa-check"></i><b>16.22.8</b> Case-Control Study</a></li>
<li class="chapter" data-level="16.22.9" data-path="epid.html"><a href="epid.html#screening-test"><i class="fa fa-check"></i><b>16.22.9</b> Screening Test</a></li>
<li class="chapter" data-level="16.22.10" data-path="epid.html"><a href="epid.html#additional-considerations"><i class="fa fa-check"></i><b>16.22.10</b> Additional Considerations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="nlp.html"><a href="nlp.html"><i class="fa fa-check"></i><b>17</b> 自然语言处理</a></li>
<li class="chapter" data-level="18" data-path="qi.html"><a href="qi.html"><i class="fa fa-check"></i><b>18</b> 量化投资</a><ul>
<li class="chapter" data-level="18.1" data-path="qi.html"><a href="qi.html#股票收益模型"><i class="fa fa-check"></i><b>18.1</b> 股票收益模型</a></li>
<li class="chapter" data-level="18.2" data-path="qi.html"><a href="qi.html#风险"><i class="fa fa-check"></i><b>18.2</b> 风险</a></li>
<li class="chapter" data-level="18.3" data-path="qi.html"><a href="qi.html#收益"><i class="fa fa-check"></i><b>18.3</b> 收益</a></li>
<li class="chapter" data-level="18.4" data-path="qi.html"><a href="qi.html#一般性投资"><i class="fa fa-check"></i><b>18.4</b> 一般性投资</a></li>
<li class="chapter" data-level="18.5" data-path="qi.html"><a href="qi.html#风险管理原理"><i class="fa fa-check"></i><b>18.5</b> 风险管理原理</a></li>
<li class="chapter" data-level="18.6" data-path="qi.html"><a href="qi.html#金融技术与发明"><i class="fa fa-check"></i><b>18.6</b> 金融技术与发明</a></li>
<li class="chapter" data-level="18.7" data-path="qi.html"><a href="qi.html#投资组合"><i class="fa fa-check"></i><b>18.7</b> 投资组合</a></li>
<li class="chapter" data-level="18.8" data-path="qi.html"><a href="qi.html#保险"><i class="fa fa-check"></i><b>18.8</b> 保险</a></li>
<li class="chapter" data-level="18.9" data-path="qi.html"><a href="qi.html#有效市场假说"><i class="fa fa-check"></i><b>18.9</b> 有效市场假说</a></li>
<li class="chapter" data-level="18.10" data-path="qi.html"><a href="qi.html#行为经济学"><i class="fa fa-check"></i><b>18.10</b> 行为经济学</a></li>
<li class="chapter" data-level="18.11" data-path="qi.html"><a href="qi.html#债券"><i class="fa fa-check"></i><b>18.11</b> 债券</a></li>
<li class="chapter" data-level="18.12" data-path="qi.html"><a href="qi.html#银行"><i class="fa fa-check"></i><b>18.12</b> 银行</a></li>
<li class="chapter" data-level="18.13" data-path="qi.html"><a href="qi.html#金融监管"><i class="fa fa-check"></i><b>18.13</b> 金融监管</a></li>
<li class="chapter" data-level="18.14" data-path="qi.html"><a href="qi.html#信用评级"><i class="fa fa-check"></i><b>18.14</b> 信用评级</a></li>
<li class="chapter" data-level="18.15" data-path="qi.html"><a href="qi.html#投行"><i class="fa fa-check"></i><b>18.15</b> 投行</a></li>
<li class="chapter" data-level="18.16" data-path="qi.html"><a href="qi.html#股票"><i class="fa fa-check"></i><b>18.16</b> 股票</a></li>
<li class="chapter" data-level="18.17" data-path="qi.html"><a href="qi.html#房产"><i class="fa fa-check"></i><b>18.17</b> 房产</a></li>
<li class="chapter" data-level="18.18" data-path="qi.html"><a href="qi.html#期货"><i class="fa fa-check"></i><b>18.18</b> 期货</a></li>
<li class="chapter" data-level="18.19" data-path="qi.html"><a href="qi.html#期权"><i class="fa fa-check"></i><b>18.19</b> 期权</a></li>
<li class="chapter" data-level="18.20" data-path="qi.html"><a href="qi.html#金融民主化"><i class="fa fa-check"></i><b>18.20</b> 金融民主化</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/yufree/datadown" target="blank">Github Repo</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">数据分析残卷</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bayes" class="section level1">
<h1><span class="header-section-number">第10章</span> 贝叶斯统计</h1>
<div id="贝塔分布" class="section level2">
<h2><span class="header-section-number">10.1</span> 贝塔分布</h2>
<ul>
<li><p>贝塔分布的本质是概率分布的分布</p></li>
<li><p>棒球击球率的预测问题，你不可能预测一个刚打出本垒下一个也击中，会有一个先验概率</p></li>
<li><p>这个概率可以用一个参数 <span class="math inline">\(\alpha\)</span> 与 <span class="math inline">\(\beta\)</span> 的贝塔分布来描述，例如一共打了300个球，81个击中，219个击空，那么 <span class="math inline">\(\alpha\)</span> 为81，<span class="math inline">\(\beta\)</span> 为219</p></li>
<li><p>均值为<span class="math inline">\(\frac{\alpha}{\alpha + \beta} = \frac{81}{81+219} = 0.27\)</span></p></li>
<li><p>概率密度分布图，从图上我们可以看出一个大约在0.2-0.35的概率区间，表示击球的先验概率空间可能的取值</p></li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb66-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">length=</span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb66-3" data-line-number="3">db &lt;-<span class="st"> </span><span class="kw">dbeta</span>(x, <span class="dv">81</span>, <span class="dv">219</span>)</a>
<a class="sourceLine" id="cb66-4" data-line-number="4"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(x,db)) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Density of beta&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/beta-1.png" width="672" /></p>
</div>
<div id="为什么击球的概率分布符合贝塔分布" class="section level2">
<h2><span class="header-section-number">10.2</span> 为什么击球的概率分布符合贝塔分布？</h2>
<ul>
<li>设想球员A打了一个球打中了，那么在没有先验知识的情况下我会认为他击中概率为1</li>
<li>这个球员又打中了一个球，那么还是1</li>
<li>但第三个没打中，我们会认为他击中概率是0吗？</li>
<li>一般而言，这类连续击球问题可以用二项分布来描述，例如10个球打中8个的概率，我们假设这个击球概率为q，那么这个概率应该是个q的函数：</li>
</ul>
<p><span class="math display">\[f(q) \propto q^a(1-q)^b\]</span></p>
<ul>
<li>q对于一个实际问题是确定的常数，所以出现这个场景的概率实际上是a与b的函数</li>
<li>为了保障这个概率函数累积为1，需要除一个跟a与b有关的数</li>
<li>这个数可以用贝塔函数<span class="math inline">\(B(a,b)\)</span>来表示，数学证明<a href="https://en.wikipedia.org/wiki/Conjugate_prior#Example">略</a></li>
<li>如果接着打了一个中了，那么如何更新这个概率？</li>
<li>根据贝叶斯公式，最后推导出的结果如下：</li>
</ul>
<p><span class="math display">\[Beta(\alpha+1,\beta+0)\]</span></p>
<ul>
<li>那么我们对这个击球率的估计就略高了一点，这是贝塔分布的神奇之处，形式非常简单，理解也很直观</li>
</ul>
</div>
<div id="先验与后验" class="section level2">
<h2><span class="header-section-number">10.3</span> 先验与后验</h2>
<ul>
<li>如果我们后续观察的击球少，那么不太容易影响到对概率的先验估计</li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">length=</span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb67-2" data-line-number="2">db &lt;-<span class="st"> </span><span class="kw">dbeta</span>(x, <span class="dv">81</span><span class="op">+</span><span class="dv">1</span>, <span class="dv">219</span>)</a>
<a class="sourceLine" id="cb67-3" data-line-number="3"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(x,db)) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Density of beta&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/beta1-1.png" width="672" /></p>
<ul>
<li>如果后续观察了大量的击球都中了，那么概率会偏向后面数据量的那一部分</li>
</ul>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">length=</span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb68-2" data-line-number="2">db &lt;-<span class="st"> </span><span class="kw">dbeta</span>(x, <span class="dv">81</span><span class="op">+</span><span class="dv">1000</span>, <span class="dv">219</span>)</a>
<a class="sourceLine" id="cb68-3" data-line-number="3"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(x,db)) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Density of beta&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/beta2-1.png" width="672" /></p>
<ul>
<li><p>这是贝叶斯分析的核心思想，通过证据更新经验</p></li>
<li><p>最后得到的均值（后验0.83）一定是介于经验值（先验0.27）与证据值（全击中就是1）之间</p></li>
<li><p>贝塔分布天然适合描述一个对概率的估计场景</p></li>
<li><p>另一种不那么严谨的理解方法是如果一个概率是稳定的，那么多次实验的结果差别不会太大，则有：</p></li>
</ul>
<p><span class="math display">\[\frac{a}{b} = \frac{c}{d} = \frac{a+b}{c+d}\]</span></p>
<ul>
<li>如果每次实验的概率持平，那么不存在不确定度；但如果前面实验的次数少而后面实验的次数多，那么概率会偏重于后面，这就是贝塔分布想说明的事</li>
</ul>
</div>
<div id="经验贝叶斯" class="section level2">
<h2><span class="header-section-number">10.4</span> 经验贝叶斯</h2>
<ul>
<li><p>对于两个球员，一个打了10个球中了4个，另一个打了1000个球中了300个，一般击中概率0.2，你会选哪一个？</p></li>
<li><p>我们对于小样本量的统计推断会有天然的不信任，如何通过统计量来描述？</p></li>
<li><p>下面用MLB的数据说明，首先提取出球员的击球数据：</p></li>
</ul>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb69-2" data-line-number="2"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb69-3" data-line-number="3"><span class="kw">library</span>(Lahman)</a>
<a class="sourceLine" id="cb69-4" data-line-number="4"><span class="co"># 拿到击球数据</span></a>
<a class="sourceLine" id="cb69-5" data-line-number="5">career &lt;-<span class="st"> </span>Batting <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb69-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb69-7" data-line-number="7"><span class="st">  </span><span class="kw">anti_join</span>(Pitching, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb69-8" data-line-number="8"><span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb69-9" data-line-number="9"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">H =</span> <span class="kw">sum</span>(H), <span class="dt">AB =</span> <span class="kw">sum</span>(AB)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb69-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">average =</span> H <span class="op">/</span><span class="st"> </span>AB)</a>
<a class="sourceLine" id="cb69-11" data-line-number="11"></a>
<a class="sourceLine" id="cb69-12" data-line-number="12"><span class="co"># 把ID换成球员名字</span></a>
<a class="sourceLine" id="cb69-13" data-line-number="13">career &lt;-<span class="st"> </span>Master <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb69-14" data-line-number="14"><span class="st">  </span><span class="kw">tbl_df</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb69-15" data-line-number="15"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(playerID, nameFirst, nameLast) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb69-16" data-line-number="16"><span class="st">  </span><span class="kw">unite</span>(name, nameFirst, nameLast, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb69-17" data-line-number="17"><span class="st">  </span><span class="kw">inner_join</span>(career, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb69-18" data-line-number="18"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>playerID)</a>
<a class="sourceLine" id="cb69-19" data-line-number="19"><span class="co"># 展示数据</span></a>
<a class="sourceLine" id="cb69-20" data-line-number="20">career</a></code></pre></div>
<pre><code>## # A tibble: 9,670 x 4
##    name                  H    AB average
##    &lt;chr&gt;             &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;
##  1 Hank Aaron         3771 12364  0.305 
##  2 Tommie Aaron        216   944  0.229 
##  3 Andy Abad             2    21  0.0952
##  4 John Abadie          11    49  0.224 
##  5 Ed Abbaticchio      772  3044  0.254 
##  6 Fred Abbott         107   513  0.209 
##  7 Jeff Abbott         157   596  0.263 
##  8 Kurt Abbott         523  2044  0.256 
##  9 Ody Abbott           13    70  0.186 
## 10 Frank Abercrombie     0     4  0     
## # … with 9,660 more rows</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1"><span class="co"># 击球前5</span></a>
<a class="sourceLine" id="cb71-2" data-line-number="2">career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb71-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(average)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb71-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb71-5" data-line-number="5"><span class="st">  </span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">H</th>
<th align="right">AB</th>
<th align="right">average</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Jeff Banister</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Doc Bass</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Steve Biras</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">C. B. Burns</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Jackie Gallagher</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1"><span class="co"># 击球后5</span></a>
<a class="sourceLine" id="cb72-2" data-line-number="2">career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb72-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(average) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb72-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb72-5" data-line-number="5"><span class="st">  </span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">H</th>
<th align="right">AB</th>
<th align="right">average</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Frank Abercrombie</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Horace Allen</td>
<td align="right">0</td>
<td align="right">7</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Pete Allen</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Walter Alston</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Bill Andrus</td>
<td align="right">0</td>
<td align="right">9</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<ul>
<li><p>如果仅考虑击球率会把很多板凳球员与运气球员包括进来，一个先验概率分布很有必要</p></li>
<li><p>那么考虑下如何得到，经验贝叶斯方法认为如果估计一个个体的参数，那么这个个体所在的整体的概率分布可作为先验概率分布</p></li>
<li><p>这个先验概率分布可以直接从数据中得到，然后我们要用极大似然或矩估计的方法拿到贝塔分布的两个参数：</p></li>
</ul>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1">career_filtered &lt;-<span class="st"> </span>career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb73-2" data-line-number="2"><span class="st">    </span><span class="kw">filter</span>(AB <span class="op">&gt;=</span><span class="st"> </span><span class="dv">500</span>)</a>
<a class="sourceLine" id="cb73-3" data-line-number="3"></a>
<a class="sourceLine" id="cb73-4" data-line-number="4">m &lt;-<span class="st"> </span>MASS<span class="op">::</span><span class="kw">fitdistr</span>(career_filtered<span class="op">$</span>average, dbeta,</a>
<a class="sourceLine" id="cb73-5" data-line-number="5">                    <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">shape1 =</span> <span class="dv">1</span>, <span class="dt">shape2 =</span> <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb73-6" data-line-number="6"></a>
<a class="sourceLine" id="cb73-7" data-line-number="7">alpha0 &lt;-<span class="st"> </span>m<span class="op">$</span>estimate[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb73-8" data-line-number="8">beta0 &lt;-<span class="st"> </span>m<span class="op">$</span>estimate[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb73-9" data-line-number="9"></a>
<a class="sourceLine" id="cb73-10" data-line-number="10"><span class="co"># 看下拟合效果</span></a>
<a class="sourceLine" id="cb73-11" data-line-number="11"></a>
<a class="sourceLine" id="cb73-12" data-line-number="12"><span class="kw">ggplot</span>(career_filtered) <span class="op">+</span></a>
<a class="sourceLine" id="cb73-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(average, <span class="dt">y =</span> ..density..), <span class="dt">binwidth =</span> <span class="fl">.005</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb73-14" data-line-number="14"><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> <span class="cf">function</span>(x) <span class="kw">dbeta</span>(x, alpha0, beta0), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>,</a>
<a class="sourceLine" id="cb73-15" data-line-number="15">                <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb73-16" data-line-number="16"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Batting average&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/ebayes-1.png" width="672" /></p>
</div>
<div id="从整体到个人" class="section level2">
<h2><span class="header-section-number">10.5</span> 从整体到个人</h2>
<ul>
<li><p>当我们估计个人的击球率时，整体可以作为先验函数，个人的数据可以通过贝塔分布更新到个体</p></li>
<li><p>那么如果一个人数据少，我们倾向于认为他是平均水平；数据多则认为符合个人表现</p></li>
<li><p>这事实上是一个分层结构，经验贝叶斯推断里隐含了这么一个从整体到个人的过程</p></li>
</ul>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">career_eb &lt;-<span class="st"> </span>career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb74-2" data-line-number="2"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">eb_estimate =</span> (H <span class="op">+</span><span class="st"> </span>alpha0) <span class="op">/</span><span class="st"> </span>(AB <span class="op">+</span><span class="st"> </span>alpha0 <span class="op">+</span><span class="st"> </span>beta0))</a>
<a class="sourceLine" id="cb74-3" data-line-number="3"><span class="co"># 击球率高</span></a>
<a class="sourceLine" id="cb74-4" data-line-number="4">career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb74-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(eb_estimate)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb74-6" data-line-number="6"><span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb74-7" data-line-number="7"><span class="st">  </span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">H</th>
<th align="right">AB</th>
<th align="right">average</th>
<th align="right">eb_estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Rogers Hornsby</td>
<td align="right">2930</td>
<td align="right">8173</td>
<td align="right">0.358</td>
<td align="right">0.355</td>
</tr>
<tr class="even">
<td align="left">Shoeless Joe Jackson</td>
<td align="right">1772</td>
<td align="right">4981</td>
<td align="right">0.356</td>
<td align="right">0.350</td>
</tr>
<tr class="odd">
<td align="left">Ed Delahanty</td>
<td align="right">2597</td>
<td align="right">7510</td>
<td align="right">0.346</td>
<td align="right">0.342</td>
</tr>
<tr class="even">
<td align="left">Billy Hamilton</td>
<td align="right">2164</td>
<td align="right">6283</td>
<td align="right">0.344</td>
<td align="right">0.340</td>
</tr>
<tr class="odd">
<td align="left">Harry Heilmann</td>
<td align="right">2660</td>
<td align="right">7787</td>
<td align="right">0.342</td>
<td align="right">0.338</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="co"># 击球率低</span></a>
<a class="sourceLine" id="cb75-2" data-line-number="2">career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(eb_estimate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-5" data-line-number="5"><span class="st">  </span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">H</th>
<th align="right">AB</th>
<th align="right">average</th>
<th align="right">eb_estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Bill Bergen</td>
<td align="right">516</td>
<td align="right">3028</td>
<td align="right">0.170</td>
<td align="right">0.179</td>
</tr>
<tr class="even">
<td align="left">Ray Oyler</td>
<td align="right">221</td>
<td align="right">1265</td>
<td align="right">0.175</td>
<td align="right">0.191</td>
</tr>
<tr class="odd">
<td align="left">John Vukovich</td>
<td align="right">90</td>
<td align="right">559</td>
<td align="right">0.161</td>
<td align="right">0.196</td>
</tr>
<tr class="even">
<td align="left">John Humphries</td>
<td align="right">52</td>
<td align="right">364</td>
<td align="right">0.143</td>
<td align="right">0.196</td>
</tr>
<tr class="odd">
<td align="left">George Baker</td>
<td align="right">74</td>
<td align="right">474</td>
<td align="right">0.156</td>
<td align="right">0.196</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="co"># 整体估计</span></a>
<a class="sourceLine" id="cb76-2" data-line-number="2"><span class="kw">ggplot</span>(career_eb, <span class="kw">aes</span>(average, eb_estimate, <span class="dt">color =</span> AB)) <span class="op">+</span></a>
<a class="sourceLine" id="cb76-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> alpha0 <span class="op">/</span><span class="st"> </span>(alpha0 <span class="op">+</span><span class="st"> </span>beta0), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb76-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb76-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb76-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_colour_gradient</span>(<span class="dt">trans =</span> <span class="st">&quot;log&quot;</span>, <span class="dt">breaks =</span> <span class="dv">10</span> <span class="op">^</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb76-7" data-line-number="7"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Batting average&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb76-8" data-line-number="8"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Empirical Bayes batting average&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/ebayes2-1.png" width="672" /></p>
<ul>
<li><p>数据点多会收缩到<span class="math inline">\(x=y\)</span>，也就是个人的击球率；数据点少则回归到整体击球率</p></li>
<li><p>这就是经验贝叶斯方法的全貌：先估计整体的参数，然后把整体参数作为先验概率估计个人参数</p></li>
</ul>
</div>
<div id="可信区间与置信区间" class="section level2">
<h2><span class="header-section-number">10.6</span> 可信区间与置信区间</h2>
<ul>
<li><p>经验贝叶斯可以给出点估计，但现实中我们可能更关心区间估计</p></li>
<li><p>一般这类区间估计可以用二项式比例估计来进行，不过没有先验经验的限制置信区间大到没意义</p></li>
<li><p>经验贝叶斯会给出一个后验分布，这个分布可以用来求可信区间</p></li>
</ul>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb77-2" data-line-number="2"><span class="co"># 给出后验分布</span></a>
<a class="sourceLine" id="cb77-3" data-line-number="3">career &lt;-<span class="st"> </span>Batting <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-5" data-line-number="5"><span class="st">  </span><span class="kw">anti_join</span>(Pitching, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-6" data-line-number="6"><span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-7" data-line-number="7"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">H =</span> <span class="kw">sum</span>(H), <span class="dt">AB =</span> <span class="kw">sum</span>(AB)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">average =</span> H <span class="op">/</span><span class="st"> </span>AB)</a>
<a class="sourceLine" id="cb77-9" data-line-number="9"></a>
<a class="sourceLine" id="cb77-10" data-line-number="10">career &lt;-<span class="st"> </span>Master <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-11" data-line-number="11"><span class="st">  </span><span class="kw">tbl_df</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-12" data-line-number="12"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(playerID, nameFirst, nameLast) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-13" data-line-number="13"><span class="st">  </span><span class="kw">unite</span>(name, nameFirst, nameLast, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-14" data-line-number="14"><span class="st">  </span><span class="kw">inner_join</span>(career, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>)</a>
<a class="sourceLine" id="cb77-15" data-line-number="15"></a>
<a class="sourceLine" id="cb77-16" data-line-number="16">career0 &lt;-<span class="st"> </span>Batting <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-17" data-line-number="17"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-18" data-line-number="18"><span class="st">  </span><span class="kw">anti_join</span>(Pitching, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-19" data-line-number="19"><span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-20" data-line-number="20"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">H =</span> <span class="kw">sum</span>(H), <span class="dt">AB =</span> <span class="kw">sum</span>(AB), <span class="dt">year =</span> <span class="kw">mean</span>(yearID)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-21" data-line-number="21"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">average =</span> H <span class="op">/</span><span class="st"> </span>AB)</a>
<a class="sourceLine" id="cb77-22" data-line-number="22"></a>
<a class="sourceLine" id="cb77-23" data-line-number="23">career2 &lt;-<span class="st"> </span>Master <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-24" data-line-number="24"><span class="st">  </span><span class="kw">tbl_df</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-25" data-line-number="25"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(playerID, nameFirst, nameLast, bats) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-26" data-line-number="26"><span class="st">  </span><span class="kw">unite</span>(name, nameFirst, nameLast, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-27" data-line-number="27"><span class="st">  </span><span class="kw">inner_join</span>(career0, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>)</a>
<a class="sourceLine" id="cb77-28" data-line-number="28"></a>
<a class="sourceLine" id="cb77-29" data-line-number="29">career_eb &lt;-<span class="st"> </span>career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-30" data-line-number="30"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">eb_estimate =</span> (H <span class="op">+</span><span class="st"> </span>alpha0) <span class="op">/</span><span class="st"> </span>(AB <span class="op">+</span><span class="st"> </span>alpha0 <span class="op">+</span><span class="st"> </span>beta0))</a>
<a class="sourceLine" id="cb77-31" data-line-number="31">career_eb &lt;-<span class="st"> </span>career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-32" data-line-number="32"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">alpha1 =</span> H <span class="op">+</span><span class="st"> </span>alpha0,</a>
<a class="sourceLine" id="cb77-33" data-line-number="33">           <span class="dt">beta1 =</span> AB <span class="op">-</span><span class="st"> </span>H <span class="op">+</span><span class="st"> </span>beta0)</a>
<a class="sourceLine" id="cb77-34" data-line-number="34"><span class="co"># 提取洋基队的数据</span></a>
<a class="sourceLine" id="cb77-35" data-line-number="35">yankee_<span class="dv">1998</span> &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;brosisc01&quot;</span>, <span class="st">&quot;jeterde01&quot;</span>, <span class="st">&quot;knoblch01&quot;</span>, <span class="st">&quot;martiti02&quot;</span>, <span class="st">&quot;posadjo01&quot;</span>, <span class="st">&quot;strawda01&quot;</span>, <span class="st">&quot;willibe02&quot;</span>)</a>
<a class="sourceLine" id="cb77-36" data-line-number="36"></a>
<a class="sourceLine" id="cb77-37" data-line-number="37">yankee_<span class="dv">1998</span>_career &lt;-<span class="st"> </span>career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-38" data-line-number="38"><span class="st">    </span><span class="kw">filter</span>(playerID <span class="op">%in%</span><span class="st"> </span>yankee_<span class="dv">1998</span>)</a>
<a class="sourceLine" id="cb77-39" data-line-number="39"></a>
<a class="sourceLine" id="cb77-40" data-line-number="40"><span class="co"># 提取可信区间</span></a>
<a class="sourceLine" id="cb77-41" data-line-number="41">yankee_<span class="dv">1998</span>_career &lt;-<span class="st"> </span>yankee_<span class="dv">1998</span>_career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-42" data-line-number="42"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">low  =</span> <span class="kw">qbeta</span>(.<span class="dv">025</span>, alpha1, beta1),</a>
<a class="sourceLine" id="cb77-43" data-line-number="43">           <span class="dt">high =</span> <span class="kw">qbeta</span>(.<span class="dv">975</span>, alpha1, beta1))</a>
<a class="sourceLine" id="cb77-44" data-line-number="44">yankee_<span class="dv">1998</span>_career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-45" data-line-number="45"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>alpha1, <span class="op">-</span>beta1, <span class="op">-</span>eb_estimate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-46" data-line-number="46"><span class="st">    </span>knitr<span class="op">::</span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">playerID</th>
<th align="left">name</th>
<th align="right">H</th>
<th align="right">AB</th>
<th align="right">average</th>
<th align="right">low</th>
<th align="right">high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">brosisc01</td>
<td align="left">Scott Brosius</td>
<td align="right">1001</td>
<td align="right">3889</td>
<td align="right">0.257</td>
<td align="right">0.244</td>
<td align="right">0.271</td>
</tr>
<tr class="even">
<td align="left">jeterde01</td>
<td align="left">Derek Jeter</td>
<td align="right">3465</td>
<td align="right">11195</td>
<td align="right">0.310</td>
<td align="right">0.300</td>
<td align="right">0.317</td>
</tr>
<tr class="odd">
<td align="left">knoblch01</td>
<td align="left">Chuck Knoblauch</td>
<td align="right">1839</td>
<td align="right">6366</td>
<td align="right">0.289</td>
<td align="right">0.277</td>
<td align="right">0.298</td>
</tr>
<tr class="even">
<td align="left">martiti02</td>
<td align="left">Tino Martinez</td>
<td align="right">1925</td>
<td align="right">7111</td>
<td align="right">0.271</td>
<td align="right">0.260</td>
<td align="right">0.280</td>
</tr>
<tr class="odd">
<td align="left">posadjo01</td>
<td align="left">Jorge Posada</td>
<td align="right">1664</td>
<td align="right">6092</td>
<td align="right">0.273</td>
<td align="right">0.262</td>
<td align="right">0.283</td>
</tr>
<tr class="even">
<td align="left">strawda01</td>
<td align="left">Darryl Strawberry</td>
<td align="right">1401</td>
<td align="right">5418</td>
<td align="right">0.259</td>
<td align="right">0.247</td>
<td align="right">0.270</td>
</tr>
<tr class="odd">
<td align="left">willibe02</td>
<td align="left">Bernie Williams</td>
<td align="right">2336</td>
<td align="right">7869</td>
<td align="right">0.297</td>
<td align="right">0.286</td>
<td align="right">0.305</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="co"># 绘制可信区间</span></a>
<a class="sourceLine" id="cb78-2" data-line-number="2">yankee_<span class="dv">1998</span>_career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb78-3" data-line-number="3"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">reorder</span>(name, average)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb78-4" data-line-number="4"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(average, name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb78-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb78-6" data-line-number="6"><span class="st">    </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> low, <span class="dt">xmax =</span> high)) <span class="op">+</span></a>
<a class="sourceLine" id="cb78-7" data-line-number="7"><span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> alpha0 <span class="op">/</span><span class="st"> </span>(alpha0 <span class="op">+</span><span class="st"> </span>beta0), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb78-8" data-line-number="8"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Estimated batting average (w/ 95% interval)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb78-9" data-line-number="9"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Player&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/ci-1.png" width="672" /></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="co"># 对比置信区间与可信区间</span></a>
<a class="sourceLine" id="cb79-2" data-line-number="2">career_eb &lt;-<span class="st"> </span>career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-3" data-line-number="3"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">low =</span> <span class="kw">qbeta</span>(.<span class="dv">025</span>, alpha1, beta1),</a>
<a class="sourceLine" id="cb79-4" data-line-number="4">           <span class="dt">high =</span> <span class="kw">qbeta</span>(.<span class="dv">975</span>, alpha1, beta1))</a>
<a class="sourceLine" id="cb79-5" data-line-number="5"></a>
<a class="sourceLine" id="cb79-6" data-line-number="6"><span class="kw">set.seed</span>(<span class="dv">2016</span>)</a>
<a class="sourceLine" id="cb79-7" data-line-number="7"></a>
<a class="sourceLine" id="cb79-8" data-line-number="8">some &lt;-<span class="st"> </span>career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-9" data-line-number="9"><span class="st">    </span><span class="kw">sample_n</span>(<span class="dv">20</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-10" data-line-number="10"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">paste0</span>(name, <span class="st">&quot; (&quot;</span>, H, <span class="st">&quot;/&quot;</span>, AB, <span class="st">&quot;)&quot;</span>))</a>
<a class="sourceLine" id="cb79-11" data-line-number="11"></a>
<a class="sourceLine" id="cb79-12" data-line-number="12">frequentist &lt;-<span class="st"> </span>some <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-13" data-line-number="13"><span class="st">    </span><span class="kw">group_by</span>(playerID, name, AB) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-14" data-line-number="14"><span class="st">    </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">binom.test</span>(.<span class="op">$</span>H, .<span class="op">$</span>AB))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-15" data-line-number="15"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(playerID, name, estimate, <span class="dt">low =</span> conf.low, <span class="dt">high =</span> conf.high) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-16" data-line-number="16"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">method =</span> <span class="st">&quot;Confidence&quot;</span>)</a>
<a class="sourceLine" id="cb79-17" data-line-number="17"></a>
<a class="sourceLine" id="cb79-18" data-line-number="18">bayesian &lt;-<span class="st"> </span>some <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-19" data-line-number="19"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(playerID, name, AB, <span class="dt">estimate =</span> eb_estimate,</a>
<a class="sourceLine" id="cb79-20" data-line-number="20">           <span class="dt">low =</span> low, <span class="dt">high =</span> high) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-21" data-line-number="21"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">method =</span> <span class="st">&quot;Credible&quot;</span>)</a>
<a class="sourceLine" id="cb79-22" data-line-number="22"></a>
<a class="sourceLine" id="cb79-23" data-line-number="23">combined &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(frequentist, bayesian)</a>
<a class="sourceLine" id="cb79-24" data-line-number="24"></a>
<a class="sourceLine" id="cb79-25" data-line-number="25">combined <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-26" data-line-number="26"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">name2 =</span> <span class="kw">reorder</span>(name, <span class="op">-</span>AB)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-27" data-line-number="27"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(estimate, name2, <span class="dt">color =</span> method, <span class="dt">group =</span> method)) <span class="op">+</span></a>
<a class="sourceLine" id="cb79-28" data-line-number="28"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb79-29" data-line-number="29"><span class="st">    </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> low, <span class="dt">xmax =</span> high)) <span class="op">+</span></a>
<a class="sourceLine" id="cb79-30" data-line-number="30"><span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> alpha0 <span class="op">/</span><span class="st"> </span>(alpha0 <span class="op">+</span><span class="st"> </span>beta0), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb79-31" data-line-number="31"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Estimated batting average&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb79-32" data-line-number="32"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Player&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb79-33" data-line-number="33"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">color =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/ci-2.png" width="672" /></p>
<ul>
<li>可信区间与置信区间很大的区别在于前者考虑了先验概率进而实现了区间的收缩，后者则可看作无先验贝塔分布给出的区间估计，频率学派目前没有很好的收缩区间估计的方法</li>
</ul>
</div>
<div id="后验错误率" class="section level2">
<h2><span class="header-section-number">10.7</span> 后验错误率</h2>
<ul>
<li>现实问题经常不局限于估计，而是侧重决策，例如如果一个球员的击球率高于某个值，他就可以进入名人堂（击球率大于0.3），这个决策常常伴随区间估计而不是简单的点估计</li>
</ul>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="co"># 以 Hank Aaron 为例</span></a>
<a class="sourceLine" id="cb80-2" data-line-number="2">career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb80-3" data-line-number="3"><span class="st">    </span><span class="kw">filter</span>(name <span class="op">==</span><span class="st"> &quot;Hank Aaron&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb80-4" data-line-number="4"><span class="st">    </span><span class="kw">do</span>(<span class="kw">data_frame</span>(<span class="dt">x =</span> <span class="kw">seq</span>(.<span class="dv">27</span>, <span class="fl">.33</span>, <span class="fl">.0002</span>),</a>
<a class="sourceLine" id="cb80-5" data-line-number="5">                  <span class="dt">density =</span> <span class="kw">dbeta</span>(x, .<span class="op">$</span>alpha1, .<span class="op">$</span>beta1))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb80-6" data-line-number="6"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, density)) <span class="op">+</span></a>
<a class="sourceLine" id="cb80-7" data-line-number="7"><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb80-8" data-line-number="8"><span class="st">    </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> density <span class="op">*</span><span class="st"> </span>(x <span class="op">&lt;</span><span class="st"> </span><span class="fl">.3</span>)),</a>
<a class="sourceLine" id="cb80-9" data-line-number="9">                <span class="dt">alpha =</span> <span class="fl">.1</span>, <span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb80-10" data-line-number="10"><span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">xintercept =</span> <span class="fl">.3</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/lp-1.png" width="672" /></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1"><span class="co"># 提取该球员数据</span></a>
<a class="sourceLine" id="cb81-2" data-line-number="2">career_eb <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(name <span class="op">==</span><span class="st"> &quot;Hank Aaron&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 10
##   playerID  name           H    AB average eb_estimate alpha1 beta1   low  high
##   &lt;chr&gt;     &lt;chr&gt;      &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 aaronha01 Hank Aaron  3771 12364   0.305       0.304  3851. 8821. 0.296 0.312</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="co"># 计算其不进入名人堂的概率</span></a>
<a class="sourceLine" id="cb83-2" data-line-number="2"><span class="kw">pbeta</span>(.<span class="dv">3</span>, <span class="dv">3850</span>, <span class="dv">8818</span>)</a></code></pre></div>
<pre><code>## [1] 0.169</code></pre>
<ul>
<li><p>后验错误率（Posterior Error Probability）可类比经典假设检验中的显著性水平<span class="math inline">\(\alpha\)</span></p></li>
<li><p>后验包括率（Posterior Inclusion Probability）可类比经典假设检验中的置信水平<span class="math inline">\(1-\alpha\)</span></p></li>
</ul>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1"><span class="co"># 所有球员的后验错误率分布，大部分不超过0.3</span></a>
<a class="sourceLine" id="cb85-2" data-line-number="2">career_eb &lt;-<span class="st"> </span>career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb85-3" data-line-number="3"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">PEP =</span> <span class="kw">pbeta</span>(.<span class="dv">3</span>, alpha1, beta1))</a>
<a class="sourceLine" id="cb85-4" data-line-number="4"><span class="kw">ggplot</span>(career_eb, <span class="kw">aes</span>(PEP)) <span class="op">+</span></a>
<a class="sourceLine" id="cb85-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">.02</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb85-6" data-line-number="6"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Posterior Error Probability (PEP)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb85-7" data-line-number="7"><span class="st">    </span><span class="kw">xlim</span>(<span class="dv">0</span>, <span class="dv">1</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/ap-1.png" width="672" /></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="co"># 后验错误率与击球率的关系</span></a>
<a class="sourceLine" id="cb86-2" data-line-number="2">career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb86-3" data-line-number="3"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(eb_estimate, PEP, <span class="dt">color =</span> AB)) <span class="op">+</span></a>
<a class="sourceLine" id="cb86-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb86-5" data-line-number="5"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;(Shrunken) batting average estimate&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb86-6" data-line-number="6"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Posterior Error Probability (PEP)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb86-7" data-line-number="7"><span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">xintercept =</span> <span class="fl">.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb86-8" data-line-number="8"><span class="st">    </span><span class="kw">scale_colour_gradient</span>(<span class="dt">trans =</span> <span class="st">&quot;log&quot;</span>, <span class="dt">breaks =</span> <span class="dv">10</span> <span class="op">^</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>))</a></code></pre></div>
<p><img src="datadown_files/figure-html/ap-2.png" width="672" /></p>
<ul>
<li>后验错误率高于0.3的多数是击球率与击球数都高的人，因为贝叶斯方法惩罚了击球数低的人</li>
</ul>
</div>
<div id="错误发现率" class="section level2">
<h2><span class="header-section-number">10.8</span> 错误发现率</h2>
<ul>
<li><p>错误发现率（FDR）可用来控制一个整体决策，保证整体犯错的概率低于某个数值，错误发现率越高，越可能把假阳性包括进来</p></li>
<li><p>假如我们把进入名人堂的决策作为一个整体，则可允许一定的整体错误率，因为每个人的后验错误率可以计算且期望值线性可加和，我们可以得到一个整体的错误率</p></li>
</ul>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1"><span class="co"># 取前100个球员</span></a>
<a class="sourceLine" id="cb87-2" data-line-number="2">top_players &lt;-<span class="st"> </span>career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-3" data-line-number="3"><span class="st">    </span><span class="kw">arrange</span>(PEP) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-4" data-line-number="4"><span class="st">    </span><span class="kw">head</span>(<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb87-5" data-line-number="5"><span class="co"># 总错率率</span></a>
<a class="sourceLine" id="cb87-6" data-line-number="6"><span class="kw">sum</span>(top_players<span class="op">$</span>PEP)</a></code></pre></div>
<pre><code>## [1] 5.17</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1"><span class="co"># 平均错误率</span></a>
<a class="sourceLine" id="cb89-2" data-line-number="2"><span class="kw">mean</span>(top_players<span class="op">$</span>PEP)</a></code></pre></div>
<pre><code>## [1] 0.0517</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="co"># 错误率随所取球员的变化</span></a>
<a class="sourceLine" id="cb91-2" data-line-number="2">sorted_PEP &lt;-<span class="st"> </span>career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb91-3" data-line-number="3"><span class="st">    </span><span class="kw">arrange</span>(PEP)</a>
<a class="sourceLine" id="cb91-4" data-line-number="4"></a>
<a class="sourceLine" id="cb91-5" data-line-number="5"><span class="kw">mean</span>(<span class="kw">head</span>(sorted_PEP<span class="op">$</span>PEP, <span class="dv">50</span>))</a></code></pre></div>
<pre><code>## [1] 0.00189</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="kw">mean</span>(<span class="kw">head</span>(sorted_PEP<span class="op">$</span>PEP, <span class="dv">200</span>))</a></code></pre></div>
<pre><code>## [1] 0.25</code></pre>
<ul>
<li>错误率在排序后前面低后面高，但这个错误率不特指某个球员，而是包含到某个球员的整体犯错的概率</li>
</ul>
</div>
<div id="q值" class="section level2">
<h2><span class="header-section-number">10.9</span> q值</h2>
<ul>
<li>q值定义为排序后累积到某个样本的整体平均错误率，类似多重比较中对整体错误率控制的p值</li>
</ul>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="co"># 生成每个球员的q值</span></a>
<a class="sourceLine" id="cb95-2" data-line-number="2">career_eb &lt;-<span class="st"> </span>career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb95-3" data-line-number="3"><span class="st">    </span><span class="kw">arrange</span>(PEP) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb95-4" data-line-number="4"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">qvalue =</span> <span class="kw">cummean</span>(PEP))</a>
<a class="sourceLine" id="cb95-5" data-line-number="5"><span class="co"># 观察不同q值对名人堂球员数的影响</span></a>
<a class="sourceLine" id="cb95-6" data-line-number="6">career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb95-7" data-line-number="7"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(qvalue, <span class="kw">rank</span>(PEP))) <span class="op">+</span></a>
<a class="sourceLine" id="cb95-8" data-line-number="8"><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb95-9" data-line-number="9"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;q-value cutoff&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb95-10" data-line-number="10"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Number of players included&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/qvalue-1.png" width="672" /></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="co"># 观察小q值部分</span></a>
<a class="sourceLine" id="cb96-2" data-line-number="2">career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb96-3" data-line-number="3"><span class="st">    </span><span class="kw">filter</span>(qvalue <span class="op">&lt;</span><span class="st"> </span><span class="fl">.25</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb96-4" data-line-number="4"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(qvalue, <span class="kw">rank</span>(PEP))) <span class="op">+</span></a>
<a class="sourceLine" id="cb96-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb96-6" data-line-number="6"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;q-value cutoff&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb96-7" data-line-number="7"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Number of players included&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/qvalue-2.png" width="672" /></p>
<ul>
<li><p>200个人进入名人堂可能有约1/4的球员不合适，如果是50个人进入名人堂那么基本不会犯错</p></li>
<li><p>q值是一个整体而非个体的平均错误率，具有累积性，不代表q值大的那一个就是错的</p></li>
<li><p>q值在频率学派的多重比较里也有定义，虽然没有空假设（有先验概率），但实质等同</p></li>
</ul>
</div>
<div id="贝叶斯视角的假设检验" class="section level2">
<h2><span class="header-section-number">10.10</span> 贝叶斯视角的假设检验</h2>
<ul>
<li><p>前面描述的是击球率如何求，如何进行区间估计与多个体的错误率控制，面向的个体或整体，那么如何解决比较问题</p></li>
<li><p>设想多个球员，我们考虑如何去比较他们击球率。如果两个球员击球率的概率密度曲线比较接近，那么即便均值有不同我们也无法进行区分；如果重叠比较少，那么我们有理由认为他们之间的差异显著</p></li>
<li><p>贝叶斯视角下如何定量描述这个差异是否显著？</p></li>
</ul>
<div id="模拟验证" class="section level3">
<h3><span class="header-section-number">10.10.1</span> 模拟验证</h3>
<ul>
<li>单纯取样比大小然后计算比例</li>
</ul>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1"><span class="co"># 提取两人数据</span></a>
<a class="sourceLine" id="cb97-2" data-line-number="2">aaron &lt;-<span class="st"> </span>career_eb <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(name <span class="op">==</span><span class="st"> &quot;Hank Aaron&quot;</span>)</a>
<a class="sourceLine" id="cb97-3" data-line-number="3">piazza &lt;-<span class="st"> </span>career_eb <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(name <span class="op">==</span><span class="st"> &quot;Mike Piazza&quot;</span>)</a>
<a class="sourceLine" id="cb97-4" data-line-number="4"><span class="co"># 模拟取样10万次</span></a>
<a class="sourceLine" id="cb97-5" data-line-number="5">piazza_simulation &lt;-<span class="st"> </span><span class="kw">rbeta</span>(<span class="fl">1e6</span>, piazza<span class="op">$</span>alpha1, piazza<span class="op">$</span>beta1)</a>
<a class="sourceLine" id="cb97-6" data-line-number="6">aaron_simulation &lt;-<span class="st"> </span><span class="kw">rbeta</span>(<span class="fl">1e6</span>, aaron<span class="op">$</span>alpha1, aaron<span class="op">$</span>beta1)</a>
<a class="sourceLine" id="cb97-7" data-line-number="7"><span class="co"># 计算一个人超过另一个人的概率</span></a>
<a class="sourceLine" id="cb97-8" data-line-number="8">sim &lt;-<span class="st"> </span><span class="kw">mean</span>(piazza_simulation <span class="op">&gt;</span><span class="st"> </span>aaron_simulation)</a>
<a class="sourceLine" id="cb97-9" data-line-number="9">sim</a></code></pre></div>
<pre><code>## [1] 0.605</code></pre>
</div>
<div id="数值积分" class="section level3">
<h3><span class="header-section-number">10.10.2</span> 数值积分</h3>
<ul>
<li>两个概率的联合概率分布，然后积分一个队员大于另一个的概率</li>
</ul>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1">d &lt;-<span class="st"> </span><span class="fl">.00002</span></a>
<a class="sourceLine" id="cb99-2" data-line-number="2">limits &lt;-<span class="st"> </span><span class="kw">seq</span>(.<span class="dv">29</span>, <span class="fl">.33</span>, d)</a>
<a class="sourceLine" id="cb99-3" data-line-number="3"><span class="kw">sum</span>(<span class="kw">outer</span>(limits, limits, <span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb99-4" data-line-number="4">  (x <span class="op">&gt;</span><span class="st"> </span>y) <span class="op">*</span></a>
<a class="sourceLine" id="cb99-5" data-line-number="5"><span class="st">    </span><span class="kw">dbeta</span>(x, piazza<span class="op">$</span>alpha1, piazza<span class="op">$</span>beta1) <span class="op">*</span></a>
<a class="sourceLine" id="cb99-6" data-line-number="6"><span class="st">    </span><span class="kw">dbeta</span>(y, aaron<span class="op">$</span>alpha1, aaron<span class="op">$</span>beta1) <span class="op">*</span></a>
<a class="sourceLine" id="cb99-7" data-line-number="7"><span class="st">    </span>d <span class="op">^</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb99-8" data-line-number="8">}))</a></code></pre></div>
<pre><code>## [1] 0.604</code></pre>
</div>
<div id="解析解" class="section level3">
<h3><span class="header-section-number">10.10.3</span> 解析解</h3>
<ul>
<li>两个贝塔分布一个比另一个高是有含有贝塔函数的解析解的：</li>
</ul>
<p><span class="math display">\[p_A \sim \mbox{Beta}(\alpha_A, \beta_A)\]</span></p>
<p><span class="math display">\[p_B \sim \mbox{Beta}(\alpha_B, \beta_B)\]</span></p>
<p><span class="math display">\[{\rm Pr}(p_B &gt; p_A) = \sum_{i=0}^{\alpha_B-1}\frac{B(\alpha_A+i,\beta_A+\beta_B)}{(\beta_B+i) B(1+i, \beta_B) B(\alpha_A, \beta_A) }\]</span></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1">h &lt;-<span class="st"> </span><span class="cf">function</span>(alpha_a, beta_a,</a>
<a class="sourceLine" id="cb101-2" data-line-number="2">              alpha_b, beta_b) {</a>
<a class="sourceLine" id="cb101-3" data-line-number="3">  j &lt;-<span class="st"> </span><span class="kw">seq.int</span>(<span class="dv">0</span>, <span class="kw">round</span>(alpha_b) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb101-4" data-line-number="4">  log_vals &lt;-<span class="st"> </span>(<span class="kw">lbeta</span>(alpha_a <span class="op">+</span><span class="st"> </span>j, beta_a <span class="op">+</span><span class="st"> </span>beta_b) <span class="op">-</span><span class="st"> </span><span class="kw">log</span>(beta_b <span class="op">+</span><span class="st"> </span>j) <span class="op">-</span></a>
<a class="sourceLine" id="cb101-5" data-line-number="5"><span class="st">               </span><span class="kw">lbeta</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>j, beta_b) <span class="op">-</span><span class="st"> </span><span class="kw">lbeta</span>(alpha_a, beta_a))</a>
<a class="sourceLine" id="cb101-6" data-line-number="6">  <span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">exp</span>(log_vals))</a>
<a class="sourceLine" id="cb101-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb101-8" data-line-number="8"></a>
<a class="sourceLine" id="cb101-9" data-line-number="9"><span class="kw">h</span>(piazza<span class="op">$</span>alpha1, piazza<span class="op">$</span>beta1,</a>
<a class="sourceLine" id="cb101-10" data-line-number="10">  aaron<span class="op">$</span>alpha1, aaron<span class="op">$</span>beta1)</a></code></pre></div>
<pre><code>## [1] 0.603</code></pre>
</div>
<div id="正态近似求解" class="section level3">
<h3><span class="header-section-number">10.10.4</span> 正态近似求解</h3>
<ul>
<li>贝塔分布在<span class="math inline">\(\alpha\)</span>与<span class="math inline">\(\beta\)</span>比较大时接近正态分布，可以直接用正态分布的解析解求，速度快很多</li>
</ul>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1">h_approx &lt;-<span class="st"> </span><span class="cf">function</span>(alpha_a, beta_a,</a>
<a class="sourceLine" id="cb103-2" data-line-number="2">                     alpha_b, beta_b) {</a>
<a class="sourceLine" id="cb103-3" data-line-number="3">  u1 &lt;-<span class="st"> </span>alpha_a <span class="op">/</span><span class="st"> </span>(alpha_a <span class="op">+</span><span class="st"> </span>beta_a)</a>
<a class="sourceLine" id="cb103-4" data-line-number="4">  u2 &lt;-<span class="st"> </span>alpha_b <span class="op">/</span><span class="st"> </span>(alpha_b <span class="op">+</span><span class="st"> </span>beta_b)</a>
<a class="sourceLine" id="cb103-5" data-line-number="5">  var1 &lt;-<span class="st"> </span>alpha_a <span class="op">*</span><span class="st"> </span>beta_a <span class="op">/</span><span class="st"> </span>((alpha_a <span class="op">+</span><span class="st"> </span>beta_a) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(alpha_a <span class="op">+</span><span class="st"> </span>beta_a <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb103-6" data-line-number="6">  var2 &lt;-<span class="st"> </span>alpha_b <span class="op">*</span><span class="st"> </span>beta_b <span class="op">/</span><span class="st"> </span>((alpha_b <span class="op">+</span><span class="st"> </span>beta_b) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(alpha_b <span class="op">+</span><span class="st"> </span>beta_b <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb103-7" data-line-number="7">  <span class="kw">pnorm</span>(<span class="dv">0</span>, u2 <span class="op">-</span><span class="st"> </span>u1, <span class="kw">sqrt</span>(var1 <span class="op">+</span><span class="st"> </span>var2))</a>
<a class="sourceLine" id="cb103-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb103-9" data-line-number="9"></a>
<a class="sourceLine" id="cb103-10" data-line-number="10"><span class="kw">h_approx</span>(piazza<span class="op">$</span>alpha1, piazza<span class="op">$</span>beta1, aaron<span class="op">$</span>alpha1, aaron<span class="op">$</span>beta1)</a></code></pre></div>
<pre><code>## [1] 0.605</code></pre>
</div>
</div>
<div id="比例检验" class="section level2">
<h2><span class="header-section-number">10.11</span> 比例检验</h2>
<ul>
<li>这是个列联表问题，频率学派对比两个比例</li>
</ul>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1">two_players &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(aaron, piazza)</a>
<a class="sourceLine" id="cb105-2" data-line-number="2"></a>
<a class="sourceLine" id="cb105-3" data-line-number="3">two_players <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb105-4" data-line-number="4"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">Player =</span> name, <span class="dt">Hits =</span> H, <span class="dt">Misses =</span> AB <span class="op">-</span><span class="st"> </span>H) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb105-5" data-line-number="5"><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Player</th>
<th align="right">Hits</th>
<th align="right">Misses</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Hank Aaron</td>
<td align="right">3771</td>
<td align="right">8593</td>
</tr>
<tr class="even">
<td align="left">Mike Piazza</td>
<td align="right">2127</td>
<td align="right">4784</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1"><span class="kw">prop.test</span>(two_players<span class="op">$</span>H, two_players<span class="op">$</span>AB)</a></code></pre></div>
<pre><code>## 
##  2-sample test for equality of proportions with continuity correction
## 
## data:  two_players$H out of two_players$AB
## X-squared = 0.1, df = 1, p-value = 0.7
## alternative hypothesis: two.sided
## 95 percent confidence interval:
##  -0.0165  0.0109
## sample estimates:
## prop 1 prop 2 
##  0.305  0.308</code></pre>
<ul>
<li>贝叶斯学派对比两个比例</li>
</ul>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1">credible_interval_approx &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c, d) {</a>
<a class="sourceLine" id="cb108-2" data-line-number="2">  u1 &lt;-<span class="st"> </span>a <span class="op">/</span><span class="st"> </span>(a <span class="op">+</span><span class="st"> </span>b)</a>
<a class="sourceLine" id="cb108-3" data-line-number="3">  u2 &lt;-<span class="st"> </span>c <span class="op">/</span><span class="st"> </span>(c <span class="op">+</span><span class="st"> </span>d)</a>
<a class="sourceLine" id="cb108-4" data-line-number="4">  var1 &lt;-<span class="st"> </span>a <span class="op">*</span><span class="st"> </span>b <span class="op">/</span><span class="st"> </span>((a <span class="op">+</span><span class="st"> </span>b) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(a <span class="op">+</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb108-5" data-line-number="5">  var2 &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span>d <span class="op">/</span><span class="st"> </span>((c <span class="op">+</span><span class="st"> </span>d) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(c <span class="op">+</span><span class="st"> </span>d <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb108-6" data-line-number="6"></a>
<a class="sourceLine" id="cb108-7" data-line-number="7">  mu_diff &lt;-<span class="st"> </span>u2 <span class="op">-</span><span class="st"> </span>u1</a>
<a class="sourceLine" id="cb108-8" data-line-number="8">  sd_diff &lt;-<span class="st"> </span><span class="kw">sqrt</span>(var1 <span class="op">+</span><span class="st"> </span>var2)</a>
<a class="sourceLine" id="cb108-9" data-line-number="9"></a>
<a class="sourceLine" id="cb108-10" data-line-number="10">  <span class="kw">data_frame</span>(<span class="dt">posterior =</span> <span class="kw">pnorm</span>(<span class="dv">0</span>, mu_diff, sd_diff),</a>
<a class="sourceLine" id="cb108-11" data-line-number="11">             <span class="dt">estimate =</span> mu_diff,</a>
<a class="sourceLine" id="cb108-12" data-line-number="12">             <span class="dt">conf.low =</span> <span class="kw">qnorm</span>(.<span class="dv">025</span>, mu_diff, sd_diff),</a>
<a class="sourceLine" id="cb108-13" data-line-number="13">             <span class="dt">conf.high =</span> <span class="kw">qnorm</span>(.<span class="dv">975</span>, mu_diff, sd_diff))</a>
<a class="sourceLine" id="cb108-14" data-line-number="14">}</a>
<a class="sourceLine" id="cb108-15" data-line-number="15"></a>
<a class="sourceLine" id="cb108-16" data-line-number="16"><span class="kw">credible_interval_approx</span>(piazza<span class="op">$</span>alpha1, piazza<span class="op">$</span>beta1, aaron<span class="op">$</span>alpha1, aaron<span class="op">$</span>beta1)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   posterior estimate conf.low conf.high
##       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1     0.605 -0.00181  -0.0151    0.0115</code></pre>
<ul>
<li>多个球员对比一个</li>
</ul>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">2016</span>)</a>
<a class="sourceLine" id="cb110-2" data-line-number="2"></a>
<a class="sourceLine" id="cb110-3" data-line-number="3">intervals &lt;-<span class="st"> </span>career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-5" data-line-number="5"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">20</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-6" data-line-number="6"><span class="st">  </span><span class="kw">group_by</span>(name, H, AB) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-7" data-line-number="7"><span class="st">  </span><span class="kw">do</span>(<span class="kw">credible_interval_approx</span>(piazza<span class="op">$</span>alpha1, piazza<span class="op">$</span>beta1, .<span class="op">$</span>alpha1, .<span class="op">$</span>beta1)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-8" data-line-number="8"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">reorder</span>(<span class="kw">paste0</span>(name, <span class="st">&quot; (&quot;</span>, H, <span class="st">&quot; / &quot;</span>, AB, <span class="st">&quot;)&quot;</span>), <span class="op">-</span>estimate))</a>
<a class="sourceLine" id="cb110-10" data-line-number="10">f &lt;-<span class="st"> </span><span class="cf">function</span>(H, AB) broom<span class="op">::</span><span class="kw">tidy</span>(<span class="kw">prop.test</span>(<span class="kw">c</span>(H, piazza<span class="op">$</span>H), <span class="kw">c</span>(AB, piazza<span class="op">$</span>AB)))</a>
<a class="sourceLine" id="cb110-11" data-line-number="11">prop_tests &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map2_df</span>(intervals<span class="op">$</span>H, intervals<span class="op">$</span>AB, f) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">estimate =</span> estimate1 <span class="op">-</span><span class="st"> </span>estimate2,</a>
<a class="sourceLine" id="cb110-13" data-line-number="13">         <span class="dt">name =</span> intervals<span class="op">$</span>name)</a>
<a class="sourceLine" id="cb110-14" data-line-number="14"></a>
<a class="sourceLine" id="cb110-15" data-line-number="15">all_intervals &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb110-16" data-line-number="16">  <span class="kw">mutate</span>(intervals, <span class="dt">type =</span> <span class="st">&quot;Credible&quot;</span>),</a>
<a class="sourceLine" id="cb110-17" data-line-number="17">  <span class="kw">mutate</span>(prop_tests, <span class="dt">type =</span> <span class="st">&quot;Confidence&quot;</span>)</a>
<a class="sourceLine" id="cb110-18" data-line-number="18">)</a>
<a class="sourceLine" id="cb110-19" data-line-number="19"></a>
<a class="sourceLine" id="cb110-20" data-line-number="20"><span class="kw">ggplot</span>(all_intervals, <span class="kw">aes</span>(<span class="dt">x =</span> estimate, <span class="dt">y =</span> name, <span class="dt">color =</span> type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb110-21" data-line-number="21"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb110-22" data-line-number="22"><span class="st">  </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> conf.low, <span class="dt">xmax =</span> conf.high)) <span class="op">+</span></a>
<a class="sourceLine" id="cb110-23" data-line-number="23"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Piazza average - player average&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb110-24" data-line-number="24"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Player&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/mp-1.png" width="672" /></p>
<ul>
<li>置信区间与可信区间的主要差异来自于经验贝叶斯的区间收敛</li>
</ul>
</div>
<div id="错误率控制" class="section level2">
<h2><span class="header-section-number">10.12</span> 错误率控制</h2>
<ul>
<li><p>如果我打算交易一个球员，那么如何筛选候选人？</p></li>
<li><p>先选那些击球率更好的球员</p></li>
</ul>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1"><span class="co"># 对比打算交易的球员与其他球员</span></a>
<a class="sourceLine" id="cb111-2" data-line-number="2">career_eb_vs_piazza &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb111-3" data-line-number="3">  career_eb,</a>
<a class="sourceLine" id="cb111-4" data-line-number="4">  <span class="kw">credible_interval_approx</span>(piazza<span class="op">$</span>alpha1, piazza<span class="op">$</span>beta1,</a>
<a class="sourceLine" id="cb111-5" data-line-number="5">                           career_eb<span class="op">$</span>alpha1, career_eb<span class="op">$</span>beta1)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb111-6" data-line-number="6"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(name, posterior, conf.low, conf.high)</a>
<a class="sourceLine" id="cb111-7" data-line-number="7"></a>
<a class="sourceLine" id="cb111-8" data-line-number="8">career_eb_vs_piazza</a></code></pre></div>
<pre><code>## # A tibble: 9,670 x 4
##    name                 posterior conf.low conf.high
##    &lt;chr&gt;                    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1 Rogers Hornsby        2.84e-11   0.0345    0.0639
##  2 Ed Delahanty          7.52e- 7   0.0217    0.0517
##  3 Shoeless Joe Jackson  8.89e- 8   0.0278    0.0611
##  4 Willie Keeler         4.62e- 6   0.0183    0.0472
##  5 Nap Lajoie            1.55e- 5   0.0159    0.0441
##  6 Tony Gwynn            1.83e- 5   0.0157    0.0442
##  7 Harry Heilmann        7.19e- 6   0.0180    0.0476
##  8 Lou Gehrig            1.43e- 5   0.0167    0.0461
##  9 Billy Hamilton        6.47e- 6   0.0191    0.0504
## 10 Eddie Collins         1.99e- 4   0.0113    0.0393
## # … with 9,660 more rows</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1"><span class="co"># 计算q值</span></a>
<a class="sourceLine" id="cb113-2" data-line-number="2">career_eb_vs_piazza &lt;-<span class="st"> </span>career_eb_vs_piazza <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(posterior) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">qvalue =</span> <span class="kw">cummean</span>(posterior))</a>
<a class="sourceLine" id="cb113-5" data-line-number="5"></a>
<a class="sourceLine" id="cb113-6" data-line-number="6"><span class="co"># 筛选那些q值小于0.05的</span></a>
<a class="sourceLine" id="cb113-7" data-line-number="7">better &lt;-<span class="st"> </span>career_eb_vs_piazza <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-8" data-line-number="8"><span class="st">  </span><span class="kw">filter</span>(qvalue <span class="op">&lt;</span><span class="st"> </span><span class="fl">.05</span>)</a>
<a class="sourceLine" id="cb113-9" data-line-number="9"></a>
<a class="sourceLine" id="cb113-10" data-line-number="10">better</a></code></pre></div>
<pre><code>## # A tibble: 48 x 5
##    name                 posterior conf.low conf.high   qvalue
##    &lt;chr&gt;                    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 Rogers Hornsby        2.84e-11   0.0345    0.0639 2.84e-11
##  2 Shoeless Joe Jackson  8.89e- 8   0.0278    0.0611 4.45e- 8
##  3 Ed Delahanty          7.52e- 7   0.0217    0.0517 2.80e- 7
##  4 Willie Keeler         4.62e- 6   0.0183    0.0472 1.36e- 6
##  5 Billy Hamilton        6.47e- 6   0.0191    0.0504 2.39e- 6
##  6 Harry Heilmann        7.19e- 6   0.0180    0.0476 3.19e- 6
##  7 Lou Gehrig            1.43e- 5   0.0167    0.0461 4.78e- 6
##  8 Nap Lajoie            1.55e- 5   0.0159    0.0441 6.12e- 6
##  9 Tony Gwynn            1.83e- 5   0.0157    0.0442 7.47e- 6
## 10 Bill Terry            3.04e- 5   0.0162    0.0472 9.77e- 6
## # … with 38 more rows</code></pre>
<ul>
<li>这样我们筛到一个可交易的群体，总和错误率不超过5%</li>
</ul>
</div>
<div id="影响因子" class="section level2">
<h2><span class="header-section-number">10.13</span> 影响因子</h2>
<ul>
<li>击球率高除了能力影响外还有可能是因为得到的机会多或者光环效应，例如一开始凭运气打得好，后面给机会多，通过经验累积提高了击球率</li>
</ul>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1">career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">&gt;=</span><span class="st"> </span><span class="dv">20</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(AB, average)) <span class="op">+</span></a>
<a class="sourceLine" id="cb115-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb115-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb115-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<p><img src="datadown_files/figure-html/if-1.png" width="672" /></p>
<ul>
<li><p>击球数低方差会大，这比较正常，很多人挂在起跑线上了</p></li>
<li><p>直接使用经验贝叶斯方法会导致整体向均值收敛，这高估了新手的数据</p></li>
</ul>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1">prior_mu &lt;-<span class="st"> </span>alpha0 <span class="op">/</span><span class="st"> </span>(alpha0 <span class="op">+</span><span class="st"> </span>beta0)</a>
<a class="sourceLine" id="cb116-2" data-line-number="2">career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">&gt;=</span><span class="st"> </span><span class="dv">20</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-4" data-line-number="4"><span class="st">  </span><span class="kw">gather</span>(type, value, average, eb_estimate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">type =</span> plyr<span class="op">::</span><span class="kw">revalue</span>(type, <span class="kw">c</span>(<span class="dt">average =</span> <span class="st">&quot;Raw&quot;</span>,</a>
<a class="sourceLine" id="cb116-6" data-line-number="6">                                      <span class="dt">eb_estimate =</span> <span class="st">&quot;With EB Shrinkage&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(AB, value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb116-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb116-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb116-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">yintercept =</span> prior_mu) <span class="op">+</span></a>
<a class="sourceLine" id="cb116-11" data-line-number="11"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>type) <span class="op">+</span></a>
<a class="sourceLine" id="cb116-12" data-line-number="12"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;average&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb116-13" data-line-number="13"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/ife-1.png" width="672" /></p>
<ul>
<li><p>为了如实反应这种情况，我们应该认为击球率符合贝塔分布，但同时贝塔分布的两个参数受击球数的影响，击球数越多，越可能击中</p></li>
<li><p>这个模型可以用贝塔－二项式回归来描述</p></li>
</ul>
<p><span class="math display">\[\mu_i = \mu_0 + \mu_{\mbox{AB}} \cdot \log(\mbox{AB})\]</span></p>
<p><span class="math display">\[\alpha_{0,i} = \mu_i / \sigma_0\]</span></p>
<p><span class="math display">\[\beta_{0,i} = (1 - \mu_i) / \sigma_0\]</span></p>
<p><span class="math display">\[p_i \sim \mbox{Beta}(\alpha_{0,i}, \beta_{0,i})\]</span></p>
<p><span class="math display">\[H_i \sim \mbox{Binom}(\mbox{AB}_i, p_i)\]</span></p>
<div id="拟合模型" class="section level3">
<h3><span class="header-section-number">10.13.1</span> 拟合模型</h3>
<ul>
<li>寻找拟合后的模型参数，构建新的先验概率</li>
</ul>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1"><span class="kw">library</span>(gamlss)</a>
<a class="sourceLine" id="cb117-2" data-line-number="2"><span class="co"># 拟合模型</span></a>
<a class="sourceLine" id="cb117-3" data-line-number="3">fit &lt;-<span class="st"> </span><span class="kw">gamlss</span>(<span class="kw">cbind</span>(H, AB <span class="op">-</span><span class="st"> </span>H) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(AB),</a>
<a class="sourceLine" id="cb117-4" data-line-number="4">              <span class="dt">data =</span> career_eb,</a>
<a class="sourceLine" id="cb117-5" data-line-number="5">              <span class="dt">family =</span> <span class="kw">BB</span>(<span class="dt">mu.link =</span> <span class="st">&quot;identity&quot;</span>))</a></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 94587 
## GAMLSS-RS iteration 2: Global Deviance = 74795 
## GAMLSS-RS iteration 3: Global Deviance = 70515 
## GAMLSS-RS iteration 4: Global Deviance = 70509 
## GAMLSS-RS iteration 5: Global Deviance = 70509</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1"><span class="co"># 展示拟合参数</span></a>
<a class="sourceLine" id="cb119-2" data-line-number="2">td &lt;-<span class="st"> </span><span class="kw">tidy</span>(fit)</a>
<a class="sourceLine" id="cb119-3" data-line-number="3">td</a></code></pre></div>
<pre><code>## # A tibble: 3 x 6
##   parameter term        estimate std.error statistic p.value
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 mu        (Intercept)   0.144   0.00158       91.0       0
## 2 mu        log(AB)       0.0151  0.000216      70.0       0
## 3 sigma     (Intercept)  -6.35    0.0246      -258.        0</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1"><span class="co"># 构建新的先验概率</span></a>
<a class="sourceLine" id="cb121-2" data-line-number="2">mu_<span class="dv">0</span> &lt;-<span class="st"> </span>td<span class="op">$</span>estimate[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb121-3" data-line-number="3">mu_AB &lt;-<span class="st"> </span>td<span class="op">$</span>estimate[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb121-4" data-line-number="4">sigma &lt;-<span class="st"> </span><span class="kw">exp</span>(td<span class="op">$</span>estimate[<span class="dv">3</span>])</a>
<a class="sourceLine" id="cb121-5" data-line-number="5"></a>
<a class="sourceLine" id="cb121-6" data-line-number="6"><span class="co"># 看看AB对先验概率的影响</span></a>
<a class="sourceLine" id="cb121-7" data-line-number="7"><span class="kw">crossing</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="fl">0.08</span>, <span class="fl">.35</span>, <span class="fl">.001</span>), <span class="dt">AB =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">dbeta</span>(x, (mu_<span class="dv">0</span> <span class="op">+</span><span class="st"> </span>mu_AB <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(AB)) <span class="op">/</span><span class="st"> </span>sigma,</a>
<a class="sourceLine" id="cb121-9" data-line-number="9">                         (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(mu_<span class="dv">0</span> <span class="op">+</span><span class="st"> </span>mu_AB <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(AB))) <span class="op">/</span><span class="st"> </span>sigma)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">AB =</span> <span class="kw">factor</span>(AB)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, density, <span class="dt">color =</span> AB, <span class="dt">group =</span> AB)) <span class="op">+</span></a>
<a class="sourceLine" id="cb121-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb121-13" data-line-number="13"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Batting average&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb121-14" data-line-number="14"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Prior density&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/fitbb-1.png" width="672" /></p>
</div>
<div id="求后验概率" class="section level3">
<h3><span class="header-section-number">10.13.2</span> 求后验概率</h3>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1"><span class="co"># 计算所有拟合值</span></a>
<a class="sourceLine" id="cb122-2" data-line-number="2">mu &lt;-<span class="st"> </span><span class="kw">fitted</span>(fit, <span class="dt">parameter =</span> <span class="st">&quot;mu&quot;</span>)</a>
<a class="sourceLine" id="cb122-3" data-line-number="3">sigma &lt;-<span class="st"> </span><span class="kw">fitted</span>(fit, <span class="dt">parameter =</span> <span class="st">&quot;sigma&quot;</span>)</a>
<a class="sourceLine" id="cb122-4" data-line-number="4"><span class="co"># 计算所有后验概率</span></a>
<a class="sourceLine" id="cb122-5" data-line-number="5">career_eb_wAB &lt;-<span class="st"> </span>career_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-6" data-line-number="6"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(name, H, AB, <span class="dt">original_eb =</span> eb_estimate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mu =</span> mu,</a>
<a class="sourceLine" id="cb122-8" data-line-number="8">         <span class="dt">alpha0 =</span> mu <span class="op">/</span><span class="st"> </span>sigma,</a>
<a class="sourceLine" id="cb122-9" data-line-number="9">         <span class="dt">beta0 =</span> (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mu) <span class="op">/</span><span class="st"> </span>sigma,</a>
<a class="sourceLine" id="cb122-10" data-line-number="10">         <span class="dt">alpha1 =</span> alpha0 <span class="op">+</span><span class="st"> </span>H,</a>
<a class="sourceLine" id="cb122-11" data-line-number="11">         <span class="dt">beta1 =</span> beta0 <span class="op">+</span><span class="st"> </span>AB <span class="op">-</span><span class="st"> </span>H,</a>
<a class="sourceLine" id="cb122-12" data-line-number="12">         <span class="dt">new_eb =</span> alpha1 <span class="op">/</span><span class="st"> </span>(alpha1 <span class="op">+</span><span class="st"> </span>beta1))</a>
<a class="sourceLine" id="cb122-13" data-line-number="13"><span class="co"># 展示拟合后的击球率</span></a>
<a class="sourceLine" id="cb122-14" data-line-number="14"><span class="kw">ggplot</span>(career_eb_wAB, <span class="kw">aes</span>(original_eb, new_eb, <span class="dt">color =</span> AB)) <span class="op">+</span></a>
<a class="sourceLine" id="cb122-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb122-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb122-17" data-line-number="17"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Original EB Estimate&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb122-18" data-line-number="18"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;EB Estimate w/ AB term&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb122-19" data-line-number="19"><span class="st">  </span><span class="kw">scale_color_continuous</span>(<span class="dt">trans =</span> <span class="st">&quot;log&quot;</span>, <span class="dt">breaks =</span> <span class="dv">10</span> <span class="op">^</span><span class="st"> </span>(<span class="dv">0</span><span class="op">:</span><span class="dv">4</span>))</a></code></pre></div>
<p><img src="datadown_files/figure-html/fitpo-1.png" width="672" /></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="co"># 对比</span></a>
<a class="sourceLine" id="cb123-2" data-line-number="2"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb123-3" data-line-number="3"></a>
<a class="sourceLine" id="cb123-4" data-line-number="4">lev &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">raw =</span> <span class="st">&quot;Raw H / AB&quot;</span>, <span class="dt">original_eb =</span> <span class="st">&quot;EB Estimate&quot;</span>, <span class="dt">new_eb =</span> <span class="st">&quot;EB w/ Regression&quot;</span>)</a>
<a class="sourceLine" id="cb123-5" data-line-number="5"></a>
<a class="sourceLine" id="cb123-6" data-line-number="6">career_eb_wAB <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">raw =</span> H <span class="op">/</span><span class="st"> </span>AB) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-9" data-line-number="9"><span class="st">  </span><span class="kw">gather</span>(type, value, raw, original_eb, new_eb) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mu =</span> <span class="kw">ifelse</span>(type <span class="op">==</span><span class="st"> &quot;original_eb&quot;</span>, prior_mu,</a>
<a class="sourceLine" id="cb123-11" data-line-number="11">                     <span class="kw">ifelse</span>(type <span class="op">==</span><span class="st"> &quot;new_eb&quot;</span>, mu, <span class="ot">NA</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="kw">factor</span>(plyr<span class="op">::</span><span class="kw">revalue</span>(type, lev), lev)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(AB, value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb123-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb123-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> mu), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb123-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb123-17" data-line-number="17"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>type) <span class="op">+</span></a>
<a class="sourceLine" id="cb123-18" data-line-number="18"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;At-Bats (AB)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb123-19" data-line-number="19"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Estimate&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/fitpo-2.png" width="672" /></p>
<ul>
<li>矫正后我们的数据更复合现实了，其实这是贝叶斯分层模型的一个简单版本，通过考虑更多因素，我们可以构建更复杂的模型来挖掘出我们所需要的信息</li>
</ul>
</div>
<div id="考虑更多因素" class="section level3">
<h3><span class="header-section-number">10.13.3</span> 考虑更多因素</h3>
<ul>
<li>现在我们听说左利手跟右利手的表现可能不一样，所以我们要对模型进行完善，考虑把左右手参数加入模型</li>
</ul>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1"><span class="co"># 展示数据</span></a>
<a class="sourceLine" id="cb124-2" data-line-number="2">career2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-3" data-line-number="3"><span class="st">        </span><span class="kw">count</span>(bats)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   bats      n
##   &lt;fct&gt; &lt;int&gt;
## 1 B       788
## 2 L      2740
## 3 R      5486
## 4 &lt;NA&gt;    656</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1"><span class="co"># 排除NA</span></a>
<a class="sourceLine" id="cb126-2" data-line-number="2">career3 &lt;-<span class="st"> </span>career2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(bats)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">bats =</span> <span class="kw">relevel</span>(bats, <span class="st">&quot;R&quot;</span>))</a>
<a class="sourceLine" id="cb126-5" data-line-number="5"><span class="co"># 重建模型</span></a>
<a class="sourceLine" id="cb126-6" data-line-number="6">fit2 &lt;-<span class="st"> </span><span class="kw">gamlss</span>(<span class="kw">cbind</span>(H, AB <span class="op">-</span><span class="st"> </span>H) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(AB) <span class="op">+</span><span class="st"> </span>bats,</a>
<a class="sourceLine" id="cb126-7" data-line-number="7">               <span class="dt">data =</span> career3,</a>
<a class="sourceLine" id="cb126-8" data-line-number="8">               <span class="dt">family =</span> <span class="kw">BB</span>(<span class="dt">mu.link =</span> <span class="st">&quot;identity&quot;</span>))</a></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 90843 
## GAMLSS-RS iteration 2: Global Deviance = 71587 
## GAMLSS-RS iteration 3: Global Deviance = 67295 
## GAMLSS-RS iteration 4: Global Deviance = 67289 
## GAMLSS-RS iteration 5: Global Deviance = 67289</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1"><span class="co"># 观察参数</span></a>
<a class="sourceLine" id="cb128-2" data-line-number="2"><span class="kw">tidy</span>(fit2)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 6
##   parameter term        estimate std.error statistic  p.value
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 mu        (Intercept)  0.142    0.00162      87.6  0.      
## 2 mu        log(AB)      0.0150   0.000219     68.3  0.      
## 3 mu        batsB       -0.00158  0.000982     -1.61 1.07e- 1
## 4 mu        batsL        0.00953  0.000630     15.1  5.11e-51
## 5 sigma     (Intercept) -6.43     0.0251     -256.   0.</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1">sigma &lt;-<span class="st"> </span><span class="kw">fitted</span>(fit2, <span class="st">&quot;sigma&quot;</span>)[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb130-2" data-line-number="2"><span class="kw">crossing</span>(<span class="dt">bats =</span> <span class="kw">c</span>(<span class="st">&quot;L&quot;</span>, <span class="st">&quot;R&quot;</span>),</a>
<a class="sourceLine" id="cb130-3" data-line-number="3">         <span class="dt">AB =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb130-4" data-line-number="4"><span class="st">  </span><span class="kw">augment</span>(fit2, <span class="dt">newdata =</span> .) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb130-5" data-line-number="5"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">mu =</span> .fitted) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb130-6" data-line-number="6"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">x =</span> <span class="kw">seq</span>(.<span class="dv">1</span>, <span class="fl">.36</span>, <span class="fl">.0005</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb130-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">alpha =</span> mu <span class="op">/</span><span class="st"> </span>sigma,</a>
<a class="sourceLine" id="cb130-8" data-line-number="8">         <span class="dt">beta =</span> (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mu) <span class="op">/</span><span class="st"> </span>sigma,</a>
<a class="sourceLine" id="cb130-9" data-line-number="9">         <span class="dt">density =</span> <span class="kw">dbeta</span>(x, alpha, beta)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb130-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, density, <span class="dt">color =</span> <span class="kw">factor</span>(AB), <span class="dt">lty =</span> bats)) <span class="op">+</span></a>
<a class="sourceLine" id="cb130-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb130-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Batting average&quot;</span>,</a>
<a class="sourceLine" id="cb130-13" data-line-number="13">       <span class="dt">y =</span> <span class="st">&quot;Prior density&quot;</span>,</a>
<a class="sourceLine" id="cb130-14" data-line-number="14">       <span class="dt">color =</span> <span class="st">&quot;AB&quot;</span>,</a>
<a class="sourceLine" id="cb130-15" data-line-number="15">       <span class="dt">lty =</span> <span class="st">&quot;Batting hand&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/career2-1.png" width="672" /></p>
<ul>
<li>存在先验概率的情况下，可以考虑考察随着击球数增长左右手的不同</li>
</ul>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1"><span class="kw">crossing</span>(<span class="dt">bats =</span> <span class="kw">c</span>(<span class="st">&quot;L&quot;</span>, <span class="st">&quot;R&quot;</span>),</a>
<a class="sourceLine" id="cb131-2" data-line-number="2">         <span class="dt">AB =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-3" data-line-number="3"><span class="st">  </span><span class="kw">augment</span>(fit2, <span class="dt">newdata =</span> .) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">H =</span> <span class="fl">.3</span> <span class="op">*</span><span class="st"> </span>AB,</a>
<a class="sourceLine" id="cb131-5" data-line-number="5">         <span class="dt">alpha0 =</span> .fitted <span class="op">/</span><span class="st"> </span>sigma,</a>
<a class="sourceLine" id="cb131-6" data-line-number="6">         <span class="dt">beta0 =</span> (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>.fitted) <span class="op">/</span><span class="st"> </span>sigma,</a>
<a class="sourceLine" id="cb131-7" data-line-number="7">         <span class="dt">alpha1 =</span> alpha0 <span class="op">+</span><span class="st"> </span>H,</a>
<a class="sourceLine" id="cb131-8" data-line-number="8">         <span class="dt">beta1 =</span> beta0 <span class="op">+</span><span class="st"> </span>AB <span class="op">-</span><span class="st"> </span>H,</a>
<a class="sourceLine" id="cb131-9" data-line-number="9">         <span class="dt">estimate =</span> alpha1 <span class="op">/</span><span class="st"> </span>(alpha1 <span class="op">+</span><span class="st"> </span>beta1),</a>
<a class="sourceLine" id="cb131-10" data-line-number="10">         <span class="dt">conf.low =</span> <span class="kw">qbeta</span>(.<span class="dv">025</span>, alpha1, beta1),</a>
<a class="sourceLine" id="cb131-11" data-line-number="11">         <span class="dt">conf.high =</span> <span class="kw">qbeta</span>(.<span class="dv">975</span>, alpha1, beta1),</a>
<a class="sourceLine" id="cb131-12" data-line-number="12">         <span class="dt">record =</span> <span class="kw">paste</span>(H, AB, <span class="dt">sep =</span> <span class="st">&quot; / &quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(estimate, record, <span class="dt">color =</span> bats)) <span class="op">+</span></a>
<a class="sourceLine" id="cb131-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb131-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> conf.low, <span class="dt">xmax =</span> conf.high)) <span class="op">+</span></a>
<a class="sourceLine" id="cb131-16" data-line-number="16"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Estimate w/ 95% credible interval&quot;</span>,</a>
<a class="sourceLine" id="cb131-17" data-line-number="17">       <span class="dt">y =</span> <span class="st">&quot;Batting record&quot;</span>,</a>
<a class="sourceLine" id="cb131-18" data-line-number="18">       <span class="dt">color =</span> <span class="st">&quot;Batting hand&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/lrcom-1.png" width="672" /></p>
<ul>
<li>另一个要考虑的因素是不同年份的平均击球率可能也有起伏</li>
</ul>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1">career3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">decade =</span> <span class="kw">factor</span>(<span class="kw">round</span>(year <span class="op">-</span><span class="st"> </span><span class="dv">5</span>, <span class="dv">-1</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">&gt;=</span><span class="st"> </span><span class="dv">500</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(decade, average)) <span class="op">+</span></a>
<a class="sourceLine" id="cb132-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb132-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb132-7" data-line-number="7"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Batting average&quot;</span>)</a>
<a class="sourceLine" id="cb132-8" data-line-number="8"><span class="co"># 用样条插值来进行拟合</span></a>
<a class="sourceLine" id="cb132-9" data-line-number="9"><span class="kw">library</span>(splines)</a>
<a class="sourceLine" id="cb132-10" data-line-number="10">fit3 &lt;-<span class="st"> </span><span class="kw">gamlss</span>(<span class="kw">cbind</span>(H, AB <span class="op">-</span><span class="st"> </span>H) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(year, <span class="dt">df =</span> <span class="dv">5</span>) <span class="op">+</span><span class="st"> </span>bats <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(AB),</a>
<a class="sourceLine" id="cb132-11" data-line-number="11">               <span class="dt">data =</span> career3,</a>
<a class="sourceLine" id="cb132-12" data-line-number="12">               <span class="dt">family =</span> <span class="kw">BB</span>(<span class="dt">mu.link =</span> <span class="st">&quot;identity&quot;</span>))</a>
<a class="sourceLine" id="cb132-13" data-line-number="13"></a>
<a class="sourceLine" id="cb132-14" data-line-number="14"><span class="co"># 观察在击球数1000上先验概率的变化</span></a>
<a class="sourceLine" id="cb132-15" data-line-number="15">plot_gamlss_fit &lt;-<span class="st"> </span><span class="cf">function</span>(f) {</a>
<a class="sourceLine" id="cb132-16" data-line-number="16">  career3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-17" data-line-number="17"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(year, bats) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-18" data-line-number="18"><span class="st">    </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-19" data-line-number="19"><span class="st">    </span><span class="kw">filter</span>(bats <span class="op">!=</span><span class="st"> &quot;B&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-20" data-line-number="20"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">AB =</span> <span class="dv">1000</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-21" data-line-number="21"><span class="st">    </span><span class="kw">augment</span>(f, <span class="dt">newdata =</span> .) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-22" data-line-number="22"><span class="st">    </span><span class="kw">rename</span>(<span class="dt">mu =</span> .fitted) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-23" data-line-number="23"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">sigma =</span> <span class="kw">fitted</span>(fit3, <span class="st">&quot;sigma&quot;</span>)[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb132-24" data-line-number="24">           <span class="dt">alpha0 =</span> mu <span class="op">/</span><span class="st"> </span>sigma,</a>
<a class="sourceLine" id="cb132-25" data-line-number="25">           <span class="dt">beta0 =</span> (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mu) <span class="op">/</span><span class="st"> </span>sigma,</a>
<a class="sourceLine" id="cb132-26" data-line-number="26">           <span class="dt">conf_low =</span> <span class="kw">qbeta</span>(.<span class="dv">025</span>, alpha0, beta0),</a>
<a class="sourceLine" id="cb132-27" data-line-number="27">           <span class="dt">conf_high =</span> <span class="kw">qbeta</span>(.<span class="dv">975</span>, alpha0, beta0)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-28" data-line-number="28"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, mu, <span class="dt">color =</span> bats, <span class="dt">group =</span> bats)) <span class="op">+</span></a>
<a class="sourceLine" id="cb132-29" data-line-number="29"><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb132-30" data-line-number="30"><span class="st">    </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> conf_low, <span class="dt">ymax =</span> conf_high), <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">alpha =</span> <span class="fl">.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb132-31" data-line-number="31"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>,</a>
<a class="sourceLine" id="cb132-32" data-line-number="32">         <span class="dt">y =</span> <span class="st">&quot;Prior distribution (median + 95% quantiles)&quot;</span>,</a>
<a class="sourceLine" id="cb132-33" data-line-number="33">         <span class="dt">color =</span> <span class="st">&quot;Batting hand&quot;</span>)</a>
<a class="sourceLine" id="cb132-34" data-line-number="34">}</a>
<a class="sourceLine" id="cb132-35" data-line-number="35"><span class="kw">plot_gamlss_fit</span>(fit3)</a></code></pre></div>
<ul>
<li>同时另一个问题是这些因素会交互影响</li>
</ul>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1">fit4 &lt;-<span class="st"> </span><span class="kw">gamlss</span>(<span class="kw">cbind</span>(H, AB <span class="op">-</span><span class="st"> </span>H) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(year, <span class="dv">5</span>) <span class="op">*</span><span class="st"> </span>bats <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(AB),</a>
<a class="sourceLine" id="cb133-2" data-line-number="2">               <span class="dt">data =</span> career3,</a>
<a class="sourceLine" id="cb133-3" data-line-number="3">               <span class="dt">family =</span> <span class="kw">BB</span>(<span class="dt">mu.link =</span> <span class="st">&quot;identity&quot;</span>))</a>
<a class="sourceLine" id="cb133-4" data-line-number="4"><span class="kw">plot_gamlss_fit</span>(fit4)</a>
<a class="sourceLine" id="cb133-5" data-line-number="5"></a>
<a class="sourceLine" id="cb133-6" data-line-number="6">Pitching <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-7" data-line-number="7"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(playerID, yearID, GS) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-8" data-line-number="8"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-9" data-line-number="9"><span class="st">  </span><span class="kw">inner_join</span>(dplyr<span class="op">::</span><span class="kw">select</span>(Master, playerID, throws)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-10" data-line-number="10"><span class="st">  </span><span class="kw">count</span>(yearID, throws, <span class="dt">wt =</span> GS) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-11" data-line-number="11"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(throws)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-13" data-line-number="13"><span class="st">  </span><span class="kw">filter</span>(throws <span class="op">==</span><span class="st"> &quot;L&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-14" data-line-number="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(yearID, percent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb133-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb133-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb133-17" data-line-number="17"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">percent_format</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb133-18" data-line-number="18"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb133-19" data-line-number="19"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;% of games with left-handed pitcher&quot;</span>)</a></code></pre></div>
<ul>
<li>左右手之间的差距伴随年份在逐渐减少</li>
</ul>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1">players &lt;-<span class="st"> </span><span class="kw">crossing</span>(<span class="dt">year =</span> <span class="kw">c</span>(<span class="dv">1915</span>, <span class="dv">1965</span>, <span class="dv">2015</span>),</a>
<a class="sourceLine" id="cb134-2" data-line-number="2">                    <span class="dt">bats =</span> <span class="kw">c</span>(<span class="st">&quot;L&quot;</span>, <span class="st">&quot;R&quot;</span>),</a>
<a class="sourceLine" id="cb134-3" data-line-number="3">                    <span class="dt">H =</span> <span class="dv">30</span>,</a>
<a class="sourceLine" id="cb134-4" data-line-number="4">                    <span class="dt">AB =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb134-5" data-line-number="5"></a>
<a class="sourceLine" id="cb134-6" data-line-number="6">players_posterior &lt;-<span class="st"> </span>players <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mu =</span> <span class="kw">predict</span>(fit4, <span class="dt">what =</span> <span class="st">&quot;mu&quot;</span>, <span class="dt">newdata =</span> players),</a>
<a class="sourceLine" id="cb134-8" data-line-number="8">         <span class="dt">sigma =</span> <span class="kw">predict</span>(fit4, <span class="dt">what =</span> <span class="st">&quot;sigma&quot;</span>, <span class="dt">newdata =</span> players, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>),</a>
<a class="sourceLine" id="cb134-9" data-line-number="9">         <span class="dt">alpha0 =</span> mu <span class="op">/</span><span class="st"> </span>sigma,</a>
<a class="sourceLine" id="cb134-10" data-line-number="10">         <span class="dt">beta0 =</span> (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mu) <span class="op">/</span><span class="st"> </span>sigma,</a>
<a class="sourceLine" id="cb134-11" data-line-number="11">         <span class="dt">alpha1 =</span> alpha0 <span class="op">+</span><span class="st"> </span>H,</a>
<a class="sourceLine" id="cb134-12" data-line-number="12">         <span class="dt">beta1 =</span> beta0 <span class="op">+</span><span class="st"> </span>AB <span class="op">-</span><span class="st"> </span>H)</a>
<a class="sourceLine" id="cb134-13" data-line-number="13">players_posterior <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-14" data-line-number="14"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">x =</span> <span class="kw">seq</span>(.<span class="dv">15</span>, <span class="fl">.3</span>, <span class="fl">.001</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-15" data-line-number="15"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">dbeta</span>(x, alpha1, beta1)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-16" data-line-number="16"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, density, <span class="dt">color =</span> bats)) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb134-18" data-line-number="18"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>year) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-19" data-line-number="19"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Batting average&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-20" data-line-number="20"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Posterior density&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-21" data-line-number="21"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Posterior distributions for batters with 30 / 100&quot;</span>)</a></code></pre></div>
<ul>
<li>经验贝叶斯对先验概率的估计类似频率学派，但进行的又是贝叶斯分析</li>
</ul>
</div>
</div>
<div id="混合概率模型" class="section level2">
<h2><span class="header-section-number">10.14</span> 混合概率模型</h2>
<ul>
<li>用击球概率为例，击球手跟非击球手的概率分布是不一样的，那么实际看到的总体球员概率分布应该是一个混合在一起的两个独立分布</li>
</ul>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1"><span class="co"># 找出投球3次以上的人</span></a>
<a class="sourceLine" id="cb135-2" data-line-number="2">pitchers &lt;-<span class="st"> </span>Pitching <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">gamesPitched =</span> <span class="kw">sum</span>(G)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(gamesPitched <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb135-6" data-line-number="6"></a>
<a class="sourceLine" id="cb135-7" data-line-number="7"><span class="co"># 参考上一章节的发现找出击球率稳定的选手 </span></a>
<a class="sourceLine" id="cb135-8" data-line-number="8"></a>
<a class="sourceLine" id="cb135-9" data-line-number="9">career &lt;-<span class="st"> </span>Batting <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-10" data-line-number="10"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, lgID <span class="op">==</span><span class="st"> &quot;NL&quot;</span>, yearID <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1980</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-11" data-line-number="11"><span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-12" data-line-number="12"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">H =</span> <span class="kw">sum</span>(H), <span class="dt">AB =</span> <span class="kw">sum</span>(AB), <span class="dt">year =</span> <span class="kw">mean</span>(yearID)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">average =</span> H <span class="op">/</span><span class="st"> </span>AB,</a>
<a class="sourceLine" id="cb135-14" data-line-number="14">         <span class="dt">isPitcher =</span> playerID <span class="op">%in%</span><span class="st"> </span>pitchers<span class="op">$</span>playerID)</a>
<a class="sourceLine" id="cb135-15" data-line-number="15"></a>
<a class="sourceLine" id="cb135-16" data-line-number="16"><span class="co"># 链接上名字</span></a>
<a class="sourceLine" id="cb135-17" data-line-number="17">career &lt;-<span class="st"> </span>Master <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-18" data-line-number="18"><span class="st">  </span><span class="kw">tbl_df</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-19" data-line-number="19"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(playerID, nameFirst, nameLast, bats) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-20" data-line-number="20"><span class="st">  </span><span class="kw">unite</span>(name, nameFirst, nameLast, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-21" data-line-number="21"><span class="st">  </span><span class="kw">inner_join</span>(career, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>)</a></code></pre></div>
<div id="期望最大算法" class="section level3">
<h3><span class="header-section-number">10.14.1</span> 期望最大算法</h3>
<ul>
<li>将一个分布拆成两个，可以使用期望最大算法</li>
</ul>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">2017</span>)</a>
<a class="sourceLine" id="cb136-2" data-line-number="2"></a>
<a class="sourceLine" id="cb136-3" data-line-number="3"><span class="co"># 先随机分为两组</span></a>
<a class="sourceLine" id="cb136-4" data-line-number="4">starting_data &lt;-<span class="st"> </span>career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">&gt;=</span><span class="st"> </span><span class="dv">20</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-6" data-line-number="6"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>year, <span class="op">-</span>bats, <span class="op">-</span>isPitcher) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cluster =</span> <span class="kw">factor</span>(<span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="kw">n</span>(), <span class="dt">replace =</span> <span class="ot">TRUE</span>)))</a>
<a class="sourceLine" id="cb136-8" data-line-number="8"></a>
<a class="sourceLine" id="cb136-9" data-line-number="9"><span class="co"># 观察效果</span></a>
<a class="sourceLine" id="cb136-10" data-line-number="10">starting_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(average, <span class="dt">color =</span> cluster)) <span class="op">+</span></a>
<a class="sourceLine" id="cb136-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_density</span>()</a></code></pre></div>
<p><img src="datadown_files/figure-html/EM-1.png" width="672" /></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1"><span class="kw">library</span>(VGAM)</a>
<a class="sourceLine" id="cb137-2" data-line-number="2">fit_bb_mle &lt;-<span class="st"> </span><span class="cf">function</span>(x, n) {</a>
<a class="sourceLine" id="cb137-3" data-line-number="3">  <span class="co"># dbetabinom.ab 是用n、alpha与beta作为参数的二项贝塔分布的似然度函数</span></a>
<a class="sourceLine" id="cb137-4" data-line-number="4">  ll &lt;-<span class="st"> </span><span class="cf">function</span>(alpha, beta) {</a>
<a class="sourceLine" id="cb137-5" data-line-number="5">    <span class="op">-</span><span class="kw">sum</span>(<span class="kw">dbetabinom.ab</span>(x, n, alpha, beta, <span class="dt">log =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb137-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb137-7" data-line-number="7">  m &lt;-<span class="st"> </span>stats4<span class="op">::</span><span class="kw">mle</span>(ll, <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">alpha =</span> <span class="dv">3</span>, <span class="dt">beta =</span> <span class="dv">10</span>), <span class="dt">method =</span> <span class="st">&quot;L-BFGS-B&quot;</span>,</a>
<a class="sourceLine" id="cb137-8" data-line-number="8">                   <span class="dt">lower =</span> <span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">.001</span>))</a>
<a class="sourceLine" id="cb137-9" data-line-number="9">  ab &lt;-<span class="st"> </span>stats4<span class="op">::</span><span class="kw">coef</span>(m)</a>
<a class="sourceLine" id="cb137-10" data-line-number="10">  <span class="kw">data_frame</span>(<span class="dt">alpha =</span> ab[<span class="dv">1</span>], <span class="dt">beta =</span> ab[<span class="dv">2</span>], <span class="dt">number =</span> <span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb137-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb137-12" data-line-number="12"><span class="co"># 看下初始参数</span></a>
<a class="sourceLine" id="cb137-13" data-line-number="13"><span class="kw">fit_bb_mle</span>(starting_data<span class="op">$</span>H, starting_data<span class="op">$</span>AB)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   alpha  beta number
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;
## 1  12.4  44.5   3615</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1"><span class="co"># 看下随机分拆后的参数并生成各分组样本数的先验概率</span></a>
<a class="sourceLine" id="cb139-2" data-line-number="2">fits &lt;-<span class="st"> </span>starting_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(cluster) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-4" data-line-number="4"><span class="st">  </span><span class="kw">do</span>(<span class="kw">fit_bb_mle</span>(.<span class="op">$</span>H, .<span class="op">$</span>AB)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-5" data-line-number="5"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> number <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(number))</a>
<a class="sourceLine" id="cb139-7" data-line-number="7"></a>
<a class="sourceLine" id="cb139-8" data-line-number="8">fits</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   cluster alpha  beta number prior
##   &lt;fct&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt; &lt;dbl&gt;
## 1 A        12.6  45.0   1764 0.488
## 2 B        12.2  44.0   1851 0.512</code></pre>
<ul>
<li>算法优化的期望是将这两个分布分拆开，前面一次分拆已经产生微弱差异，下面就通过贝叶斯思想对数据更新这个差异重新分组让两者分开</li>
</ul>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1">assignments &lt;-<span class="st"> </span>starting_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>cluster) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-3" data-line-number="3"><span class="st">  </span><span class="kw">crossing</span>(fits) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">likelihood =</span> prior <span class="op">*</span><span class="st"> </span>VGAM<span class="op">::</span><span class="kw">dbetabinom.ab</span>(H, AB, alpha, beta)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-6" data-line-number="6"><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">1</span>, likelihood) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-7" data-line-number="7"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb141-8" data-line-number="8"><span class="co"># 去除掉原有分组，根据更新的后验概率重新分组</span></a>
<a class="sourceLine" id="cb141-9" data-line-number="9">assignments</a></code></pre></div>
<pre><code>## # A tibble: 3,615 x 11
##    playerID  name                   H    AB average cluster alpha  beta number prior likelihood
##    &lt;chr&gt;     &lt;chr&gt;              &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;fct&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1 abbotje01 Jeff Abbott           11    42  0.262  B        12.2  44.0   1851 0.512   0.0455  
##  2 abbotji01 Jim Abbott             2    21  0.0952 B        12.2  44.0   1851 0.512   0.0570  
##  3 abbotku01 Kurt Abbott          475  1860  0.255  B        12.2  44.0   1851 0.512   0.00140 
##  4 abbotky01 Kyle Abbott            3    31  0.0968 B        12.2  44.0   1851 0.512   0.0356  
##  5 abercre01 Reggie Abercrombie    86   386  0.223  B        12.2  44.0   1851 0.512   0.00873 
##  6 abnersh01 Shawn Abner          110   531  0.207  B        12.2  44.0   1851 0.512   0.00672 
##  7 abreubo01 Bobby Abreu         1607  5395  0.298  B        12.2  44.0   1851 0.512   0.000219
##  8 abreuto01 Tony Abreu           129   509  0.253  B        12.2  44.0   1851 0.512   0.00516 
##  9 acevejo01 Jose Acevedo           8   101  0.0792 B        12.2  44.0   1851 0.512   0.00293 
## 10 aceveju01 Juan Acevedo           6    65  0.0923 B        12.2  44.0   1851 0.512   0.0106  
## # … with 3,605 more rows</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1"><span class="co"># 观察更新后概率分布</span></a>
<a class="sourceLine" id="cb143-2" data-line-number="2"><span class="kw">ggplot</span>(assignments, <span class="kw">aes</span>(average, <span class="dt">fill =</span> cluster)) <span class="op">+</span></a>
<a class="sourceLine" id="cb143-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_histogram</span>()</a></code></pre></div>
<p><img src="datadown_files/figure-html/EMbayes-1.png" width="672" /></p>
<ul>
<li>不断重复这个过程，最终分拆数据（其实就是第一步分拆最重要，后面直接收敛了）</li>
</ul>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">1987</span>)</a>
<a class="sourceLine" id="cb144-2" data-line-number="2"></a>
<a class="sourceLine" id="cb144-3" data-line-number="3">iterate_em &lt;-<span class="st"> </span><span class="cf">function</span>(state, ...) {</a>
<a class="sourceLine" id="cb144-4" data-line-number="4">  fits &lt;-<span class="st"> </span>state<span class="op">$</span>assignments <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-5" data-line-number="5"><span class="st">    </span><span class="kw">group_by</span>(cluster) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-6" data-line-number="6"><span class="st">    </span><span class="kw">do</span>(<span class="kw">mutate</span>(<span class="kw">fit_bb_mle</span>(.<span class="op">$</span>H, .<span class="op">$</span>AB), <span class="dt">number =</span> <span class="kw">nrow</span>(.))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-7" data-line-number="7"><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-8" data-line-number="8"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">prior =</span> number <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(number))</a>
<a class="sourceLine" id="cb144-9" data-line-number="9"></a>
<a class="sourceLine" id="cb144-10" data-line-number="10">  assignments &lt;-<span class="st"> </span>assignments <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-11" data-line-number="11"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(playerID<span class="op">:</span>average) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-12" data-line-number="12"><span class="st">    </span><span class="kw">crossing</span>(fits) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-13" data-line-number="13"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">likelihood =</span> prior <span class="op">*</span><span class="st"> </span>VGAM<span class="op">::</span><span class="kw">dbetabinom.ab</span>(H, AB, alpha, beta)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-14" data-line-number="14"><span class="st">    </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-15" data-line-number="15"><span class="st">    </span><span class="kw">top_n</span>(<span class="dv">1</span>, likelihood) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-16" data-line-number="16"><span class="st">    </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb144-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb144-18" data-line-number="18">  <span class="kw">list</span>(<span class="dt">assignments =</span> assignments,</a>
<a class="sourceLine" id="cb144-19" data-line-number="19">       <span class="dt">fits =</span> fits)</a>
<a class="sourceLine" id="cb144-20" data-line-number="20">}</a>
<a class="sourceLine" id="cb144-21" data-line-number="21"></a>
<a class="sourceLine" id="cb144-22" data-line-number="22"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb144-23" data-line-number="23"><span class="co"># 使用purrr包存储中间结果</span></a>
<a class="sourceLine" id="cb144-24" data-line-number="24">iterations &lt;-<span class="st"> </span><span class="kw">accumulate</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, iterate_em, <span class="dt">.init =</span> <span class="kw">list</span>(<span class="dt">assignments =</span> starting_data))</a>
<a class="sourceLine" id="cb144-25" data-line-number="25"></a>
<a class="sourceLine" id="cb144-26" data-line-number="26">assignment_iterations &lt;-<span class="st"> </span>iterations <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-27" data-line-number="27"><span class="st">  </span><span class="kw">map_df</span>(<span class="st">&quot;assignments&quot;</span>, <span class="dt">.id =</span> <span class="st">&quot;iteration&quot;</span>)</a>
<a class="sourceLine" id="cb144-28" data-line-number="28"><span class="co"># 观察收敛过程</span></a>
<a class="sourceLine" id="cb144-29" data-line-number="29">assignment_iterations <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-30" data-line-number="30"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(average, <span class="dt">fill =</span> cluster)) <span class="op">+</span></a>
<a class="sourceLine" id="cb144-31" data-line-number="31"><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb144-32" data-line-number="32"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>iteration)</a></code></pre></div>
<p><img src="datadown_files/figure-html/EMrepeat-1.png" width="672" /></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1">fit_iterations &lt;-<span class="st"> </span>iterations <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-2" data-line-number="2"><span class="st">  </span><span class="kw">map_df</span>(<span class="st">&quot;fits&quot;</span>, <span class="dt">.id =</span> <span class="st">&quot;iteration&quot;</span>)</a>
<a class="sourceLine" id="cb145-3" data-line-number="3"><span class="co"># 两个分布的收敛过程</span></a>
<a class="sourceLine" id="cb145-4" data-line-number="4">fit_iterations <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-5" data-line-number="5"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">x =</span> <span class="kw">seq</span>(.<span class="dv">001</span>, <span class="fl">.4</span>, <span class="fl">.001</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> prior <span class="op">*</span><span class="st"> </span><span class="kw">dbeta</span>(x, alpha, beta)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, density, <span class="dt">color =</span> iteration, <span class="dt">group =</span> iteration)) <span class="op">+</span></a>
<a class="sourceLine" id="cb145-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb145-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>cluster)</a></code></pre></div>
<p><img src="datadown_files/figure-html/EMrepeat-2.png" width="672" /></p>
</div>
<div id="分配" class="section level3">
<h3><span class="header-section-number">10.14.2</span> 分配</h3>
<ul>
<li>得到每个选手在两个分布中后验概率后要对其进行分配，这里我们认为拆分出的两个分布其实就是是否是击球手的两个分组，由于两组重叠较多，直接分配会有困难</li>
</ul>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1"><span class="co"># 找6个击球数100的选手进行分配</span></a>
<a class="sourceLine" id="cb146-2" data-line-number="2">batter100 &lt;-<span class="st"> </span>career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb146-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">==</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb146-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(average)</a>
<a class="sourceLine" id="cb146-5" data-line-number="5">batter100</a></code></pre></div>
<pre><code>## # A tibble: 6 x 8
##   playerID  name            bats      H    AB  year average isPitcher
##   &lt;chr&gt;     &lt;chr&gt;           &lt;fct&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt;    
## 1 dejesjo01 Jose de Jesus   R        11   100 1990.    0.11 TRUE     
## 2 mahonmi02 Mike Mahoney    R        18   100 2002.    0.18 FALSE    
## 3 cancero01 Robinson Cancel R        20   100 2007.    0.2  FALSE    
## 4 buschmi01 Mike Busch      R        22   100 1996.    0.22 FALSE    
## 5 verdual01 Alex Verdugo    L        24   100 2018.    0.24 FALSE    
## 6 shealry01 Ryan Shealy     R        32   100 2006.    0.32 FALSE</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1"><span class="co"># 前面算法得到的最终结果</span></a>
<a class="sourceLine" id="cb148-2" data-line-number="2">fit_iterations</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   iteration cluster alpha  beta number prior
##   &lt;chr&gt;     &lt;fct&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt; &lt;dbl&gt;
## 1 1         A        12.6  45.0   1764 0.488
## 2 1         B        12.2  44.0   1851 0.512
## 3 2         B        12.4  44.5   3615 1    
## 4 3         B        12.4  44.5   3615 1    
## 5 4         B        12.4  44.5   3615 1    
## 6 5         B        12.4  44.5   3615 1</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1">final_parameters &lt;-<span class="st"> </span>fit_iterations <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb150-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(iteration <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb150-3" data-line-number="3"></a>
<a class="sourceLine" id="cb150-4" data-line-number="4">final_parameters</a></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   iteration cluster alpha  beta number prior
##   &lt;chr&gt;     &lt;fct&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt; &lt;dbl&gt;
## 1 1         A        12.6  45.0   1764 0.488
## 2 1         B        12.2  44.0   1851 0.512</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1"><span class="co"># 观察球员位置</span></a>
<a class="sourceLine" id="cb152-2" data-line-number="2">final_parameters <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb152-3" data-line-number="3"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">x =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">45</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb152-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> prior <span class="op">*</span><span class="st"> </span>VGAM<span class="op">::</span><span class="kw">dbetabinom.ab</span>(x, <span class="dv">100</span>, alpha, beta)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb152-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, density)) <span class="op">+</span></a>
<a class="sourceLine" id="cb152-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> cluster)) <span class="op">+</span></a>
<a class="sourceLine" id="cb152-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> H), <span class="dt">data =</span> batter100, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb152-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> H, <span class="dt">y =</span> <span class="fl">-.022</span>, <span class="dt">label =</span> name), <span class="dt">data =</span> batter100, <span class="dt">hjust =</span> <span class="dv">1</span>, <span class="dt">vjust =</span> <span class="dv">1</span>, <span class="dt">angle =</span> <span class="dv">270</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb152-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;H (out of 100 at-bats)&quot;</span>,</a>
<a class="sourceLine" id="cb152-10" data-line-number="10">       <span class="dt">y =</span> <span class="st">&quot;Likelihood of this H out of 100 hits&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/assign-1.png" width="672" /></p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1"><span class="co"># 根据贝叶斯理论，我们可以用在A分组的似然度比上两个分组似然度的和得到后验概率</span></a>
<a class="sourceLine" id="cb153-2" data-line-number="2"></a>
<a class="sourceLine" id="cb153-3" data-line-number="3">final_parameters <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb153-4" data-line-number="4"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">H =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">40</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb153-5" data-line-number="5"><span class="st">  </span><span class="kw">transmute</span>(H, cluster, <span class="dt">likelihood =</span> prior <span class="op">*</span><span class="st"> </span>VGAM<span class="op">::</span><span class="kw">dbetabinom.ab</span>(H, <span class="dv">100</span>, alpha, beta)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb153-6" data-line-number="6"><span class="st">  </span><span class="kw">spread</span>(cluster, likelihood) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb153-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">probabilityA =</span> A <span class="op">/</span>(A <span class="op">+</span><span class="st"> </span>B)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb153-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(H, probabilityA)) <span class="op">+</span></a>
<a class="sourceLine" id="cb153-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb153-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> H), <span class="dt">data =</span> batter100, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb153-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> H, <span class="dt">y =</span> <span class="dv">0</span>, <span class="dt">label =</span> name), <span class="dt">data =</span> batter100, <span class="dt">hjust =</span> <span class="dv">1</span>, <span class="dt">vjust =</span> <span class="dv">1</span>, <span class="dt">angle =</span> <span class="dv">270</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb153-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;H (out of 100 at-bats)&quot;</span>,</a>
<a class="sourceLine" id="cb153-13" data-line-number="13">        <span class="dt">y =</span> <span class="st">&quot;(Likelihood if pitcher) / (Likelihood if pitcher + Likelihood if not)&quot;</span>,</a>
<a class="sourceLine" id="cb153-14" data-line-number="14">        <span class="dt">title =</span> <span class="st">&quot;Posterior probability a player is in the pitcher cluster&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/assign-2.png" width="672" /></p>
<ul>
<li>通过构建后验概率，我们可以直接对结果基于概率进行分组</li>
</ul>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1">career_likelihoods &lt;-<span class="st"> </span>career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-3" data-line-number="3"><span class="st">  </span><span class="kw">crossing</span>(final_parameters) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">likelihood =</span> prior <span class="op">*</span><span class="st"> </span>VGAM<span class="op">::</span><span class="kw">dbetabinom.ab</span>(H, AB, alpha, beta)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">posterior =</span> likelihood <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(likelihood))</a>
<a class="sourceLine" id="cb154-7" data-line-number="7"></a>
<a class="sourceLine" id="cb154-8" data-line-number="8">career_assignments &lt;-<span class="st"> </span>career_likelihoods <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-9" data-line-number="9"><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">1</span>, posterior) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-10" data-line-number="10"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb154-11" data-line-number="11"><span class="co"># 对比这种分组与实际数据的结果</span></a>
<a class="sourceLine" id="cb154-12" data-line-number="12">career_assignments <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-13" data-line-number="13"><span class="st">  </span><span class="kw">filter</span>(posterior <span class="op">&gt;</span><span class="st"> </span><span class="fl">.8</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-14" data-line-number="14"><span class="st">  </span><span class="kw">count</span>(isPitcher, cluster) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-15" data-line-number="15"><span class="st">  </span><span class="kw">spread</span>(cluster, n)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   isPitcher `&lt;NA&gt;`
##   &lt;lgl&gt;      &lt;int&gt;
## 1 NA             0</code></pre>
<ul>
<li>这样基于对概率分布的观察，我们可以实现有现实意义的分组，对分组的改进则需要对数据的进一步理解</li>
</ul>
</div>
<div id="经验贝叶斯收缩" class="section level3">
<h3><span class="header-section-number">10.14.3</span> 经验贝叶斯收缩</h3>
<ul>
<li>混合模型下前面所做的工作都需要重新考虑</li>
</ul>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1"><span class="co"># 观察击球数100选手的后验概率分布</span></a>
<a class="sourceLine" id="cb156-2" data-line-number="2">batting_data &lt;-<span class="st"> </span>career_likelihoods <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-3" data-line-number="3"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">==</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">paste0</span>(name, <span class="st">&quot; (&quot;</span>, H, <span class="st">&quot;/&quot;</span>, AB, <span class="st">&quot;)&quot;</span>),</a>
<a class="sourceLine" id="cb156-6" data-line-number="6">         <span class="dt">name =</span> <span class="kw">reorder</span>(name, H),</a>
<a class="sourceLine" id="cb156-7" data-line-number="7">         <span class="dt">alpha1 =</span> H <span class="op">+</span><span class="st"> </span>alpha,</a>
<a class="sourceLine" id="cb156-8" data-line-number="8">         <span class="dt">beta1 =</span> AB <span class="op">-</span><span class="st"> </span>H <span class="op">+</span><span class="st"> </span>beta)</a>
<a class="sourceLine" id="cb156-9" data-line-number="9"></a>
<a class="sourceLine" id="cb156-10" data-line-number="10">batting_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-11" data-line-number="11"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">.4</span>, <span class="fl">.001</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">posterior_density =</span> posterior <span class="op">*</span><span class="st"> </span><span class="kw">dbeta</span>(x, alpha1, beta1)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-13" data-line-number="13"><span class="st">  </span><span class="kw">group_by</span>(name, x) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-14" data-line-number="14"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">posterior_density =</span> <span class="kw">sum</span>(posterior_density)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, posterior_density, <span class="dt">color =</span> name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb156-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb156-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> average), <span class="dt">data =</span> batting_data, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb156-18" data-line-number="18"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>name) <span class="op">+</span></a>
<a class="sourceLine" id="cb156-19" data-line-number="19"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Batting average (actual average shown as dashed line)&quot;</span>,</a>
<a class="sourceLine" id="cb156-20" data-line-number="20">       <span class="dt">y =</span> <span class="st">&quot;Posterior density after updating&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/ebayesem-1.png" width="672" /></p>
<ul>
<li>此时不太好判断属于哪一分布，可采用后验概率对平均分布进行加权</li>
</ul>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1">eb_shrinkage &lt;-<span class="st"> </span>career_likelihoods <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">shrunken_average =</span> (H <span class="op">+</span><span class="st"> </span>alpha) <span class="op">/</span><span class="st"> </span>(AB <span class="op">+</span><span class="st"> </span>alpha <span class="op">+</span><span class="st"> </span>beta)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">shrunken_average =</span> <span class="kw">sum</span>(posterior <span class="op">*</span><span class="st"> </span>shrunken_average))</a>
<a class="sourceLine" id="cb157-5" data-line-number="5"><span class="co"># 观察加权分布</span></a>
<a class="sourceLine" id="cb157-6" data-line-number="6">eb_shrinkage <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-7" data-line-number="7"><span class="st">  </span><span class="kw">inner_join</span>(career) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-8" data-line-number="8"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">&gt;</span><span class="st"> </span><span class="dv">50</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-9" data-line-number="9"><span class="st">  </span><span class="kw">gather</span>(type, value, average, shrunken_average) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="kw">ifelse</span>(type <span class="op">==</span><span class="st"> &quot;average&quot;</span>, <span class="st">&quot;Raw batting average&quot;</span>, <span class="st">&quot;Average posterior&quot;</span>),</a>
<a class="sourceLine" id="cb157-11" data-line-number="11">         <span class="dt">type =</span> <span class="kw">relevel</span>(<span class="kw">factor</span>(type), <span class="st">&quot;Raw batting average&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-12" data-line-number="12"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(AB, value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb157-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb157-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>type) <span class="op">+</span></a>
<a class="sourceLine" id="cb157-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb157-16" data-line-number="16"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Estimate&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/weightdist-1.png" width="672" />
- 收敛后的分布会朝向两个中心而不是一个，并非所有之前的方法（例如区间估计）都可以适用到混合模型里，需要根据实际情况进行分析</p>
</div>
</div>
<div id="模拟验证结果" class="section level2">
<h2><span class="header-section-number">10.15</span> 模拟验证结果</h2>
<ul>
<li>上面的经验贝叶斯推断大都是给出的结果，我们需要对其进行模拟验证</li>
</ul>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1">pitchers &lt;-<span class="st"> </span>Pitching <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">gamesPitched =</span> <span class="kw">sum</span>(G)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(gamesPitched <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb158-5" data-line-number="5">career &lt;-<span class="st"> </span>Batting <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-7" data-line-number="7"><span class="st">  </span><span class="kw">anti_join</span>(pitchers, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-8" data-line-number="8"><span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-9" data-line-number="9"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">H =</span> <span class="kw">sum</span>(H), <span class="dt">AB =</span> <span class="kw">sum</span>(AB))</a>
<a class="sourceLine" id="cb158-10" data-line-number="10"><span class="co"># 从数据中找到贝塔分布的两个参数</span></a>
<a class="sourceLine" id="cb158-11" data-line-number="11"><span class="kw">library</span>(ebbr)</a>
<a class="sourceLine" id="cb158-12" data-line-number="12">prior &lt;-<span class="st"> </span>career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-13" data-line-number="13"><span class="st">  </span><span class="kw">ebb_fit_prior</span>(H, AB)</a>
<a class="sourceLine" id="cb158-14" data-line-number="14"></a>
<a class="sourceLine" id="cb158-15" data-line-number="15">prior</a></code></pre></div>
<pre><code>## Empirical Bayes binomial fit with method mle 
## Parameters:
## # A tibble: 1 x 2
##   alpha  beta
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  72.9  218.</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1"><span class="co"># 用这两个参数生成球员的击球概率</span></a>
<a class="sourceLine" id="cb160-2" data-line-number="2">alpha0 &lt;-<span class="st"> </span><span class="kw">tidy</span>(prior)<span class="op">$</span>alpha</a>
<a class="sourceLine" id="cb160-3" data-line-number="3">beta0 &lt;-<span class="st"> </span><span class="kw">tidy</span>(prior)<span class="op">$</span>beta</a>
<a class="sourceLine" id="cb160-4" data-line-number="4"></a>
<a class="sourceLine" id="cb160-5" data-line-number="5"><span class="kw">qplot</span>(<span class="kw">rbeta</span>(<span class="dv">10000</span>, alpha0, beta0))</a></code></pre></div>
<p><img src="datadown_files/figure-html/dtpre-1.png" width="672" /></p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" data-line-number="1"><span class="co"># 击球数使用原始数据</span></a>
<a class="sourceLine" id="cb161-2" data-line-number="2"><span class="kw">ggplot</span>(career, <span class="kw">aes</span>(AB)) <span class="op">+</span></a>
<a class="sourceLine" id="cb161-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb161-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<p><img src="datadown_files/figure-html/dtpre-2.png" width="672" /></p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1"><span class="co"># 构建仿真数据</span></a>
<a class="sourceLine" id="cb162-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">2017</span>)</a>
<a class="sourceLine" id="cb162-3" data-line-number="3"></a>
<a class="sourceLine" id="cb162-4" data-line-number="4">career_sim &lt;-<span class="st"> </span>career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb162-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p =</span> <span class="kw">rbeta</span>(<span class="kw">n</span>(), alpha0, beta0),</a>
<a class="sourceLine" id="cb162-6" data-line-number="6">         <span class="dt">H =</span> <span class="kw">rbinom</span>(<span class="kw">n</span>(), AB, p))</a>
<a class="sourceLine" id="cb162-7" data-line-number="7"></a>
<a class="sourceLine" id="cb162-8" data-line-number="8">career_sim</a></code></pre></div>
<pre><code>## # A tibble: 10,800 x 4
##    playerID      H    AB     p
##    &lt;chr&gt;     &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1 aaronha01  3665 12364 0.298
##  2 aaronto01   249   944 0.249
##  3 abadan01      6    21 0.273
##  4 abadijo01    10    49 0.198
##  5 abbated01   790  3044 0.249
##  6 abbeych01   460  1756 0.264
##  7 abbotda01     3     7 0.191
##  8 abbotfr01   132   513 0.251
##  9 abbotje01   151   596 0.243
## 10 abbotku01   535  2044 0.261
## # … with 10,790 more rows</code></pre>
<div id="模拟对分布参数的估计" class="section level3">
<h3><span class="header-section-number">10.15.1</span> 模拟对分布参数的估计</h3>
<ul>
<li>生产数据后我们可以估计分布参数，看能否与模拟值对应</li>
</ul>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1">career_sim_eb &lt;-<span class="st"> </span>career_sim <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-2" data-line-number="2"><span class="st">  </span><span class="kw">add_ebb_estimate</span>(H, AB)</a>
<a class="sourceLine" id="cb164-3" data-line-number="3"></a>
<a class="sourceLine" id="cb164-4" data-line-number="4">career_sim_gathered &lt;-<span class="st"> </span>career_sim_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-5" data-line-number="5"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">Shrunken =</span> .fitted, <span class="dt">Raw =</span> .raw) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-6" data-line-number="6"><span class="st">  </span><span class="kw">gather</span>(type, estimate, Shrunken, Raw)</a>
<a class="sourceLine" id="cb164-7" data-line-number="7"><span class="co"># 观察是否能收敛数据</span></a>
<a class="sourceLine" id="cb164-8" data-line-number="8">career_sim_gathered <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-9" data-line-number="9"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(p, estimate, <span class="dt">color =</span> AB)) <span class="op">+</span></a>
<a class="sourceLine" id="cb164-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb164-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb164-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb164-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_color_continuous</span>(<span class="dt">trans =</span> <span class="st">&quot;log&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb164-15" data-line-number="15"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>type) <span class="op">+</span></a>
<a class="sourceLine" id="cb164-16" data-line-number="16"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;True batting average (p)&quot;</span>,</a>
<a class="sourceLine" id="cb164-17" data-line-number="17">       <span class="dt">y =</span> <span class="st">&quot;Raw or shrunken batting average&quot;</span>,</a>
<a class="sourceLine" id="cb164-18" data-line-number="18">       <span class="dt">title =</span> <span class="st">&quot;Empirical Bayes shrinkage reduces variance, but causes bias&quot;</span>,</a>
<a class="sourceLine" id="cb164-19" data-line-number="19">       <span class="dt">subtitle =</span> <span class="st">&quot;Red line is x = y; dashed white line is a linear fit&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/simhpara-1.png" width="672" /></p>
<ul>
<li><p>我们可以看到，估计方差有了一定收敛，但出现了一定偏差，可参考统计学习中方差-偏差权衡的描述</p></li>
<li><p>可以用均方误来衡量，此处虽牺牲了偏差，但整体误差降低了</p></li>
</ul>
<p><span class="math display">\[\mbox{MSE}=\frac{1}{n}\sum_{1}^{n}(p-\hat{p})^2\]</span></p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1">career_sim_gathered <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb165-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(type) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb165-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mse =</span> <span class="kw">mean</span>((estimate <span class="op">-</span><span class="st"> </span>p) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   type          mse
##   &lt;chr&gt;       &lt;dbl&gt;
## 1 Raw      0.0152  
## 2 Shrunken 0.000347</code></pre>
<ul>
<li>注意到击球数可能影响收敛，所以可以探索其对均方误的影响</li>
</ul>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1">metric_by_bin &lt;-<span class="st"> </span>career_sim_gathered <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(type, <span class="dt">AB =</span> <span class="dv">10</span> <span class="op">^</span><span class="st"> </span>(<span class="kw">round</span>(<span class="kw">log10</span>(AB)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mse =</span> <span class="kw">mean</span>((estimate <span class="op">-</span><span class="st"> </span>p) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb167-4" data-line-number="4"></a>
<a class="sourceLine" id="cb167-5" data-line-number="5"><span class="kw">ggplot</span>(metric_by_bin, <span class="kw">aes</span>(AB, mse, <span class="dt">color =</span> type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb167-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb167-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb167-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb167-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Number of at-bats (AB)&quot;</span>,</a>
<a class="sourceLine" id="cb167-10" data-line-number="10">       <span class="dt">y =</span> <span class="st">&quot;Mean-squared-error within this bin (note log scale)&quot;</span>,</a>
<a class="sourceLine" id="cb167-11" data-line-number="11">       <span class="dt">title =</span> <span class="st">&quot;Mean squared error is higher with raw estimate, especially for low AB&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/simAB-1.png" width="672" /></p>
<ul>
<li>击球数越多，均方误越低，此时可进一步探索</li>
</ul>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1"><span class="kw">library</span>(scales)</a>
<a class="sourceLine" id="cb168-2" data-line-number="2"><span class="co"># 观察斜率p值变化</span></a>
<a class="sourceLine" id="cb168-3" data-line-number="3">career_sim_gathered <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">AB =</span> <span class="dv">10</span> <span class="op">^</span><span class="st"> </span>(<span class="kw">round</span>(<span class="kw">log10</span>(AB)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(AB <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-6" data-line-number="6"><span class="st">  </span><span class="kw">nest</span>(<span class="op">-</span>type, <span class="op">-</span>AB) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model=</span><span class="kw">map</span>(data, <span class="op">~</span><span class="st"> </span><span class="kw">tidy</span>(<span class="kw">lm</span>(estimate <span class="op">~</span><span class="st"> </span>p, .)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-8" data-line-number="8"><span class="st">  </span><span class="kw">unnest</span>(model) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-9" data-line-number="9"><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;p&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(AB, estimate, <span class="dt">color =</span> type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb168-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">1</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-14" data-line-number="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Number of at-bats (AB)&quot;</span>,</a>
<a class="sourceLine" id="cb168-15" data-line-number="15">       <span class="dt">y =</span> <span class="st">&quot;Slope of estimate/p within this bin&quot;</span>,</a>
<a class="sourceLine" id="cb168-16" data-line-number="16">       <span class="dt">title =</span> <span class="st">&quot;Shrunken estimates introduce bias for low AB&quot;</span>,</a>
<a class="sourceLine" id="cb168-17" data-line-number="17">       <span class="dt">subtitle =</span> <span class="st">&quot;Note that an unbiased estimate would have a slope of 0&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/simp-1.png" width="672" /></p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" data-line-number="1"><span class="co"># 分层</span></a>
<a class="sourceLine" id="cb169-2" data-line-number="2">career_sim_gathered <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb169-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ab_bin =</span> <span class="kw">cut</span>(AB, <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb169-4" data-line-number="4">                      <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;1-10&quot;</span>, <span class="st">&quot;11-100&quot;</span>, <span class="st">&quot;101-1000&quot;</span>, <span class="st">&quot;1000+&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb169-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(p, estimate, <span class="dt">color =</span> AB)) <span class="op">+</span></a>
<a class="sourceLine" id="cb169-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb169-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb169-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb169-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_color_continuous</span>(<span class="dt">trans =</span> <span class="st">&quot;log&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb169-10" data-line-number="10"><span class="st">  </span><span class="kw">facet_grid</span>(ab_bin <span class="op">~</span><span class="st"> </span>type, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb169-11" data-line-number="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;True batting average (p)&quot;</span>,</a>
<a class="sourceLine" id="cb169-12" data-line-number="12">       <span class="dt">y =</span> <span class="st">&quot;Raw or shrunken estimate&quot;</span>,</a>
<a class="sourceLine" id="cb169-13" data-line-number="13">       <span class="dt">title =</span> <span class="st">&quot;Empirical Bayes shrinkage reduces variance, but introduces bias&quot;</span>,</a>
<a class="sourceLine" id="cb169-14" data-line-number="14">       <span class="dt">subtitle =</span> <span class="st">&quot;Red line is x = y; dashed white line is a linear fit&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/simp-2.png" width="672" /></p>
<ul>
<li>击球数越多，越接近真相</li>
</ul>
</div>
<div id="区间估计" class="section level3">
<h3><span class="header-section-number">10.15.2</span> 区间估计</h3>
<ul>
<li>检验区间估计是否覆盖95%的真值</li>
</ul>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" data-line-number="1">career_sim_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb170-2" data-line-number="2"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">coverage =</span> <span class="kw">mean</span>(.low <span class="op">&lt;=</span><span class="st"> </span>p <span class="op">&amp;</span><span class="st"> </span>p <span class="op">&lt;=</span><span class="st"> </span>.high))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   coverage
##      &lt;dbl&gt;
## 1    0.945</code></pre>
<ul>
<li>观察不同区间的覆盖范围</li>
</ul>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" data-line-number="1">sim_prior &lt;-<span class="st"> </span><span class="kw">ebb_fit_prior</span>(career_sim, H, AB)</a>
<a class="sourceLine" id="cb172-2" data-line-number="2">estimate_by_cred_level &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">level =</span> <span class="kw">seq</span>(.<span class="dv">5</span>, <span class="fl">.98</span>, <span class="fl">.02</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb172-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model=</span><span class="kw">map</span>(level, <span class="op">~</span><span class="st"> </span><span class="kw">augment</span>(sim_prior, career_sim, <span class="dt">cred_level =</span> .))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb172-4" data-line-number="4"><span class="st">  </span><span class="kw">unnest</span>(model)</a>
<a class="sourceLine" id="cb172-5" data-line-number="5"></a>
<a class="sourceLine" id="cb172-6" data-line-number="6">estimate_by_cred_level <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb172-7" data-line-number="7"><span class="st">  </span><span class="kw">group_by</span>(level) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb172-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cover =</span> .low <span class="op">&lt;=</span><span class="st"> </span>p <span class="op">&amp;</span><span class="st"> </span>p <span class="op">&lt;=</span><span class="st"> </span>.high) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb172-9" data-line-number="9"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">coverage =</span> <span class="kw">mean</span>(cover)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb172-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(level, coverage)) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb172-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-13" data-line-number="13"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Level of credible interval&quot;</span>,</a>
<a class="sourceLine" id="cb172-14" data-line-number="14">       <span class="dt">y =</span> <span class="st">&quot;Probability credible interval contains the true value&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/simmint-1.png" width="672" /></p>
<ul>
<li>结果基本吻合，说明区间估计也比较准</li>
</ul>
</div>
<div id="错误发现率-1" class="section level3">
<h3><span class="header-section-number">10.15.3</span> 错误发现率</h3>
<ul>
<li>看一下进入名人堂的人</li>
</ul>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" data-line-number="1">pt &lt;-<span class="st"> </span>career_sim_eb <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb173-2" data-line-number="2"><span class="st">  </span><span class="kw">add_ebb_prop_test</span>(.<span class="dv">3</span>, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb173-3" data-line-number="3"></a>
<a class="sourceLine" id="cb173-4" data-line-number="4"><span class="co"># 错误发现率控制为10%</span></a>
<a class="sourceLine" id="cb173-5" data-line-number="5">hall_of_fame &lt;-<span class="st"> </span>pt <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb173-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(.qvalue <span class="op">&lt;=</span><span class="st"> </span><span class="fl">.1</span>)</a>
<a class="sourceLine" id="cb173-7" data-line-number="7"></a>
<a class="sourceLine" id="cb173-8" data-line-number="8"><span class="kw">mean</span>(hall_of_fame<span class="op">$</span>p <span class="op">&lt;</span><span class="st"> </span><span class="fl">.3</span>)</a></code></pre></div>
<pre><code>## [1] 0.157</code></pre>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" data-line-number="1"><span class="co"># 观察整体错误发现率的变动</span></a>
<a class="sourceLine" id="cb175-2" data-line-number="2">pt <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb175-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">true_fdr =</span> <span class="kw">cummean</span>(p <span class="op">&lt;</span><span class="st"> </span><span class="fl">.3</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb175-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(.qvalue, true_fdr)) <span class="op">+</span></a>
<a class="sourceLine" id="cb175-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb175-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb175-7" data-line-number="7"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;q-value&quot;</span>,</a>
<a class="sourceLine" id="cb175-8" data-line-number="8">       <span class="dt">y =</span> <span class="st">&quot;True FDR at this q-value threshold&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/simfdr-1.png" width="672" /></p>
</div>
<div id="贝塔二项回归" class="section level3">
<h3><span class="header-section-number">10.15.4</span> 贝塔二项回归</h3>
<ul>
<li>看下影响因素</li>
</ul>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" data-line-number="1"><span class="co"># 回归值</span></a>
<a class="sourceLine" id="cb176-2" data-line-number="2">bb_reg &lt;-<span class="st"> </span>career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb176-3" data-line-number="3"><span class="st">  </span><span class="kw">ebb_fit_prior</span>(H, AB, <span class="dt">method =</span> <span class="st">&quot;gamlss&quot;</span>, <span class="dt">mu_predictors =</span> <span class="op">~</span><span class="st"> </span><span class="kw">log10</span>(AB))</a>
<a class="sourceLine" id="cb176-4" data-line-number="4"></a>
<a class="sourceLine" id="cb176-5" data-line-number="5"><span class="kw">tidy</span>(bb_reg)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 6
##   parameter term        estimate std.error statistic p.value
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 mu        (Intercept)   -1.69    0.00885    -191.        0
## 2 mu        log10(AB)      0.192   0.00273      70.2       0
## 3 sigma     (Intercept)   -6.31    0.0227     -278.        0</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">2017</span>)</a>
<a class="sourceLine" id="cb178-2" data-line-number="2"></a>
<a class="sourceLine" id="cb178-3" data-line-number="3">career_sim_ab &lt;-<span class="st"> </span><span class="kw">augment</span>(bb_reg, career) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb178-4" data-line-number="4"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(playerID, AB, <span class="dt">true_alpha0 =</span> .alpha0, <span class="dt">true_beta0 =</span> .beta0) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb178-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p =</span> <span class="kw">rbeta</span>(<span class="kw">n</span>(), true_alpha0, true_beta0),</a>
<a class="sourceLine" id="cb178-6" data-line-number="6">         <span class="dt">H =</span> <span class="kw">rbinom</span>(<span class="kw">n</span>(), AB, p))</a>
<a class="sourceLine" id="cb178-7" data-line-number="7"><span class="co"># 真实值</span></a>
<a class="sourceLine" id="cb178-8" data-line-number="8">career_ab_prior &lt;-<span class="st"> </span>career_sim_ab <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb178-9" data-line-number="9"><span class="st">  </span><span class="kw">ebb_fit_prior</span>(H, AB, <span class="dt">method =</span> <span class="st">&quot;gamlss&quot;</span>, <span class="dt">mu_predictors =</span> <span class="op">~</span><span class="st"> </span><span class="kw">log10</span>(AB))</a>
<a class="sourceLine" id="cb178-10" data-line-number="10"></a>
<a class="sourceLine" id="cb178-11" data-line-number="11"><span class="co"># 对比</span></a>
<a class="sourceLine" id="cb178-12" data-line-number="12"><span class="kw">tidy</span>(career_ab_prior)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 6
##   parameter term        estimate std.error statistic p.value
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 mu        (Intercept)   -1.67    0.00880    -190.        0
## 2 mu        log10(AB)      0.187   0.00272      69.0       0
## 3 sigma     (Intercept)   -6.32    0.0267     -237.        0</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" data-line-number="1"><span class="co"># 观察击球数影响</span></a>
<a class="sourceLine" id="cb180-2" data-line-number="2">career_flat_prior &lt;-<span class="st"> </span>career_sim_ab <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb180-3" data-line-number="3"><span class="st">  </span><span class="kw">ebb_fit_prior</span>(H, AB)</a>
<a class="sourceLine" id="cb180-4" data-line-number="4"></a>
<a class="sourceLine" id="cb180-5" data-line-number="5"><span class="kw">data_frame</span>(<span class="dt">method =</span> <span class="kw">c</span>(<span class="st">&quot;Flat prior&quot;</span>, <span class="st">&quot;Prior depending on AB&quot;</span>),</a>
<a class="sourceLine" id="cb180-6" data-line-number="6">           <span class="dt">model =</span> <span class="kw">list</span>(career_flat_prior, career_ab_prior)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb180-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model=</span><span class="kw">map</span>(model, augment, <span class="dt">data =</span> career_sim_ab)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb180-8" data-line-number="8"><span class="st">  </span><span class="kw">unnest</span>(model) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb180-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(p, .fitted, <span class="dt">color =</span> AB)) <span class="op">+</span></a>
<a class="sourceLine" id="cb180-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb180-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_color_continuous</span>(<span class="dt">trans =</span> <span class="st">&quot;log&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb180-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb180-13" data-line-number="13"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>method) <span class="op">+</span></a>
<a class="sourceLine" id="cb180-14" data-line-number="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;True batting average (p)&quot;</span>,</a>
<a class="sourceLine" id="cb180-15" data-line-number="15">       <span class="dt">y =</span> <span class="st">&quot;Shrunken batting average estimate&quot;</span>)</a></code></pre></div>
<p><img src="datadown_files/figure-html/simbbreg-1.png" width="672" /></p>
</div>
<div id="重复模拟" class="section level3">
<h3><span class="header-section-number">10.15.5</span> 重复模拟</h3>
<ul>
<li>为防止意外或运气可以重复模拟看看</li>
</ul>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">2019</span>)</a>
<a class="sourceLine" id="cb181-2" data-line-number="2"></a>
<a class="sourceLine" id="cb181-3" data-line-number="3">sim_replications &lt;-<span class="st"> </span>career <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-4" data-line-number="4"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">replication =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">50</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p =</span> <span class="kw">rbeta</span>(<span class="kw">n</span>(), alpha0, beta0),</a>
<a class="sourceLine" id="cb181-6" data-line-number="6">         <span class="dt">H =</span> <span class="kw">rbinom</span>(<span class="kw">n</span>(), AB, p))</a>
<a class="sourceLine" id="cb181-7" data-line-number="7"></a>
<a class="sourceLine" id="cb181-8" data-line-number="8">sim_replications</a>
<a class="sourceLine" id="cb181-9" data-line-number="9"></a>
<a class="sourceLine" id="cb181-10" data-line-number="10">sim_replication_models &lt;-<span class="st"> </span>sim_replications <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-11" data-line-number="11"><span class="st">  </span><span class="kw">nest</span>(<span class="op">-</span>replication) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> purrr<span class="op">::</span><span class="kw">map</span>(data, <span class="op">~</span><span class="st"> </span><span class="kw">ebb_fit_prior</span>(., H, AB)))</a>
<a class="sourceLine" id="cb181-13" data-line-number="13"></a>
<a class="sourceLine" id="cb181-14" data-line-number="14"><span class="co"># 估计参数</span></a>
<a class="sourceLine" id="cb181-15" data-line-number="15">sim_replication_priors &lt;-<span class="st"> </span>sim_replication_models <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model=</span> <span class="kw">map</span>(prior, tidy)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-17" data-line-number="17"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(data,prior)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-18" data-line-number="18"><span class="st">  </span><span class="kw">unnest</span>(model)</a>
<a class="sourceLine" id="cb181-19" data-line-number="19"></a>
<a class="sourceLine" id="cb181-20" data-line-number="20">sim_replication_priors</a>
<a class="sourceLine" id="cb181-21" data-line-number="21"></a>
<a class="sourceLine" id="cb181-22" data-line-number="22">true_values &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">parameter =</span> <span class="kw">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;mean&quot;</span>),</a>
<a class="sourceLine" id="cb181-23" data-line-number="23">                          <span class="dt">true =</span> <span class="kw">c</span>(alpha0, beta0, alpha0 <span class="op">/</span><span class="st"> </span>(alpha0 <span class="op">+</span><span class="st"> </span>beta0)))</a>
<a class="sourceLine" id="cb181-24" data-line-number="24"></a>
<a class="sourceLine" id="cb181-25" data-line-number="25">sim_replication_priors <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-26" data-line-number="26"><span class="st">  </span><span class="kw">gather</span>(parameter, value, <span class="op">-</span>replication) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-27" data-line-number="27"><span class="st">  </span><span class="kw">inner_join</span>(true_values, <span class="dt">by =</span> <span class="st">&quot;parameter&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-28" data-line-number="28"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dv">1</span>, value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-29" data-line-number="29"><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb181-30" data-line-number="30"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> true), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-31" data-line-number="31"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>parameter, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-32" data-line-number="32"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb181-33" data-line-number="33">       <span class="dt">y =</span> <span class="st">&quot;Estimated parameter (true value shown as red line)&quot;</span>,</a>
<a class="sourceLine" id="cb181-34" data-line-number="34">       <span class="dt">title =</span> <span class="st">&quot;Estimated hyperparameters across 50 replications&quot;</span>)</a>
<a class="sourceLine" id="cb181-35" data-line-number="35"></a>
<a class="sourceLine" id="cb181-36" data-line-number="36"><span class="co"># 估计区间与假设检验</span></a>
<a class="sourceLine" id="cb181-37" data-line-number="37"></a>
<a class="sourceLine" id="cb181-38" data-line-number="38"><span class="co">## 估计均方误</span></a>
<a class="sourceLine" id="cb181-39" data-line-number="39">sim_replication_au &lt;-<span class="st"> </span>sim_replication_models <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-40" data-line-number="40"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model=</span><span class="kw">map2</span>(prior, data, augment)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-41" data-line-number="41"><span class="st">  </span><span class="kw">unnest</span>(model)</a>
<a class="sourceLine" id="cb181-42" data-line-number="42"></a>
<a class="sourceLine" id="cb181-43" data-line-number="43">sim_replication_mse &lt;-<span class="st"> </span>sim_replication_au <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-44" data-line-number="44"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">Raw =</span> .raw, <span class="dt">Shrunken =</span> .fitted) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-45" data-line-number="45"><span class="st">  </span><span class="kw">gather</span>(type, estimate, Raw, Shrunken) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-46" data-line-number="46"><span class="st">  </span><span class="kw">group_by</span>(type, replication) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-47" data-line-number="47"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mse =</span> <span class="kw">mean</span>((estimate <span class="op">-</span><span class="st"> </span>p) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb181-48" data-line-number="48"></a>
<a class="sourceLine" id="cb181-49" data-line-number="49"><span class="kw">ggplot</span>(sim_replication_mse, <span class="kw">aes</span>(type, mse)) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-50" data-line-number="50"><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb181-51" data-line-number="51"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Mean squared error across 50 replications&quot;</span>)</a>
<a class="sourceLine" id="cb181-52" data-line-number="52"><span class="co">## 估计区间</span></a>
<a class="sourceLine" id="cb181-53" data-line-number="53">sim_replication_au <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-54" data-line-number="54"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cover =</span> .low <span class="op">&lt;=</span><span class="st"> </span>p <span class="op">&amp;</span><span class="st"> </span>p <span class="op">&lt;=</span><span class="st"> </span>.high) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-55" data-line-number="55"><span class="st">  </span><span class="kw">group_by</span>(replication) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-56" data-line-number="56"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">coverage =</span> <span class="kw">mean</span>(cover)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-57" data-line-number="57"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(coverage)) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-58" data-line-number="58"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">.001</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-59" data-line-number="59"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;% of time true value was in a 95% confidence interval&quot;</span>,</a>
<a class="sourceLine" id="cb181-60" data-line-number="60">       <span class="dt">title =</span> <span class="st">&quot;95% credible interval is well calibrated across replications&quot;</span>)</a>
<a class="sourceLine" id="cb181-61" data-line-number="61"></a>
<a class="sourceLine" id="cb181-62" data-line-number="62">sim_replication_intervals &lt;-<span class="st"> </span>sim_replication_models <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-63" data-line-number="63"><span class="st">  </span><span class="kw">expand_grid</span>(<span class="dt">cred_level =</span> <span class="kw">c</span>(<span class="kw">seq</span>(.<span class="dv">5</span>, <span class="fl">.9</span>, <span class="fl">.05</span>), <span class="fl">.95</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-64" data-line-number="64"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model=</span><span class="kw">pmap</span>(<span class="kw">list</span>(prior, data, <span class="dt">cred_level =</span> cred_level), augment)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-65" data-line-number="65"><span class="st">  </span><span class="kw">unnest</span>(model) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-66" data-line-number="66"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(replication, cred_level, p, .low, .high)</a>
<a class="sourceLine" id="cb181-67" data-line-number="67"></a>
<a class="sourceLine" id="cb181-68" data-line-number="68">sim_replication_intervals <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-69" data-line-number="69"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cover =</span> .low <span class="op">&lt;=</span><span class="st"> </span>p <span class="op">&amp;</span><span class="st"> </span>p <span class="op">&lt;=</span><span class="st"> </span>.high) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-70" data-line-number="70"><span class="st">  </span><span class="kw">group_by</span>(replication, cred_level) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-71" data-line-number="71"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">coverage =</span> <span class="kw">mean</span>(cover)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-72" data-line-number="72"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(cred_level, coverage, <span class="dt">group =</span> replication)) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-73" data-line-number="73"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-74" data-line-number="74"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-75" data-line-number="75"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Credibility level&quot;</span>,</a>
<a class="sourceLine" id="cb181-76" data-line-number="76">       <span class="dt">y =</span> <span class="st">&quot;% of credible intervals in this replication that contain the true parameter&quot;</span>,</a>
<a class="sourceLine" id="cb181-77" data-line-number="77">       <span class="dt">title =</span> <span class="st">&quot;Credible intervals are well calibrated across 50 replications&quot;</span>,</a>
<a class="sourceLine" id="cb181-78" data-line-number="78">       <span class="dt">subtitle =</span> <span class="st">&quot;Red line is x = y&quot;</span>)</a>
<a class="sourceLine" id="cb181-79" data-line-number="79"></a>
<a class="sourceLine" id="cb181-80" data-line-number="80"><span class="co"># q值的稳定性</span></a>
<a class="sourceLine" id="cb181-81" data-line-number="81"></a>
<a class="sourceLine" id="cb181-82" data-line-number="82">sim_replication_prop_tests &lt;-<span class="st"> </span>sim_replication_au <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-83" data-line-number="83"><span class="st">   </span><span class="kw">nest</span>(<span class="op">-</span>replication) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-84" data-line-number="84"><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">model=</span><span class="kw">map</span>(data, add_ebb_prop_test, <span class="dt">threshold =</span> <span class="fl">.3</span>, <span class="dt">sort =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-85" data-line-number="85"><span class="st">   </span><span class="kw">unnest</span>(model)</a>
<a class="sourceLine" id="cb181-86" data-line-number="86"></a>
<a class="sourceLine" id="cb181-87" data-line-number="87">sim_replication_prop_tests <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-88" data-line-number="88"><span class="st">   </span><span class="kw">group_by</span>(replication) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-89" data-line-number="89"><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">fdr =</span> <span class="kw">cummean</span>(p <span class="op">&lt;</span><span class="st"> </span><span class="fl">.3</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-90" data-line-number="90"><span class="st">   </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(.qvalue, fdr, <span class="dt">group =</span> replication)) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-91" data-line-number="91"><span class="st">   </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-92" data-line-number="92"><span class="st">   </span><span class="kw">geom_abline</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb181-93" data-line-number="93"><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Q-value threshold&quot;</span>,</a>
<a class="sourceLine" id="cb181-94" data-line-number="94">        <span class="dt">y =</span> <span class="st">&quot;Proportion of false discoveries below this threshold&quot;</span>,</a>
<a class="sourceLine" id="cb181-95" data-line-number="95">        <span class="dt">title =</span> <span class="st">&quot;Q-value successfully controls FDR across 50 replications&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="bayeslink" class="section level2">
<h2><span class="header-section-number">10.16</span> 网络资源</h2>
<ul>
<li><a href="http://mindhacks.cn/2008/09/21/the-magical-bayesian-method/">贝叶斯方法</a></li>
<li><a href="https://github.com/mavelli/rocker-bayesian">贝叶斯镜像</a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="product.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="why.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": true,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yufree/datadown/edit/master/10-beiyesi.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["datadown.pdf", "datadown.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
